[["index.html", "A Self-Instructing Course in Mode Choice Modeling Foreword Original Acknowledgements R Packages", " A Self-Instructing Course in Mode Choice Modeling Frank Koppelman Northwestern University (Emeritus) Chandra Bhat University of Texas as Austin 2021-05-17 Foreword This is a re-publication of A Self-Instructing Course in Mode Choice Modeling, originally prepared by Frank Koppelman and Chandra Bhat for the Federal Transit Administration. The mathematics and instruction provided by this course have been extraordinarily helpful to a generation of choice modelers and other transportation professionals in academic and practical settings. The explosion of open-source packages for logit modeling and literate programming more generally warrants this re-publication in a programming-first context. The R code to compute the choice models in this book is embedded within the text and exposed to the viewer. In this way, the book serves not only as a primer on choice modeling, but on how to estimate and interpret choice modelers in R. This conversion project was undertaken by members of the AEP50(5) subcommittee on Travel Forecasting Resources on behalf of the transportation modeling community. The committee was aided in this conversion by the following students at Brigham Young University: Cover Photo: King’s Cross Station, London by Michał Parzuchowski on Unsplash Original Acknowledgements This manual was prepared under funding of the United States Department of Transportation through the Federal Transit Administration (Agmt. 8-17-04-A1/DTFT60-99-D-4013/0012) to AECOMConsult and Northwestern University. Valuable reviews and comments were provided by students in travel demand modeling classes at Northwestern University and the Georgia Institute of Technology. In addition, valuable comments, suggestions and questions were given by Rick Donnelly, Laurie Garrow, Joel Freedman, Chuck Purvis, Kimon Proussaloglou, Bruce Williams, Bill Woodford and others. The authors are indebted to all who commented on any version of this report but retain responsibility for any errors or omissions. R Packages In order to run the examples in this book, you will need the following packages: install.packages(&quot;tidyverse&quot;) # data munging and plots install.packages(&quot;mlogit&quot;) # choice model estimation In order to build the book for yourself, you will need the following additional packages that help build the tables and document: install.packages(&quot;bookdown&quot;) install.packages(&quot;distill&quot;) install.packages(&quot;modelsummary&quot;) "],["chapter1.html", "Chapter 1 Introduction 1.1 Background 1.2 Use of Disaggregate Discrete Choice Models 1.3 Application Context in Current Course 1.4 Urban and Intercity Travel Mode Choice Modeling 1.5 Description of the Course 1.6 Organization of the Course Structure", " Chapter 1 Introduction 1.1 Background Discrete choice models can be used to analyze and predict a decision maker’s choice of one alternative from a finite set of mutually exclusive and collectively exhaustive alternatives. Such models have numerous applications since many behavioral responses are discrete or qualitative in nature; that is, they correspond to choices of one or another of a set of alternatives. The ultimate interest in discrete choice modeling, as in most econometric modeling, lies in being able to predict the decision making behavior of a group of individuals (we will use the term “individual” and “decision maker” interchangeably, though the decision maker may be an individual, a household, a shipper, an organization, or some other decision making entity). A further interest is to determine the relative influence of different attributes of alternatives and characteristics of decision makers when they make choice decisions. For example, transportation analysts may be interested in predicting the fraction of commuters using each of several travel modes under a variety of service conditions, or marketing researchers may be interested in examining the fraction of car buyers selecting each of several makes and models with different prices and attributes. Further, they may be interested in predicting this fraction for different groups of individuals and identifying individuals who are most likely to favor one or another alternative. Similarly, they may be interested in understanding how different groups value different attributes of an alternative; for example are business air travelers more sensitive to total travel time or the frequency of flight departures for a chosen destination. There are two basic ways of modeling such aggregate (or group) behavior. One approach directly models the aggregate share of all or a segment of decision makers choosing each alternative as a function of the characteristics of the alternatives and socio-demographic attributes of the group. This approach is commonly referred to as the aggregate approach. The second approach is to recognize that aggregate behavior is the result of numerous individual decisions and to model individual choice responses as a function of the characteristics of the alternatives available to and socio-demographic attributes of each individual. This second approach is referred to as the disaggregate approach. The disaggregate approach has several important advantages over the aggregate approach to modeling the decision making behavior of a group of individuals. First, the disaggregate approach explains why an individual makes a particular choice given her/his circumstances and is, therefore, better able to reflect changes in choice behavior due to changes in individual characteristics and attributes of alternatives. The aggregate approach, on the other hand, rests primarily on statistical associations among relevant variables at a level other than that of the decision maker; as a result, it is unable to provide accurate and reliable estimates of the change in choice behavior due changes in service or in the population. Second, the disaggregate approach, because of its causal nature, is likely to be more transferable to a different point in time and to a different geographic context, a critical requirement for prediction. Third, discrete choice models are being increasingly used to understand behavior so that the behavior may be changed in a proactive manner through carefully designed strategies that modify the attributes of alternatives which are important to individual decision makers. The disaggregate approach is more suited for proactive policy analysis since it is causal, less tied to the estimation data and more likely to include a range of relevant policy variables. Fourth, the disaggregate approach is more efficient than the aggregate approach in terms of model reliability per unit cost of data collection. Disaggregate data provide substantial variation in the behavior of interest and in the determinants of that behavior, enabling the efficient estimation of model parameters. On the other hand, aggregation leads to considerable loss in variability, thus requiring much more data to obtain the same level of model precision. Finally, disaggregate models, if properly specified, will obtain un-biased parameter estimates, while aggregate model estimates are known to produce biased (i.e. incorrect) parameter estimates. 1.2 Use of Disaggregate Discrete Choice Models The behavioral nature of disaggregate models, and the associated advantages of such models over aggregate models, has led to the widespread use of disaggregate discrete choice methods in travel demand modeling. A few of these application contexts below with references to recent work in these areas are: travel mode choice (reviewed in detail later), destination choice (C. Bhat, Govindarajan, and Pulugurta 1998; K. E. Train 1998), route choice (Yai, Iwakura, and Morichi 1997; Cascetta et al. 2002; Erhardt et al. 2003; Gliebe and Koppelman 2002), air travel choices (Proussaloglou and Koppelman 1999), activity analysis (Wen and Koppelman 1999) and auto ownership, brand and model choice (K. Train and others 1994; C. R. Bhat and Pulugurta 1998). Choice models have also been applied in several other fields such as purchase incidence and brand choice in marketing (Kalyanam and Putler 1997; Bucklin, Gupta, and Han 1995), housing type and location choice in geography (Waddell 1993; Evers 1990; William Sermons and Koppelman 1998), choice of intercity air carrier (Proussaloglou and Koppelman 1999) and investment choices of finance firms (Corres, Hajivassiliou, and Ioannides 1993). 1.3 Application Context in Current Course In this self-instructing course, we focus on the travel mode choice decision. Within the travel demand modeling field, mode choice is arguably the single most important determinant of the number of vehicles on roadways. The use of high-occupancy vehicle modes (such as ridesharing arrangements and transit) leads to more efficient use of the roadway infrastructure, less traffic congestion, and lower mobile-source emissions as compared to the use of single-occupancy vehicles. Further, the mode choice decision is the most easily influenced travel decision for many trips. There is a vast literature on travel mode choice modeling which has provided a good understanding of factors which influence mode choice and the general range of trade-offs individuals are willing to make among level-of-service variables (such as travel time and travel cost). The emphasis on travel mode choice in this course is a result of its important policy implications, the extensive literature to guide its development, and the limited number of alternatives involved in this decision (typically, 3 – 7 alternatives). While the methods discussed here are equally applicable to cases with many alternatives, a limited number of mode choice alternatives enable us to focus the course on important concepts and issues in discrete choice modeling without being distracted by the mechanics and presentation complexity associated with larger choice sets. 1.4 Urban and Intercity Travel Mode Choice Modeling The mode choice decision has been examined both in the context of urban travel as well as intercity travel. 1.4.1 Urban Travel Mode Choice Modeling Many metropolitan areas are plagued by a continuing increase in traffic congestion resulting in motorist frustration, longer travel times, lost productivity, increased accidents and automobile insurance rates, more fuel consumption, increased freight transportation costs, and deterioration in air quality. Aware of these serious consequences of traffic congestion, metropolitan areas are examining and implementing transportation congestion management (TCM) policies. Urban travel mode choice models are used to evaluate the effectiveness of TCM policies in shifting single-occupancy vehicle users to high-occupancy vehicle modes. The focus of urban travel mode choice modeling has been on the home-based work trip. All major metropolitan planning organizations estimate home-based work travel mode choice models as part of their transportation planning process. Most of these models include only motorized modes, though increasingly non-motorized modes (walk and bike) are being included (Lawton 1989; Purvis 1997). The modeling of home-based non-work trips and non-home-based trips has received less attention in the urban travel mode choice literature. However, the increasing number of these trips and their contribution to traffic congestion has recently led to more extensive development of models for these trip purposes in some metropolitan regions (for example, Iglesias 1997; Marshall and Ballard 1998). In this course, we discuss model-building and specification issues for home-based work and home-based shop/other trips within an urban context, though the same concepts can be immediately extended to other trip purposes and locales. 1.4.2 Intercity Mode Choice Models Increasing congestion on intercity highways and at intercity air terminals has raised serious concerns about the adverse impacts of such congestion on regional economic development, national productivity and competitiveness, and environmental quality. To alleviate current and projected congestion, attention has been directed toward identifying and evaluating alternative proposals to improve intercity transportation services. These proposals include expanding or constructing new express roadways and airports, upgrading conventional rail services and providing new high-speed ground transportation services using advanced technologies. Among other things, the a priori evaluation of such large scale projects requires the estimation of reliable intercity mode choice models to predict ridership share on the proposed new or improved intercity service and identify the modes from which existing intercity travelers will be diverted to the new (or improved) service. Intercity travel mode choice models are usually segmented by purpose (business versus pleasure), day of travel (weekday versus weekend), party size (traveling individually versus group travel), etc. The travel modes in such models typically include car, rail, air, and bus modes (Koppelman and Wen 1998; C. R. Bhat 1998; and Marwick 1993). This manual examines issues of urban model choice; however, the vast majority of approaches and specifications can and have been used in intercity mode choice modeling. 1.5 Description of the Course This self-instructing course (SIC) is designed for readers who have some familiarity with transportation planning methods and background in travel model estimation. It updates and extends the previous SIC Manual (Horowitz, Koppelman, and Lerman 1986) in a number of important ways. First, it is more rigorous in the mathematical details reflecting increased awareness and application of discrete choice models over the past decade. The course is intended to enhance the understanding of model structure and estimation procedures more so than it is intended to introduce discrete choice modeling (readers with no background in discrete choice modeling may want to work first with the earlier SIC). Second, this SIC emphasizes “hands-on” estimation experience using data sets obtained from planning and decision-oriented surveys. Consequently, there is more emphasis on data structure and more extensive examination of model specification issues. Update: this manual uses the same models and data as the 2006 Bhat / Koppelman SIC, but the models are executed in R, with the data available for download and the estimation code exposed to the reader. Third, this SIC extends the range of travel modes to include non-motorized modes and discusses issues involved in including such modes in the analysis. Fourth, this SIC includes detailed coverage of the nested logit model which is being used more commonly in many metropolitan planning organizations today. 1.6 Organization of the Course Structure This course manual is divided into twelve chapters or modules. CHAPTER 1, this chapter, provides an introduction to the course. CHAPTER 2 describes the elements of the choice process including the decision maker, the alternatives, the attributes of the alternative, and the decision rule(s) adopted by the decision maker in making his/her choice. CHAPTER 3 introduces the basic concepts of utility theory followed by a discussion of probabilistic and deterministic choice concepts and the technical components of the utility function. CHAPTER 4 describes the Multinomial Logit (MNL) Model in detail. The discussion includes the functional form of the model, its mathematical properties, and the practical implications of these properties in model development and application. The chapter concludes with an overview of methods used for estimating the model parameters. In [CHAPTER 5][#estimation-chapter], we first discuss the data requirements for developing disaggregate mode choice models, the potential sources for these data, and the format in which these data need to be organized for estimation. Next, the data sets used in this manual, i.e., the San Francisco Bay Area 1990 work trip mode choice (for urban area journey to work travel) and the San Francisco Bay Area Shop/Other 1990 mode choice data (for non-work travel), are described. This is followed by the development of a basic work mode choice model specification. The estimation results of this model specification are reviewed with a comprehensive discussion of informal and formal tests to evaluate the appropriateness of model parameters and the overall goodness-of-fit statistics of the model. [CHAPTER 6][#specification-chapter] describes and demonstrates the process by which the utility function specification for the work mode choice model can be refined using intuition, statistical analysis, testing, and judgment. Many specifications of the utility function are explored for both data sets to demonstrate some of the most common specification forms and testing methods. Starting from a base model, incremental changes are made to the modal utility functions with the objective of finding a model specification that performs better statistically, and is consistent with theory and our a priori expectations about mode choice behavior. The appropriateness of each specification change is evaluated using judgment and statistical tests. This process leads to a preferred specification for the work mode choice MNL model. CHAPTER 7 parallels [CHAPTER 6][Model Specification Refinement] for the shop/other mode choice model. CHAPTER 8 introduces the Nested Logit (NL) Model. The Chapter begins with the motivation for the NL model to address one of the major limitations of the MNL. The functional form and the mathematical properties of the NL are discussed in detail. This is followed by a presentation of estimation results for a number of NL model structures for the work and shop/other data sets. Based on these estimation results, statistical tests are used to compare the various NL model structures with the corresponding MNL. CHAPTER 9 describes the issues involved in formulating, estimating and selecting a preferred NL model. The results of statistical tests are used in conjunction with our a priori understanding of the competitive structure among different alternatives to select a final preferred nesting structure. The practical implications of choosing this preferred nesting structure in comparison to the MNL model are discussed. CHAPTER 11 describes how models estimated from disaggregate data can be used to predict a aggregate mode choice for a group of individuals from relevant information regarding the altered value (due to socio-demographic changes or policy actions) of exogenous variables. The chapter also discusses issues related to the aggregate assessment of the performance of mode choice models and the application of the models to evaluate policy actions. CHAPTER 12 provides an overview of the motivation for and structure of advanced discrete choice models. The discussion is intended to familiarize readers with a variety of models that allow increased flexibility in the representation of the choice behavior than those allowed by the multinomial logit and nested logit models. It does not provide the detailed mathematical formulations or the estimation techniques for these advanced models. Appropriate references are provided for readers interested in this information. References "],["elements-of-the-choice-decision-process.html", "Chapter 2 Elements of the Choice Decision Process 2.1 Introduction 2.2 The Decision Maker 2.3 The Alternatives 2.4 Attributes of Alternatives 2.5 The Decision Rule", " Chapter 2 Elements of the Choice Decision Process 2.1 Introduction We observe individuals (or decision makers) making choices in a wide variety of decision contexts. However, we generally do not have information about the process individuals use to arrive at their observed choice. A proposed framework for the choice process is that an individual first determines the available alternatives; next, evaluates the attributes of each alternative relevant to the choice under consideration; and then, uses a decision rule to select an alternative from among the available alternatives (N. Ben-Akiva and Lerman (1985), Chapter 3). Some individuals might select a particular alternative without going through the structured process presented above. For example, an individual might decide to buy a car of the same make and model as a friend because the friend is happy with the car or is a car expert. Or an individual might purchase the same brand of ice cream out of habit. However, even in these cases, one can view the behavior within the framework of a structured decision process by assuming that the individual generates only one alternative for consideration (which is also the one chosen). In the subsequent sections, we discuss four elements associated with the choice process; the decision maker, the alternatives, the attributes of alternatives and the decision rule. 2.2 The Decision Maker The decision maker in each choice situation is the individual, group or institution which has the responsibility to make the decision at hand. The decision maker will depend on the specific choice situation. For example, the decision maker will be the individual in college choice, career choice, travel mode choice, etc.; the household in residential location choice, vacation destination choice, number of cars owned, etc.; the firm in office or warehouse location, carrier choice, employee hiring, etc. or the State (in the selection of roadway alignments). A common characteristic in the study of choice is that different decision makers face different choice situations and can have different tastes (that is, they value attributes differently). For example, in travel mode choice modeling, two individuals with different income levels and different residential locations are likely to have different sets of modes to choose from and may place different importance weights on travel time, travel cost and other attributes. These differences among decision makers should be explicitly considered in choice modeling; consequently, it is important to develop choice models at the level of the decision maker and to include variables which represent differences among the decision makers. 2.3 The Alternatives Individuals make a choice from a set of alternatives available to them. The set of available alternatives may be constrained by the environment. For example, high speed rail between two cities is an alternative only if the two cities are connected by high speed rail. The choice set determined by the environment is referred to as the universal choice set. However, even if an alternative is present in the universal choice set, it may not be feasible for a particular individual. Feasibility of an alternative for an individual in the context of travel mode choice may be determined by legal regulations (a person cannot drive alone until the age of 16), economic constraints (limousine service is not feasible for some people) or characteristics of the individual (no car available or a handicap that prevents one from driving). The subset of the universal choice set that is feasible for an individual is defined as the feasible choice set for that individual. Finally, not all alternatives in the feasible choice set may be considered by an individual in her/his choice process. For example, transit might be a feasible travel mode for an individual’s work trip, but the individual might not be aware of the availability or schedule of the transit service. The subset of the feasible choice set that an individual actually considers is referred to as the consideration choice set. This is the choice set which should be considered when modeling choice decisions. The choice set may also be determined by the decision context of the individual or the focus of the policy makers supporting the study. For example, a study of university choice may focus on choice of school type (private vs. public, small vs. large, urban vs. suburban or rural location, etc.), if the perspective is national, or a choice of specific schools, if the perspective is regional. 2.4 Attributes of Alternatives The alternatives in a choice process are characterized by a set of attribute values. Following Lancaster (1971), one can postulate that the attractiveness of an alternative is determined by the value of its attributes. The measure of uncertainty about an attribute can also be included as part of the attribute vector in addition to the attribute itself. For example, if travel time by transit is not fixed, the expected value of transit travel time and a measure of uncertainty of the transit travel time can both be included as attributes of transit. The attributes of alternatives may be generic (that is, they apply to all alternatives equally) or alternative-specific (they apply to one or a subset of alternatives). In the travel mode choice context, in-vehicle-time is usually considered to be specific to all motorized modes because it is relevant to motorized alternatives. However, if travel time by bus is considered to be very onerous due to over-crowding, bus in-vehicle-time may be defined as a distinct variable with a distinct parameter; differences between this parameter and the in-vehicle-time parameter for other motorized modes will measure the degree to which bus time is considered onerous to the traveler relative to other in-vehicle time. Other times, such as wait time at a transit stop or transfer time at a transit transfer point are relevant only to the transit modes, not for the nontransit modes. It is also common to consider the travel times for non-motorized modes (bike and walk) as specific to only these alternatives. An important reason for developing discrete choice models is to evaluate the effect of policy actions. To provide this capability, it is important to identify and include attributes whose values may be changed through pro-active policy decisions. In a travel mode choice context, these variables include measures of service (travel time, frequency, reliability of service, etc.) and travel cost. 2.5 The Decision Rule An individual invokes a decision rule (i.e., a mechanism to process information and evaluate alternatives) to select an alternative from a choice set with two or more alternatives. This decision rule may include random choice, variety seeking, or other processes which we refer to as being irrational. As indicated earlier, some individuals might use other decision rules such as “follow the leader” or habit in choosing alternatives which may also be considered to be irrational. However, even in this case, rational discrete choice models may be effective if the decision maker who adopts habitual behavior previously evaluated different alternatives and selected the best one for him/her and there have been no intervening changes in her/his alternatives and preferences. However, in the case of follow-the-leader behavior, the decision maker is considered to be rational if the “leader” is believed to share a similar value system. An individual is said to use a rational decision process if the process satisfies two fundamental constructs: consistency and transitivity. Consistency implies the same choice selection in repeated choices under identical circumstances. Transitivity implies an unique ordering of alternatives on a preference scale. Therefore, if alternative A is preferred to alternative B and alternative B is preferred to alternative C, then alternative A is preferred to alternative C. A number of possible rules fall under the purview of rational decision processes (N. Ben-Akiva and Lerman (1985), Chapter 3). In this course, the focus will be on one such decision rule referred to as utility maximization. The utility maximization rule is based on two fundamental concepts. The first is that the attribute vector characterizing each alternative can be reduced to a scalar utility value for that alternative. This concept implies a compensatory decision process; that is, it presumes that individuals make “trade-offs” among the attributes characterizing alternatives in determining their choice. Thus, an individual may choose a costlier travel mode if the travel time reduction offered by that mode compensates for the increased cost. The second concept is that the individual selects the alternative with the highest utility value. The focus on utility maximization in this course is based on its strong theoretical background, extensive use in the development of human decision making concepts, and amenability to statistical testing of the effects of attributes on choice. The utility maximization rule is also robust; that is, it provides a good description of the choice behavior even in cases where individuals use somewhat different decision rules. In the next chapter, we discuss the concepts and underlying principles of utility based choice theory in more detail. References "],["utility-based-choice-theory.html", "Chapter 3 Utility-based Choice Theory 3.1 Basic Construct of Utility Theory 3.2 Deterministic Choice Concepts 3.3 Probabilistic Choice Theory 3.4 Components of the Deterministic Portion of the Utility Function 3.5 Specification of the Additive Error Term", " Chapter 3 Utility-based Choice Theory 3.1 Basic Construct of Utility Theory Utility is an indicator of value to an individual. Generally, we think about utility as being derived from the attributes of alternatives or sets of alternatives; e.g., the total set of groceries purchased in a week. The utility maximization rule states that an individual will select the alternative from his/her set of available alternatives that maximizes his or her utility. Further, the rule implies that there is a function containing attributes of alternatives and characteristics of individuals that describes an individual’s utility valuation for each alternative. The utility function, \\(U\\), has the property that an alternative is chosen if its utility is greater than the utility of all other alternatives in the individual’s choice set. Alternatively, this can be stated as alternative, \\(&#39;i&#39;\\), is chosen among a set of alternatives, if and only if the utility of alternative, \\(&#39;i&#39;\\), is greater than or equal to the utility of all alternatives , \\(&#39;j&#39;\\), in the choice set, \\(C\\). This can be expressed mathematically as: \\[\\begin{equation} U(X_i,S_t) \\geq U(X_j,S_t) \\forall j \\Rightarrow i \\succ j \\forall j \\in C \\tag{3.1} \\end{equation}\\] where \\(U(~~~)\\) is the mathematical utility function, \\(X_i,X_j\\) are vectors of attributes describing alternatives i and j, respectively (e.g., travel time, travel cost, and other relevant attributes of the available modes), \\(S_t\\) is a vector of characteristics describing individual \\(t\\), that influence his/her preferences among alternatives (e.g., household income and number of automobiles owned for travel mode choice), \\(i \\succ j\\) means the alternative to the left is preferred to the alternative to the right, and \\(\\forall j\\) means all the cases, j, in the choice set. That is, if the utility of alternative \\(i\\) is greater than or equal to the utility of all alternatives, \\(j\\); alternative \\(i\\) will be preferred and chosen from the set of alternatives, \\(C\\). The underlying concept of utility allows us to rank a series of alternatives and identify the single alternative that has highest utility. The primary implication of this ranking or ordering of alternatives is that there is no absolute reference or zero point, for utility values. Thus, the only valuation that is important is the difference in utility between pairs of alternatives; particularly whether that difference is positive or negative. Any function that produces the same preference orderings can serve as a utility function and will give the same predictions of choice, regardless of the numerical values of the utilities assigned to individual alternatives. It also follows that utility functions, which result in the same order among alternatives, are equivalent. 3.2 Deterministic Choice Concepts The utility maximization rule, which states that an individual chooses the alternative with the highest utility, implies no uncertainty in the individual’s decision process; that is, the individual is certain to choose the highest ranked alternative under the observed choice conditions. Utility models that yield certain predictions of choice are called deterministic utility models. The application of deterministic utility to the case of a decision between two alternatives is illustrated in Figure 3.1 that portrays a utility space in which the utilities of alternatives 1 and 2 are plotted along the horizontal and vertical axes, respectively, for each individual. The 45° line represents those points for which the utilities of the two alternatives are equal. Individuals B, C and D (above the equal-utility line) have higher utility for alternative 2 than for alternative 1 and are certain to choose alternative 2. Similarly, individuals A, E, and F (below the line) have higher utility for alternative 1 and are certain to choose that alternative. If deterministic utility models described behavior correctly, we would expect that an individual would make the same choice over time and that similar individuals (individuals having the same individual and household characteristics), would make the same choices when faced with the same set of alternatives. In practice, however, we observe variations in an individual’s choice and different choices among apparently similar individuals when faced with similar or even identical alternatives. For example, in studies of work trip mode choice, it is commonly observed that individuals, who are represented as having identical personal characteristics and who face the same sets of travel alternatives, choose different modes of travel to work. Further, some of these individuals vary their choices from day to day for no observable reason resulting in observed choices which appear to contradict the utility evaluations; that is, person A may choose Alternative 2 even though \\(U_1 &gt; U_2\\) or person C may choose Alternative 2 even though \\(U_2 &gt; U_1\\) . These observations raise questions about the appropriateness of deterministic utility models for modeling travel or other human behavior. The challenge is to develop a model structure that provides a reasonable representation of these unexplained variations in travel behavior. tibble(U1 = c(2.5, 2, 3, 5, 6, 6), U2 = c(1, 4, 5, 7, 4, 5), label = c(&quot;A&quot;, &quot;B&quot;, &quot;C&quot;, &quot;D&quot;, &quot;E&quot;, &quot;F&quot;)) %&gt;% ggplot(aes(x = U1, y = U2, label = label)) + geom_point() + xlab(&quot;Utility for Alternative 1&quot;) + ylab(&quot;Utility for Alternative 2&quot;) + geom_abline(slope = 1, intercept = 0, lty = &quot;dotted&quot;) + geom_label() + geom_text(data = tibble(U1 = c(2,5), U2 = c(6.5, 1.5), label= c(&quot;Alt. 2 Preferred&quot;, &quot;Alt. 1 Preferred&quot;))) + scale_x_continuous(limits = c(0,8)) + scale_y_continuous(limits = c(0,8)) Figure 3.1: Illustration of Deterministic Choice There are three primary sources of error in the use of deterministic utility functions. First, the individual may have incomplete or incorrect information or misperceptions about the attributes of some or all of the alternatives. As a result, different individuals, each with different information or perceptions about the same alternatives are likely to make different choices. Second, the analyst or observer has different or incomplete information about the same attributes relative to the individuals and an inadequate understanding of the function the individual uses to evaluate the utility of each alternative. For example, the analyst may not have good measures of the reliability of a particular transit service, the likelihood of getting a seat at a particular time of day or the likelihood of finding a parking space at a suburban rail station. However, the traveler, especially if he/she is a regular user, is likely to know these things or to have opinions about them. Third, the analyst is unlikely to know, or account for, specific circumstances of the individual’s travel decision. For example, an individual’s choice of mode for the work trip may depend on whether there are family visitors or that another family member has a special travel need on a particular day. Using models which do not account for and incorporate this lack of information results in the apparent behavioral inconsistencies described above. While human behavior may be argued to be inconsistent, it can also be argued that the inconsistency is only apparent and can be attributed to the analyst’s lack of knowledge regarding the individual’s decision making process. Models that take account of this lack of information on the part of the analyst are called random utility or probabilistic choice models. 3.3 Probabilistic Choice Theory If analysts thoroughly understood all aspects of the internal decision making process of choosers as well as their perception of alternatives, they would be able to describe that process and predict mode choice using deterministic utility models. Experience has shown, however, that analysts do not have such knowledge; they do not fully understand the decision process of each individual or their perceptions of alternatives and they have no realistic possibility of obtaining this information. Therefore, mode choice models should take a form that recognizes and accommodates the analyst’s lack of information and understanding. The data and models used by analysts describe preferences and choice in terms of probabilities of choosing each alternative rather than predicting that an individual will choose a particular mode with certainty. Effectively, these probabilities reflect the population probabilities that people with the given set of characteristics and facing the same set of alternatives choose each of the alternatives. As with deterministic choice theory, the individual is assumed to choose an alternative if its utility is greater than that of any other alternative. The probability prediction of the analyst results from differences between the estimated utility values and the utility values used by the traveler. We represent this difference by decomposing the utility of the alternative, from the perspective of the decision maker, into two components. One component of the utility function represents the portion of the utility observed by the analyst, often called the deterministic (or observable) portion of the utility. The other component is the difference between the unknown utility used by the individual and the utility estimated by the analyst. Since the utility used by the decision maker is unknown, we represent this difference as a random error. Formally, we represent this by: \\[\\begin{equation} U_{it} = V_{it} + \\epsilon_{it} \\tag{3.2} \\end{equation}\\] where \\(U_{it}\\) is the true utility of the alternative \\(i\\) to the decision maker \\(t\\), (\\(U_{it}\\) is equivalent to \\(U(X_i,S_t)\\) but provides a simpler notation), \\(V_{it}\\) is the deterministic or observable portion of the utility estimated by the analyst, and \\(\\epsilon_{it}\\) is the error or the portion of the utility unkown to the analyst. The analyst does not have any information about the error term. However, the total error which is the sum of errors from many sources (imperfect information, measurement errors, omission of modal attributes, omission of the characteristics of the individual that influence his/her choice decision and/or errors in the utility function) is represented by a random variable. Different assumptions about the distribution of the random variables associated with the utility of each alternative result in different representations of the model used to describe and predict choice probabilities. The assumptions used in the development of logit type models are discussed in the next Chapter. 3.4 Components of the Deterministic Portion of the Utility Function The deterministic or observable portion (often called the systematic portion) of the utility of an alternative is a mathematical function of the attributes of the alternative and the characteristics of the decision maker. The systematic portion of utility can have any mathematical form but the function is most generally formulated as additive to simplify the estimation process. This function includes unknown parameters which are estimated in the modeling process. The systematic portion of the utility function can be broken into components that are (1) exclusively related to the attributes of alternatives, (2) exclusively related to the characteristics of the decision maker and (3) represent interactions between the attributes of alternatives and the characteristics of the decision maker. Thus, the systematic portion of utility can be represented by: \\[\\begin{equation} V_{t,i} = V(S_t) + V(X_i) + V(S_t,X_i) \\tag{3.3} \\end{equation}\\] where \\(V_{it}\\) is the systematic portion of utility of alternative i for inidivual t, \\(V(S_t)\\) is the portion of utility associated with characteristics of individual \\(t\\), \\(V(X_i)\\) is the portion of utility of alternative \\(i\\) associated with the attributes of alternative \\(i\\), and \\(V(S_t,X_i)\\) is the portion of the utility which results from interactions between the attributes of alternative \\(i\\) and the characteristics of individual \\(t\\). Each of these utility components is discussed separately 3.4.1 Utility Associated with the Attributes of Alternatives The utility component associated exclusively with alternatives includes variables that describe the attributes of alternatives. These attributes influence the utility of each alternative for all people in the population of interest. The attributes considered for inclusion in this component are service attributes which are measurable and which are expected to influence people’s preferences/choices among alternatives. These include measures of travel time, travel cost, walk access distance, transfers required, crowding, seat availability, and others. For example: * Total travel time, * In-vehicle travel time, * Out-of-vehicle travel time, * Travel cost, * Number of transfers (transit modes), * Walk distance and, * Reliability of on time arrival. These measures differ across alternatives for the same individual and also among individuals due to differences in the origin and destination locations of each person’s travel. For example, this portion of the utility function could look like: \\[\\begin{equation} V(X_i) = \\gamma_1 ~ &#39; ~ X_{i1} + \\gamma_2 ~ &#39; ~ X_{i2} + L + \\gamma_k ~ &#39; ~ X_{ik} \\tag{3.4} \\end{equation}\\] where \\(\\gamma_k\\) is the parameter which defines the direction and importance of the effect of attribute \\(k\\) on the utility of an alternative and \\(X_{ik}\\) is the value of attribute \\(k\\) for alternative \\(i\\). Thus, this portion of the utility of each alternative, \\(i\\), is the weighted sum of the attributes of alternative \\(i\\). A specific example for the Drive Alone (DA), Shared Ride (SR), and Transit (TR) alternatives is: \\[\\begin{equation} V(X_{DA}) = \\gamma_1 ~ &#39; ~ TT_{DA} + \\gamma_2 ~ &#39; ~ TC_{DA} \\tag{3.5} \\end{equation}\\] \\[\\begin{equation} V(X_{SR}) = \\gamma_1 ~ &#39; ~ TT_{SR} + \\gamma_2 ~ &#39; ~ TC_{SR} \\tag{3.6} \\end{equation}\\] \\[\\begin{equation} V(X_{TR}) = \\gamma_1 ~ &#39; ~ TT_{TR} + \\gamma_2 ~ &#39; ~ TC_{TR} + \\gamma_3 ~ &#39; ~ FREQ_{TR} \\tag{3.7} \\end{equation}\\] where \\(TT_i\\) is the travel time for mode \\(i\\) (\\(i\\) = \\(DA, SR, TR\\)) and \\(TC_i\\) is the travel cost for mode \\(i\\), and \\(FREQ_{TR}\\) is the frequency for transit services. Travel time and travel cost are generic; that is, they apply to all alternatives; frequency is specific to transit only. The parameters, \\(\\gamma_k\\), are identical for all the alternatives to which they apply. This implies that the utility value of travel time and travel cost are identical across alternatives. The possibility that travel time may be more onerous on Transit than by Drive Alone or Shared Ride could be tested by reformulating the above models to: \\[\\begin{equation} V(X_{DA}) = \\gamma_{11} \\times TT_{DA} + \\gamma_{12} \\times 0 + \\gamma_2 \\times TC_{DA} \\tag{3.8} \\end{equation}\\] \\[\\begin{equation} V(X_{SR}) = \\gamma_{11} \\times TT_{SR} + \\gamma_{12} \\times 0 + \\gamma_2 \\times TC_{SR} \\tag{3.9} \\end{equation}\\] \\[\\begin{equation} V(X_{TR}) = \\gamma_{11} \\times 0 + \\gamma_{12} \\times TT_{TR} + \\gamma_2 \\times TC_{TR} + \\gamma_3 \\times FREQ_{TR} \\tag{3.10} \\end{equation}\\] That is, two distinct parameters would be estimated for travel time; one for travel time by DA and SR, \\(\\gamma_{11}\\), and the other for travel time by TR, \\(\\gamma_{12}\\). These parameters could be compared to determine if the differences are statistically significant or large enough to be important. 3.4.2 Utility ‘Biases’ Due to Excluded Variables It has been widely observed that decision makers exhibit preferences for alternatives which cannot be explained by the observed attributes of those alternatives. These preferences are described as alternative specific preference or bias; they measure the average preference of individuals with different characteristics for an alternative relative to a ‘reference’ alternative. As will be shown in CHAPTER 4, the selection of the reference alternative does not influence the interpretation of the model estimation results. In the simplest case, we assume that the bias is the same for all decision makers. In this case, this portion of the utility function would be: \\[\\begin{equation} Bias_i = \\beta_{i0} \\times ASC_i \\tag{3.11} \\end{equation}\\] where \\(\\beta_{i0}\\) represents an increase in the utility of alternative \\(i\\) for all choosers and \\(ASC_i\\) is equal to one for alternative \\(i\\) and zero for all other alternatives. More detailed observation generally indicates that people with different personal and family characteristics have different preferences among sets of alternatives. For example, members of high income households are less likely to choose transit alternatives than low income individuals, all other things being equal. Similarly, members of households with fewer automobiles than workers are more likely to choose transit alternatives. Thus, it is useful to consider that the bias may differ across individuals as discussed in the next section. 3.4.3 Utility Related to the Characteristics of the Decision Maker The differences in ‘bias’ across individuals can be represented by incorporating personal and household variables in mode choice models. Variables commonly used for this purpose include: * Income of the traveler’s household, * Sex of traveler, * Age of traveler, * Number of automobiles in traveler’s household, * Number of workers in the traveler’s household, and * Number of adults in the traveler’s household. In some cases, these variables are combined. For example, the number of automobiles may be divided by the number of workers to indicate the availability of automobiles to each household member. This approach results in modification of the bias portion of the utility function to look like: \\[\\begin{equation} \\beta_{i0} \\times ASC_i + \\beta_{i1} \\times S_{1t} + \\beta_{i2} \\times S_{2t} + ... + \\beta_{iM} \\times S_{Mt} \\tag{3.12} \\end{equation}\\] where \\(\\beta_{im}\\) is the parameter which defines the direction and magnitude of the incremental bias due to an increase in the \\(m^{th}\\) characteristic of the decision maker (\\(m = 0\\) represents the parameter associated with the alternative specific constant) and \\(S_{mt}\\) is the value of the \\(m^{th}\\) characteristics for individual \\(t\\). For the case of three alternatives, (Drive Alone, Shared Ride and Transit), the decision maker components of the utility functions are: \\[\\begin{equation} V(S_{DA})=\\beta_{DA,0}\\times1+\\beta_{DA,1}\\times Inc_{t}+\\beta_{DA,2}\\times NCar_{t} \\tag{3.13} \\end{equation}\\] \\[\\begin{equation} V(S_{SR})=\\beta_{SR,0}\\times1+\\beta_{SR,1}\\times Inc_{t}+\\beta_{SR,2}\\times NCar_{t} \\tag{3.14} \\end{equation}\\] \\[\\begin{equation} V(S_{TR})=\\beta_{SR,0}\\times1+\\beta_{TR,1}\\times Inc_{t}+\\beta_{TR,2}\\times NCar_{t} \\tag{3.15} \\end{equation}\\] where \\(\\beta_{i0}\\) is the modal bias constant for mode \\(i\\) (\\(i\\)=DA,SR,TR), \\(Inc_{t}\\) is the household income of the traveler, \\(NCar_{t}\\) is the number of cars in the traveler’s household, and \\(\\beta_{i1}\\),\\(\\beta_{i2}\\) are mode specific parameters on income and cars, respectively, for mode \\(i\\) (\\(i\\)=DA,SR,TR) It is important to recognize that the parameters that describe the effect of traveler characteristics differ across alternatives while the variables are identical across alternatives for each individual. 3.4.4 Utility Defined by Interactions between Alternative Attributes and Decision Maker Characteristics The final component of utility takes into account differences in how attributes are evaluated by different decision makers. One effect of income, described earlier, is to increase the preference for travel by private automobile. This representation implies that the preference for DA and SR increase with income, independent of the attributes of travel by each alternative. Another way to represent the influence of income is that increasing income reduces the importance of monetary cost in the evaluation of modal alternatives. The idea that high income travelers place less importance on cost can be represented by dividing the cost of travel of an alternative by annual income or some function of annual income of the traveler or his/her household. Another interaction effect might be that different travelers evaluate travel time differently. For example, one might argue that because women commonly take increased responsibility for home maintenance and child care, they are likely to evaluate increased travel time to work more negatively than men. This could be represented by adding a variable to the model which represents the product of a dummy variable for female (one if the traveler is a woman and zero otherwise) times travel time, as illustrated below in the utility equations for a three alternative mode choice example (Drive Alone, Shared Ride, and Transit) using the same notation described previously. \\[\\begin{equation} V(X_{DA},S_{i})=\\gamma_{1}\\times TT_{DA}+\\gamma_{2}\\times TT_{DA}\\times Fem+\\gamma_{3}\\times TC_{DA} \\tag{3.16} \\end{equation}\\] \\[\\begin{equation} V(X_{SR},S_{i})=\\gamma_{1}\\times TT_{SR}+\\gamma_{2}\\times TT_{SR}\\times Fem+\\gamma_{3}\\times TC_{SR} \\tag{3.17} \\end{equation}\\] \\[\\begin{equation} V(X_{TR},S_{i})=\\gamma_{1}\\times TT_{TR}+\\gamma_{2}\\times TT_{TR}\\times Fem+\\gamma_{3}\\times TC_{TR}+\\gamma_{4}\\times FREQ_{TR} \\tag{3.18} \\end{equation}\\] In this example, \\(\\gamma_1\\) represents the utility value of one minute of travel time to men and \\(\\gamma_2\\) represents the additional utility value of one minute of travel time to women. Thus, the total utility value of one minute of travel time to women is \\(\\gamma_1+\\gamma_2\\). In this case, \\(\\gamma_1\\), is expected to be negative indicating that increased travel time reduces the utility of an alternative. \\(\\gamma_2\\) may be negative or positive, indicating that women are more or less sensitive to increases in travel time. 3.5 Specification of the Additive Error Term As described in section 3.3, the utility of each alternative is represented by a deterministic component, which is represented in the utility function by observed and measured variables, and an additive error term, \\(\\epsilon_i\\) which represents those components of the utility function which are not included in the model. In the three alternative examples used above, the total utility of each alternative can be represented by: \\[\\begin{equation} U_{DA}=V(S_t)+V(X_{DA})+V(S_t,X_{DA})+\\epsilon_{DA} \\tag{3.19} \\end{equation}\\] \\[\\begin{equation} U_{SR}=V(S_t)+V(X_{SR})+V(S_t,X_{SR})+\\epsilon_{SR} \\tag{3.20} \\end{equation}\\] \\[\\begin{equation} U_{TR}=V(S_t)+V(X_{TR})+V(S_t,X_{TR})+\\epsilon_{TR} \\tag{3.21} \\end{equation}\\] where \\(V()\\) represents the deterministics components of the utility for the alternatives, and \\(\\epsilon_i\\) represents the random components of the utility, also called the error term. The error term is included in the utility function to account for the fact that the analyst is not able to completely and correctly measure or specify all attributes that determine travelers’ mode utility assessment. By definition, error terms are unobserved and unmeasured. A wide range of distributions could be used to represent the distribution of error terms over individuals and alternatives. If we assume that the error term for each alternative represents many missing components, each of which has relatively little impact on the value of each alternative, the central limit theorem suggests that the sum of these small errors will be distributed normally. This assumption leads to the formulation of the Multinomial Probit (MNP) probabilistic choice model. However, the mathematical complexity of the MNP model; which makes it difficult to estimate, interpret and predict; has limited its use in practice. An alternative distribution assumption, described in the next chapter, leads to the formulation of the multinomial logit (MNL) model. "],["the-multinomial-logit-model.html", "Chapter 4 The Multinomial Logit Model 4.1 Overview Description and Functional Form 4.2 Independence of Irrelevant Alternatives Property 4.3 Example: Prediction with Multinomial Logit Model 4.4 Measures of Response to Changes in Attributes of Alternatives 4.5 Measures of Responses to Changes in Decision Maker Characteristics 4.6 Model Estimation: Concept and Method", " Chapter 4 The Multinomial Logit Model library(tidyverse) ## ── Attaching packages ─────────────────────────────────────── tidyverse 1.3.0 ── ## ✓ ggplot2 3.3.3 ✓ purrr 0.3.4 ## ✓ tibble 3.1.1 ✓ dplyr 1.0.5 ## ✓ tidyr 1.1.3 ✓ stringr 1.4.0 ## ✓ readr 1.4.0 ✓ forcats 0.5.1 ## ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ── ## x dplyr::filter() masks stats::filter() ## x dplyr::lag() masks stats::lag() library(kableExtra) ## ## Attaching package: &#39;kableExtra&#39; ## The following object is masked from &#39;package:dplyr&#39;: ## ## group_rows #&#39; Create a tibble object that evaluates the named expressions passed #&#39; in as utility equation. utility_table &lt;- function(expressions){ top &lt;- tibble( Alternative = names(expressions), Expression = expressions ) %&gt;% rowwise() %&gt;% mutate( Value = eval(parse(text = Expression)), Exponent = exp(Value) ) %&gt;% ungroup() %&gt;% mutate( Probability = Exponent / sum(Exponent) ) bottom &lt;- tibble( Alternative = &quot;Total&quot;, Expression = &quot;&quot;, Value = NA, Exponent = sum(top$Exponent), Probability = sum(top$Probability) ) bind_rows(top, bottom) } 4.1 Overview Description and Functional Form The mathematical form of a discrete choice model is determined by the assumptions made regarding the error components of the utility function for each alternative as described in section 3.5. The specific assumptions that lead to the Multinomial Logit Model are (1) the error components are extreme-value (or Gumbel) distributed, (2) the error components are identically and independently distributed across alternatives, and (3) the error components are identically and independently distributed across observations/individuals. We discuss each of these assumptions below. The most common assumption for error distributions in the statistical and modeling literature is that errors are distributed normally. There are good theoretical and practical reasons for using the normal distribution for many modeling applications. However, in the case of choice models the normal distribution assumption for error terms leads to the Multinomial Probit Model (MNP) which has some properties that make it difficult to use in choice analysis.1 The Gumbel distribution is selected because it has computational advantages in a context where maximization is important, closely approximates the normal distribution (see Figure 4.1 and Figure 4.2) and produces a closed-form2 probabilistic choice model. pdf &lt;- tibble( x = seq(-5, 5, by = 0.01), Normal = dnorm(x, sd = sqrt(pi^2/6)), Gumbel = exp(-x) * exp(-exp(-x)) ) ggplot(pdf %&gt;% gather(key = &quot;Distribution&quot;, value = &quot;Probability&quot;, -x), aes(x = x, y = Probability, color = Distribution)) + geom_line() + theme_bw() Figure 4.1: Probability density function for normal and Gumbel distributions. cdf &lt;- tibble( x = seq(-4, 5, by = 0.01), Normal = pnorm(x, sd = sqrt(pi^2 / 6)), Gumbel = exp(-exp(-x)) ) ggplot(cdf %&gt;% gather(key = &quot;Distribution&quot;, value = &quot;Probability&quot;, -x), aes(x = x, y = Probability, color = Distribution)) + geom_line() + theme_bw() Figure 4.2: Cumulative density function for normal and Gumbel distributions. The Gumbel has the following cumulative distribution and probability density functions: \\[\\begin{equation} F(\\epsilon) = e^{e^{-\\mu(\\epsilon-\\eta)}} \\tag{4.1} \\end{equation}\\] \\[\\begin{equation} f(\\epsilon) = \\mu e^{-\\mu(\\epsilon-\\eta)} \\times e^{e^{-\\mu(\\epsilon-\\eta)}} \\tag{4.2} \\end{equation}\\] where \\(\\mu\\) is the scale parameter which determines the variance of the distribution and \\(\\eta\\) is the location (mode) parameter. The mean and variance of the distribution are: \\[\\begin{equation} Mean = \\eta + \\frac{0.577}{\\mu} \\tag{4.3} \\end{equation}\\] \\[\\begin{equation} Variance = \\frac{\\pi^2}{6\\mu^2} \\tag{4.4} \\end{equation}\\] The second and third assumptions state the location and variance of the distribution just as \\(\\mu\\) and \\(\\sigma^2\\) indicate the location and variance of the normal distribution. We will return to the discussion of the independence between/among alternatives in CHAPTER 8. The three assumptions, taken together, lead to the mathematical structure known as the Multinomial Logit Model (MNL), which gives the choice probabilities of each alternative as a function of the systematic portion of the utility of all the alternatives. The general expression for the probability of choosing an alternative ‘i’ (i = 1,2,.., J) from a set of J alternatives is: \\[\\begin{equation} Pr(i) = \\frac{\\exp(V_i)}{\\sum_{j=1}^{J}\\exp(V_j)} \\tag{4.5} \\end{equation}\\] Where \\(Pr(i)\\) is the probability of the decision-make choosing alternative i and \\(V_j\\) is the systematic component of the utility of alternative j. The exponential function is described in Figure 4.3 which shows the relationship between \\(\\exp(V_i)\\) and \\(V_i\\). Note that \\(\\exp(V_i)\\) is always positive and increases monotonically with \\(V_i\\). tibble( x = seq(-3,3,.1), y = exp(x)) %&gt;% ggplot(aes(x = x, y = y)) + geom_line() + xlab(bquote(V[i])) + ylab(bquote(exp(V[i]))) + theme_bw() Figure 4.3: Relationship Between \\(V_i\\) and \\(\\exp(V_i)\\) The multinomial logit (MNL) model has several important properties. We illustrate these for a case in which the decision maker has three available alternatives: Drive Alone (DA), Shared Ride (SR), and TRansit (TR). The probabilities of each alternative are given by modifying equation 4.5 for each alternative to obtain: \\[\\begin{equation} Pr(DA) = \\frac{\\exp(V_{DA})}{\\exp(V_{DA}) + \\exp(V_{SR}) + \\exp(V_{TR})} \\tag{4.6} \\end{equation}\\] \\[\\begin{equation} Pr(SR) = \\frac{\\exp(V_{SR})}{\\exp(V_{DA}) + \\exp(V_{SR}) + \\exp(V_{TR})} \\tag{4.7} \\end{equation}\\] \\[\\begin{equation} Pr(TR) = \\frac{\\exp(V_{TR})}{\\exp(V_{DA}) + \\exp(V_{SR}) + \\exp(V_{TR})} \\tag{4.8} \\end{equation}\\] where \\(Pr(DA)\\), \\(Pr(SR)\\), and \\(Pr(TR)\\) are the probabilities of the decision-maker choosing drive alone, shared ride and transit, respectively, and \\(V_{DA}\\), \\(V_{SR}\\) and \\(V_{TR}\\) are the systematic components of the utility for drive alone, shared ride, and transit alternatives, respectively. It is common to replace these three equations by a single general equation to represent the probability of any alternative and to simplify the equation by replacing the explicit summation in the denominator by the summation over alternatives as: \\[\\begin{equation} Pr(i) = \\frac{\\exp(V_{i})}{\\exp(V_{DA}) + \\exp(V_{SR}) + \\exp(V_{TR})} \\tag{4.9} \\end{equation}\\] \\[\\begin{equation} Pr(i) = \\frac{\\exp(V_{i})}{\\sum_{j=DA,SR,TR}\\exp(V_j)} \\tag{4.10} \\end{equation}\\] where i indicates the alternative for which the probability is being computed. This formulation implies that the probability of choosing an alternative increases monotonically with an increase in the systematic utility of that alternative and decreases with increases in the systematic utility of each of the other alternatives. This is illustrated in Table 4.1 showing the probability of DA as a function of its own utility (with the utilities of other alternatives held constant) and in Table ?? as a function of the utility of other alternatives with its own utility fixed. tibble( case = 1:5, vda = c(-3.0, -1.5, 0.0, 1.5, 3.0), vsr = -1.5, vtr = -0.5 ) %&gt;% mutate( p = exp(vda) / (exp(vda) + exp(vsr) + exp(vtr)) ) %&gt;% kableExtra::kbl( caption = &quot;Probability Values for Drive Alone as a Function of Drive Alone Utility (Shared Ride and Transit Utilities held constant)&quot;, col.names = c(&quot;$Case$&quot;, &quot;$V_{DA}$&quot;, &quot;$V_{SR}$&quot;, &quot;$V_{TR}$&quot;, &quot;$Pr(DA)$&quot;)) %&gt;% kableExtra::kable_styling() Table 4.1: Probability Values for Drive Alone as a Function of Drive Alone Utility (Shared Ride and Transit Utilities held constant) \\(Case\\) \\(V_{DA}\\) \\(V_{SR}\\) \\(V_{TR}\\) \\(Pr(DA)\\) 1 -3.0 -1.5 -0.5 0.0566117 2 -1.5 -1.5 -0.5 0.2119416 3 0.0 -1.5 -0.5 0.5465494 4 1.5 -1.5 -0.5 0.8437947 5 3.0 -1.5 -0.5 0.9603322 tibble( case = 6:11, vda = 0.0, vsr = c(-1.5, -1.5, -1.5, -0.5, -0.5, -0.5), vtr = c(-1.5, -1.0, -0.5, -1.5, -1.0, -0.5) ) %&gt;% mutate( p = exp(vda) / (exp(vda) + exp(vsr) + exp(vtr)) ) %&gt;% kableExtra::kbl( caption = &quot;Probability Values for Drive Alone as a Function of Shared Ride and Transit Utilties&quot;, col.names = c(&quot;$Case$&quot;, &quot;$V_{DA}$&quot;, &quot;$V_{SR}$&quot;, &quot;$V_{TR}$&quot;, &quot;$Pr(DA)$&quot;)) %&gt;% kableExtra::kable_styling() Table 4.2: Probability Values for Drive Alone as a Function of Shared Ride and Transit Utilties \\(Case\\) \\(V_{DA}\\) \\(V_{SR}\\) \\(V_{TR}\\) \\(Pr(DA)\\) 6 0 -1.5 -1.5 0.6914385 7 0 -1.5 -1.0 0.6285317 8 0 -1.5 -0.5 0.5465494 9 0 -0.5 -1.5 0.5465494 10 0 -0.5 -1.0 0.5064804 11 0 -0.5 -0.5 0.4518628 We use this three-alternative example to illustrate three important properties of the MNL: (1) its sigmoid or S shape, (2) dependence of the alternative choice probabilities on the differences in the systematic utility and (3) independence of the ratio of the choice probabilities of any pair of alternatives from the attributes and availability of other alternatives. 4.1.1 The Sigmoid or S shape of Multinomial Logit Probabilities The S shape of the MNL probabilities is illustrated in Figure ?? where the probability of choosing Drive Alone is shown as a function of its own utility, with the utilities of the other alternatives held constant. The S-shape limits the probability range between zero when the utility of DA is very low, relative to other alternatives, and one when the utility of DA is very high, relative to other alternatives. This function has very gradual slope at extreme values of DA utility, relative to the other alternatives, and is much steeper when its utility reaches a value such that its choice probability is close to one-half. This implies that if the representative utility of one alternative is very low or very high, compared with the others, a small increase in the utility of this alternative will not substantially affect its probability of being chosen. The point at which an increase in the representative utility of an alternative has the greatest effect on its probability of being chosen (i.e., the point of maximum slope along the curve) is when its representative utility is equivalent to the combined utility of the other alternatives. When this is true, a small increase in the utility of one alternative can ‘tip the balance’ and induce a large increase in the probability of the alternative being chosen (Train, 1993). #&#39; Function to compute mnl probabilities #&#39; @param vi utility of target alternative #&#39; @param ... utilities of other alternatives mnl_prob &lt;- function(vi, ...){ vj &lt;- c(...) exp(vi) / sum(exp(vj)) } u &lt;- tibble( v_da = seq(-3, 3, by = 0.01), v_tr = 0, v_walk = -0.5 ) %&gt;% rowwise() %&gt;% mutate( drive = mnl_prob(v_da, v_da, v_tr, v_walk), transit = mnl_prob(v_tr, v_da, v_tr, v_walk), walk = mnl_prob(v_walk, v_da, v_tr, v_walk) ) ggplot(u %&gt;% gather(Mode, Probability, drive, transit, walk), aes(x = v_da, y = Probability, color = Mode)) + geom_line() + xlab(&quot;Utility of Drive&quot;) + theme_bw() Figure 4.4: Probability of choosing alternatives while holding other utilities constant, \\(V_{transit} = 0, V_{walk} = -0.5\\) 4.1.2 The Equivalent Differences Property A fundamental property of the multinomial logit and other choice models is that the choice probabilities of the alternatives depend only on the differences in the systematic utilities of different alternatives and not their actual values. This can be illustrated in two ways. First, we show that the choice probability equations are unchanged if the same incremental value, say \\(\\Delta V\\), is added to the utility of each alternative. The original probabilities for the three alternatives in the example are given by: \\[\\begin{equation} Pr(i) = \\frac{\\exp(V_{i})}{\\exp(V_{DA}) + \\exp(V_{SR}) + \\exp(V_{TR})} \\tag{4.11} \\end{equation}\\] where i is the alternative for which the probabilities are being computed. Adding \\(\\Delta V\\) to the systematic components of \\(V_{DA}\\), \\(V_{SR}\\) and \\(V_{TR}\\) gives3: \\[\\begin{align*} Pr(i)&amp;= \\frac{\\exp(V_i + {\\Delta V })} {\\exp(V_{DA}+{\\Delta V }) + \\exp(V_{SR}+{\\Delta V }) + \\exp(V_{TR}+{\\Delta V })} \\\\ &amp;= \\frac{\\exp(V_i) \\times \\exp({\\Delta V })} {\\exp(V_{DA}) \\times \\exp({\\Delta V }) + \\exp(V_{SR}) \\times \\exp({\\Delta V }) + \\exp(V_{TR}) \\times \\exp({\\Delta V })} \\\\ &amp;= \\frac{\\exp(V_i) \\times \\exp({\\Delta V })}{[\\exp(V_{DA}) + \\exp(V_{SR}) + \\exp(V_{TR})] \\times \\exp({\\Delta V })} \\\\ &amp;= \\frac{\\exp(V_i)}{[\\exp(V_{DA}) + \\exp(V_{SR}) + \\exp(V_{TR})]} \\tag{4.12} \\end{align*}\\] which is the same probability as before \\(\\Delta V\\) was added to each of the utilities. This result applies to any value of \\(\\Delta V\\). We also illustrate this property through use of a numerical example for the three alternative choice problem used earlier. The following equations represent the case when the utility values for Drive Alone, Shared Ride and Transit equal 0.5, 1.5 and 3.0, respectively: \\[\\begin{equation} Pr(DA) = \\frac {\\exp(-0.5)}{\\exp(-0.5) + \\exp(-1.5) + \\exp(-3.0)} = 0.690 \\tag{4.13} \\end{equation}\\] \\[\\begin{equation} Pr(SR) = \\frac {\\exp(-1.5)}{\\exp(-0.5) + \\exp(-1.5) + \\exp(-3.0)} = 0.254 \\tag{4.14} \\end{equation}\\] \\[\\begin{equation} Pr(TR) = \\frac {\\exp(-3.0)}{\\exp(-0.5) + \\exp(-1.5) + \\exp(-3.0)} = 0.057 \\tag{4.15} \\end{equation}\\] Similarly, if the utility of each alternative is increased by one, the probabilities are: \\[\\begin{equation} Pr(DA) = \\frac {\\exp(0.5)}{\\exp(0.5) + \\exp(-0.5) + \\exp(-2.0)} = 0.690 \\tag{4.16} \\end{equation}\\] \\[\\begin{equation} Pr(SR) = \\frac {\\exp(-0.5)}{\\exp(0.5) + \\exp(-0.5) + \\exp(-2.0)} = 0.254 \\tag{4.17} \\end{equation}\\] \\[\\begin{equation} Pr(TR) = \\frac {\\exp(-2.0)}{\\exp(0.5) + \\exp(-0.5) + \\exp(-2.0)} = 0.057 \\tag{4.18} \\end{equation}\\] As expected, the choice probabilities are identical to those obtained before the addition of the constant utility to each mode. The calculations supporting this comparison are shown in Table 4.3 and Table 4.4. Table 4.3 shows the computation of the choice probabilities based on the initial set of modal utilities and Table 4.4 shows the same computation after each of the utilities is increased by one.4 Table 4.3: Numerical Example Illustrating Equivalent Difference Property: Probability of Each Alternative Before Adding Delta Utility Alternative Expression Value Exponent Probability Drive Alone -0.50 -0.5 0.6065307 0.6896721 Shared Ride -1.50 -1.5 0.2231302 0.2537162 Transit -3.00 -3.0 0.0497871 0.0566117 Total NA 0.8794479 1.0000000 where the sum of the exponent variable is equal to 0.879. Table 4.4: Numerical Example Illustrating Equivalent Difference Property: Probability of Each Alternative After Adding Delta (=1.0) Utility Alternative Expression Value Exponent Probability Drive Alone -0.50 + 1.00 0.5 1.6487213 0.6896721 Shared Ride -1.50 + 1.00 -0.5 0.6065307 0.2537162 Transit -3.00 + 1.00 -2.0 0.1353353 0.0566117 Total NA 2.3905872 1.0000000 Where the sum of the exponent variable is equal to 2.391 The expression for the probability equation of the logit model (equation 4.9) can also be presented in a different form which makes the equivalent difference property more apparent. For the drive alone alternative, this expression can be obtained by multiplying the numerator and denominator of the standard probability expression by (-VDA) as shown in the following equations. \\[\\begin{equation} \\begin{split} Pr(DA) &amp;= \\frac{\\exp(V_{DA})}{\\exp(V_{DA}) + \\exp(V_{SR}) + \\exp(V_{TR})} \\times \\frac {\\exp(-V_{DA})}{\\exp(-V_{DA})}\\\\ &amp;= \\frac {\\exp(V_{DA})\\times \\exp(-V_{DA})}{[\\exp(V_{DA}) + \\exp(V_{SR}) + \\exp(V_{TR})] \\times \\exp(-V_{DA})}\\\\ &amp;= \\frac {\\exp(0)}{\\exp(0) + \\exp(V_{SR}-V_{DA}) + \\exp(V_{TR}-V_{DA})} \\end{split} \\tag{4.19} \\end{equation}\\] which simplifies to: \\[\\begin{equation} Pr(i) = \\frac{1}{\\exp(0) + \\exp(V_{SR}-V_{DA}) + \\exp(V_{TR}-V_{DA})} \\tag{4.20} \\end{equation}\\] This formulation explicitly shows that the probability of the drive alone alternative is a function of the differences in systematic utility between the drive alone alternative and each other alternative. This can be applied to the general case for alternative \\(i\\) which can be represented in terms of the pairwise difference in its utility and the utility of each of the other alternatives by the following equation: \\[\\begin{equation} Pr(i) = \\frac{1}{1 + \\sum_{j \\ne i}\\exp(V_j - V_i)} \\qquad \\forall i \\in J \\tag{4.21} \\end{equation}\\] 4.1.2.1 Implication of Constant Differences for Alternative Specific Constants and Variables The constant difference property of logit models has an important implication for the specification of the utilities of the alternatives. Recall that the systematic portion of the utility of an individual, ‘\\(t\\),’ and alternative ‘\\(i\\)’ is the sum of decision-maker related bias, mode attribute related utility, and interactions between these. That is: \\[\\begin{equation} V_{DA} = V_{DA}(S_t) + V(X_{DA}) + V(S_t,X_{DA}) \\tag{4.22} \\end{equation}\\] \\[\\begin{equation} V_{SR} = V_{SR}(S_t) + V(X_{SR}) + V(S_t,X_{SR}) \\tag{4.23} \\end{equation}\\] \\[\\begin{equation} V_{TR} = V_{TR}(S_t) + V(X_{TR}) + V(S_t,X_{TR}) \\tag{4.24} \\end{equation}\\] Each term on the right hand side of each equation can be replaced by an explicit function of the relevant variables. For example, if the decision-maker preferences are a function of income, attribute based utility is a function of travel time and there are no interaction terms, the utility function becomes: \\[\\begin{equation} V_{DA} = \\beta_{DA,0} + \\beta_{DA,1} \\times Income_t + \\gamma \\times TT_{DA} \\tag{4.25} \\end{equation}\\] \\[\\begin{equation} V_{SR} = \\beta_{SR,0} + \\beta_{SR,1} \\times Income_t + \\gamma \\times TT_{SR} \\tag{4.26} \\end{equation}\\] \\[\\begin{equation} V_{TR} = \\beta_{TR,0} + \\beta_{TR,1} \\times Income_t + \\gamma \\times TT_{TR} \\tag{4.27} \\end{equation}\\] and the differences between pairs of alternatives for prediction of DA probability become: \\[\\begin{equation} \\begin{split} V_{SR} - V_{DA} = (\\beta_{SR,0} - \\beta_{DA,0}) + \\beta_{SR,1} - \\beta_{DA,1})\\\\ \\times Income_t + \\gamma \\times (TT_{SR} - TT_{DA}) \\end{split} \\tag{4.28} \\end{equation}\\] \\[\\begin{equation} \\begin{split} V_{TR} - V_{DA} = (\\beta_{TR,0} - \\beta_{DA,0}) + \\beta_{TR,1} - \\beta_{DA,1})\\\\ \\times Income_t + \\gamma \\times (TT_{TR} - TT_{TA}) \\end{split} \\tag{4.29} \\end{equation}\\] It is not possible to estimate all of the constants; \\(\\beta_{DA,0}\\), \\(\\beta_{SR,0}\\) and \\(\\beta_{TR,0}\\); and all of the income parameters; \\(\\beta_{DA,1}\\), \\(\\beta_{SR,1}\\) and \\(\\beta_{TR,1}\\); in these equations because adding any algebraic value to each of the constants or to each of the income parameters does not cause any change in the probabilities of any of the alternatives. This phenomenon is common to all utility-based choice models and follows directly from the equivalent differences property discussed above. The solution to this problem is to place a single constraint on each set of parameters; in this case, the constants and the income parameters. Any constraint can be adopted for each set of parameters; however, the simplest and most widely used is to set the preference related parameters for one alternative, called the base or reference alternative, to zero and to re-interpret the remaining parameters to represent preference differences relative to the base alternative. The selection of the reference alternative is arbitrary and does not affect the overall quality or interpretation of the model; however, the equations and the estimation results will appear to be different. For example, if we set TRansit as the reference alternative by setting \\(\\beta_{TR,0}\\) and \\(\\beta_{TR,1}\\) equal to zero, the utility functions become: \\[\\begin{equation} V_{DA,t} = \\beta_{DA-TR,0} + \\beta_{DA-TR,1} \\times Inc_t + \\gamma \\times TT_{DA} \\tag{4.30} \\end{equation}\\] \\[\\begin{equation} V_{SR,t} = \\beta_{SR-TR,0} + \\beta_{SR-TR,1} \\times Inc_t + \\gamma \\times TT_{SR} \\tag{4.31} \\end{equation}\\] \\[\\begin{equation} V_{TR,t} = \\qquad \\qquad \\qquad 0 \\qquad \\qquad \\qquad + \\gamma \\times TT_{TR} \\tag{4.32} \\end{equation}\\] where the modified notation for the remaining constants and income parameters is used to emphasize that these parameters are ‘relative to the TRansit alternative.’ Alternatively, if we select Drive Alone as the reference alternative, we obtain: \\[\\begin{equation} V_{DA,t} = \\qquad \\qquad \\qquad 0 \\qquad \\qquad \\qquad + \\gamma \\times TT_{DA} \\tag{4.33} \\end{equation}\\] \\[\\begin{equation} V_{SR,t} = \\beta_{SR-DA,0} + \\beta_{SR-DA,1} \\times Inc_t + \\gamma \\times TT_{SR} \\tag{4.34} \\end{equation}\\] \\[\\begin{equation} V_{TR,t} = \\beta_{TR-DA,0} + \\beta_{TR-DA,1} \\times Inc_t + \\gamma \\times TT_{TR} \\tag{4.35} \\end{equation}\\] where the constants and income parameters are relative to the Drive Alone alternative. These two models are equivalent as shown in Table ?? and Table ?? which correspond to the TRansit reference and Drive Alone reference examples, respectively, for an individual from a household with $50,000 annual income and facing travel times of 30, 35 and 50 minutes for Drive Alone, Shared Ride and TRansit, respectively. utility_table( c(&quot;Drive Alone&quot; = &quot;1.1 + 0.008 * 50 - 0.02 * 30&quot;, &quot;Shared Ride&quot; = &quot;0.8 + 0.006 * 50 - 0.02 * 35&quot;, &quot;Transit&quot; = &quot;0.0 + 0.000 * 50 - 0.02 * 50&quot;) ) %&gt;% kableExtra::kbl(caption = &quot;Utility and Probability calculation with TRansit as Base Alternative&quot;) %&gt;% kable_styling() %&gt;% add_header_above(c(&quot; &quot;=1, &quot;Utility&quot; = 2, &quot; &quot; = 2), align = &quot;center&quot;) Table 4.5: Utility and Probability calculation with TRansit as Base Alternative Utility Alternative Expression Value Exponent Probability Drive Alone 1.1 + 0.008 * 50 - 0.02 * 30 0.9 2.4596031 0.5694439 Shared Ride 0.8 + 0.006 * 50 - 0.02 * 35 0.4 1.4918247 0.3453852 Transit 0.0 + 0.000 * 50 - 0.02 * 50 -1.0 0.3678794 0.0851709 Total NA 4.3193072 1.0000000 where the sum of the exponent variable equals 4.319. utility_table( c( &quot;Drive Alone&quot; = &quot;0.0 + 0.000 * 50 - 0.02 * 30&quot;, &quot;Shared Ride&quot; = &quot;-0.3 - 0.002 * 50 - 0.02 * 35&quot;, &quot;Transit&quot; = &quot;-1.1 - 0.008 * 50 - 0.02 * 50&quot;) ) %&gt;% kableExtra::kbl(caption = &quot;Utility and Probability calculation with TRansit as Base Alternative&quot;) %&gt;% kable_styling() %&gt;% add_header_above(c(&quot; &quot;=1, &quot;Utility&quot; = 2, &quot; &quot; = 2), align = &quot;center&quot;) Table 4.6: Utility and Probability calculation with TRansit as Base Alternative Utility Alternative Expression Value Exponent Probability Drive Alone 0.0 + 0.000 * 50 - 0.02 * 30 -0.6 0.5488116 0.5694439 Shared Ride -0.3 - 0.002 * 50 - 0.02 * 35 -1.1 0.3328711 0.3453852 Transit -1.1 - 0.008 * 50 - 0.02 * 50 -2.5 0.0820850 0.0851709 Total NA 0.9637677 1.0000000 where the sum of the exponent variable equals 0.964. As expected, the resultant probabilities are identical in both cases. Table 4 7 shows that the differences in the alternative specific constants and income parameters between alternatives are the same for the TRansit base case and the Drive Alone base case. tibble( &quot;Alternative&quot;= c(&quot;Drive Alone&quot;, &quot;Shared Ride&quot;, &quot;Transit&quot;), &quot;Constant&quot; = c(&quot;1.1&quot;,&quot;0.8&quot;,&quot;0.0&quot;), &quot;Income&quot; = c(&quot;0.008&quot;, &quot;0.006&quot;, &quot;0.000&quot;), &quot;Constant &quot; = c(&quot;-1.1&quot;,&quot;-1.1&quot;,&quot;-1.1&quot;), &quot;Income &quot; = c(&quot;-0.008&quot;, &quot;-0.008&quot;, &quot;-0.008&quot;), &quot;Constant &quot; = c(&quot;0.0&quot;,&quot;-0.3&quot;,&quot;-1.1&quot;), &quot;Income &quot; = c(&quot;0.000&quot;, &quot;-0.002&quot;, &quot;-0.008&quot;)) %&gt;% kbl(caption = &quot;Changes in Alternative Specific Constants and Income Parameters&quot;) %&gt;% kable_styling() %&gt;% add_header_above(c(&quot; &quot; = 1, &quot;TRansit as Base Alternative&quot;= 2, &quot;Change in Parameters&quot; = 2, &quot;Drive Alone as Base Alternative&quot; = 2), align = &quot;center&quot;) Table 4.7: Changes in Alternative Specific Constants and Income Parameters TRansit as Base Alternative Change in Parameters Drive Alone as Base Alternative Alternative Constant Income Constant Income Constant Income Drive Alone 1.1 0.008 -1.1 -0.008 0.0 0.000 Shared Ride 0.8 0.006 -1.1 -0.008 -0.3 -0.002 Transit 0.0 0.000 -1.1 -0.008 -1.1 -0.008 4.2 Independence of Irrelevant Alternatives Property One of the most widely discussed aspects of the multinomial logit model is its independence from irrelevant alternatives (IIA) property. The IIA property states that for any individual, the ratio of the probabilities of choosing two alternatives is independent of the presence or attributes of any other alternative. The premise is that other alternatives are irrelevant to the decision of choosing between the two alternatives in the pair. To illustrate this, consider a multinomial logit model for the choice among three intercity travel modes – automobile, rail, and bus. The probability of choosing automobile, rail and bus are: \\[\\begin{equation} Pr(Auto) = \\frac{\\exp(V_{Auto})}{\\exp(V_{Auto})+\\exp(V_{Bus})+\\exp(V_{Rail})} \\tag{4.36} \\end{equation}\\] \\[\\begin{equation} Pr(Bus) = \\frac{\\exp(V_{Bus})}{\\exp(V_{Auto})+\\exp(V_{Bus})+\\exp(V_{Rail})} \\tag{4.37} \\end{equation}\\] \\[\\begin{equation} Pr(Rail) = \\frac{\\exp(V_{Rail})}{\\exp(V_{Auto})+\\exp(V_{Bus})+\\exp(V_{Rail})} \\tag{4.38} \\end{equation}\\] The ratios of each pair of probabilities are: \\[\\begin{equation} \\frac{Pr(Auto)}{Pr(Bus)} = \\frac{\\exp(V_{Auto})}{\\exp(V_{Bus})} = \\exp(V_{Auto} - V_{Bus}) \\tag{4.39} \\end{equation}\\] \\[\\begin{equation} \\frac{Pr(Auto)}{Pr(Rail)} = \\frac{\\exp(V_{Auto})}{\\exp(V_{Rail})} = \\exp(V_{Auto} - V_{Rail}) \\tag{4.40} \\end{equation}\\] \\[\\begin{equation} \\frac{Pr(Bus)}{Pr(Rail)} = \\frac{\\exp(V_{Bus})}{\\exp(V_{Rail})} = \\exp(V_{Bus} - V_{Rail}) \\tag{4.41} \\end{equation}\\] The ratios of probabilities for each pair of alternatives depend only on the attributes of those alternatives and not on the attributes of the third alternative and would remain the same regardless of whether that third alternative is available or not. This formulation can be generalized to any pair of alternatives by: \\[\\begin{equation} \\frac{Pr(i)}{Pr(k)} = \\frac{\\exp(V_i)}{\\exp(V_k)} = \\exp(V_i - V_k) \\tag{4.42} \\end{equation}\\] which, as before, is independent of the number or attributes of other alternatives in the choice set. The IIA property has some important ramifications in the formulation, estimation and use of multinomial logit models. The independence of irrelevant alternatives property allows the addition or removal of an alternative from the choice set without affecting the structure or parameters of the model. The flexibility of applying the model to cases with different choice sets has a number of advantages. First, the model can be estimated and applied in cases where different members of the population (and sample) face different sets of alternatives. For example, in the case of intercity mode choice, individuals traveling between some city pairs may not have air service and/or rail service. Second, this property simplifies the estimation of the parameters in the multinomial logit model (as will be discussed later). Third, this property is advantageous when applying a model to the prediction of choice probabilities for a new alternative. On the other hand, the IIA property may not properly reflect the behavioral relationships among groups of alternatives. That is, other alternatives may not be irrelevant to the ratio of probabilities between a pair of alternatives. In some cases, this will result in erroneous predictions of choice probabilities. An extreme example of this problem is the classic “red bus/blue bus paradox.” 4.2.1 The Red Bus/Blue Bus Paradox Consider the case of a commuter who has a choice of going to work by auto or taking a blue bus. Assume that the attributes of the auto and the blue bus are such that the probability of choosing auto is two-thirds and blue bus is one-third so the ratio of their choice probabilities is 2:1. Now suppose that a competing bus operator introduces red bus service (the bus is painted red, rather than blue) on the same route, operating the same vehicle type, using the same schedule and serving the same stops as the blue bus service. Thus, the only difference between the red and blue bus services is the color of the buses. The most reasonable expectation, in this case, is that the same share of people will choose auto and bus and that the bus riders will split equally between the red and blue bus services. That is, the addition of the red bus to the commuters’ choice set should have no, or very little, effect on the share of commuters choosing auto since this change does not affect the relative quality of drive alone and bus. Therefore, we expect choice probabilities following the initiation of red bus service to be auto, two-thirds; blue bus, one-sixth and red bus, one-sixth. However, due to the IIA property, the multinomial logit model will maintain the relative probability of auto and blue bus as 2:1. If we assume that people are indifferent to color of their transit vehicle, the two bus services will have the same representative utility and consequently, their relative probabilities will be 1:1 and the share probabilities for the three alternatives will be: Pr(Auto) = ½, Pr(Blue Bus) = 1/4, and Pr(Red Bus) = 1/4. That is, the probability (share) of people choosing auto will decline from two-thirds to one half as a result of introducing an alternative which is identical to an existing alternative5. The red bus/blue bus paradox provides an important illustration of the possible consequences of the IIA property. Although this is an extreme case; the IIA property can be a problem in other, less extreme cases. 4.3 Example: Prediction with Multinomial Logit Model We illustrate the application of multinomial logit models with different specifications in the context of mode choice analysis. Consider a commute trip by an individual who has three available modes in the choice set: drive alone, carpool, and bus. The examples in this section illustrate the manner in which different utility specifications and the estimated parameters associated with them are used to predict choice probabilities based on characteristics of the traveler (decision-maker) and attributes of the alternatives. These examples progress from the simplest models to moderately complex models. Example 1 – Constants Only Model The simplest specification of the multinomial logit model is the ‘constants only’ model, in which the utility of each alternative has a fixed value for all decision-makers. Typically, the alternative specific constants are considered to represent the average effect of all factors that influence the choice but are not included in the utility specification. For example, factors such as comfort, safety, privacy and reliability may be excluded due to the difficulty associated with their measurement. In the constants only model, it is implicitly assumed that the constants reflect the average effects of all the variables affecting the choice decision, since no variables are included explicitly in the utility specification. If these constants are 0.0, -1.6 and -1.8 for drive alone, shared ride and transit, respectively, the probability calculation is as shown in Table 4.8. Table 4.8: MNL Properties for Constants Only Model Utility Alternative Expression Value Exponent Probability Drive Alone 0.0 0.0 1.0000000 0.7314243 Shared Ride -1.60 -1.6 0.2018965 0.1476720 Transit -1.80 -1.8 0.1652989 0.1209036 Total NA 1.3671954 1.0000000 As expected, Drive Alone has the highest probability, followed by Shared Ride, and TRansit. Example 2 – Including Mode Related Variables - Travel Time and Travel Cost Two key attributes that influence choice of mode are travel time and travel cost. We include these variables in the deterministic component of the utility function of each mode with the parameter for time (in minutes) equal to -0.045 and for cost (in cents) equal to -0.004 for all three modes, Table 4.9. This implies that a minute of travel time (or a cent of cost) has the same marginal disutility regardless of the mode; such variables are referred to as generic variables. The negative signs of the travel time and travel cost coefficients imply that the utility of a mode and the probability that it will be chosen decreases as the travel time or travel cost of that mode increases. Positive coefficients would be inconsistent with our understanding of travel behavior and therefore any specification which results in a positive sign for travel time or travel cost should be rejected. Such counter-intuitive results are most likely due to an incorrect or inadequate model specification; however, it is possible that the data from any particular sample leads to such counter-intuitive results. The inclusion of travel time and travel cost variables induces a change in the alternative specific constants, to -1.865 for shared ride and -0.650 for transit, as the effect of excluding these time and cost variables is removed from the constants. Such changes in alternative specific constants, as a result of the introduction of new variables or the elimination of included variables preserve the sample shares6 and are expected. To illustrate the application of the multinomial logit model for the above utility equation, we assume travel time and travel cost values as follows: Mode Travel Time Travel Cost Drive Alone 25 minutes $1.75 Shared Ride 28 minutes $0.75 TRansit 55 minutes $1.25 The utilities and probabilities are calculated as shown in Table 4.9. utility_table( c(&quot;Drive Alone&quot; = &quot;-0.045*25-0.004*175&quot;, &quot;Shared Ride&quot; = &quot;-1.865-0.045*28-0.004*75&quot;, &quot;Transit&quot; = &quot;-0.650-0.045*55-0.004*125&quot;) ) %&gt;% kbl(caption = &quot;MNL Probabilities for Time and Cost Model&quot;) %&gt;% kable_styling() %&gt;% add_header_above(c(&quot; &quot; = 1, &quot;Utility&quot;= 2, &quot; &quot; = 2), align = &quot;center&quot;) Table 4.9: MNL Probabilities for Time and Cost Model Utility Alternative Expression Value Exponent Probability Drive Alone -0.04525-0.004175 -1.825 0.1612176 0.7314243 Shared Ride -1.865-0.04528-0.00475 -3.425 0.0325493 0.1476720 Transit -0.650-0.04555-0.004125 -3.625 0.0266491 0.1209036 Total NA 0.2204160 1.0000000 This specification can be refined further by decomposing travel time into its two major components: (1) in-vehicle travel time, and (2) out-of-vehicle travel time. In-vehicle time (IVT) is defined as the time spent inside the vehicle, and out-of-vehicle time (OVT) is the time not spent inside the vehicle (including access time, waiting time, and egress time). There is an abundance of empirical evidence that travelers are much more sensitive to out-of-vehicle time than to in-vehicle time and therefore a minute of out-of-vehicle time will generate a higher disutility than a minute of in-vehicle time. This will be reflected in the modal utilities by a larger negative coefficient on out-of-vehicle time than on in-vehicle time. Introduction of this refinement will usually result in a less negative parameter for in vehicle time and a more negative parameter for out of vehicle time than for total time; say -0.031 and -0.062, respectively. If the travel times are split as follows: Mode IVT OVT Travel Cost Drive Alone 21 minutes 4 minutes $1.75 Shared Ride 23 minutes 5 minutes $0.75 Bus 25 minutes 30 minutes $1.25 the new systematic utilities and choice probabilities are as computed in Table 4.10: utility_table( c(&quot;Drive Alone&quot; = &quot;-0.031*21-0.062*4-0.004*175&quot;, &quot;Shared Ride&quot; = &quot;-1.90-0.031*23-0.062*5-0.004*75&quot;, &quot;Transit&quot; = &quot;-0.80-0.031*25-0.062*30-0.004*125&quot;) ) %&gt;% kbl(caption = &quot;MNL Probabilities for Time and Cost Model&quot;) %&gt;% kable_styling() %&gt;% add_header_above(c(&quot; &quot; = 1, &quot;Utility&quot;= 2, &quot; &quot; = 2), align = &quot;center&quot;) Table 4.10: MNL Probabilities for Time and Cost Model Utility Alternative Expression Value Exponent Probability Drive Alone -0.03121-0.0624-0.004*175 -1.599 0.2020985 0.7729036 Shared Ride -1.90-0.03123-0.0625-0.004*75 -3.223 0.0398354 0.1523460 Transit -0.80-0.03125-0.06230-0.004*125 -3.935 0.0195457 0.0747504 Total NA 0.2614796 1.0000000 Example 3 – Including Decision-Maker Related Biases - Income The preceding examples do not include any characteristics of the traveler in the modal utilities. However, we know that choice probabilities of the available modes also depend on characteristics of the traveler, such as his/her income. Economic theory and empirical evidence suggests that higher income travelers are less likely to choose transit than drive alone or carpool. We can incorporate this behavior in the model by including an alternative specific income variable in the utility of up to two of the alternatives; in this case, we include income in the transit alternative with a negative coefficient. That is, everything else held constant, the utility of transit decreases as the income of the traveler increases. Consequently, a higher income traveler will have a lower probability of choosing transit than a lower income traveler. The absence of an alternative specific parameter for the carpool alternative implies that the choice of carpool, relative to drive alone, is unaffected by a traveler’s income. The alternative specific constant of the transit utility changes substantially from the preceding example as it no longer reflects the average effect of excluding income from the transit utility specification. The calculation of utilities and probabilities for this model for a person from a household with $50,000 annual income is shown in 4.11. utility_table( c(&quot;Drive Alone&quot; = &quot; -0.031*21-0.062*4-0.004*175&quot;, &quot;Shared Ride&quot; = &quot;-1.90-0.031*23-0.062*5-0.004*75&quot;, &quot;Transit&quot; = &quot;-0.50-0.031*25-0.062*30-0.004*125-0.0087*50&quot;) ) %&gt;% kbl(caption = &quot;MNL Probabilities for In and Out of Vehicle Time, Cost and Income Model&quot;) %&gt;% kable_styling() %&gt;% add_header_above(c(&quot; &quot; = 1, &quot;Utility&quot;= 2, &quot; &quot; = 2), align = &quot;center&quot;) Table 4.11: MNL Probabilities for In and Out of Vehicle Time, Cost and Income Model Utility Alternative Expression Value Exponent Probability Drive Alone -0.03121-0.0624-0.004*175 -1.599 0.2020985 0.7802692 Shared Ride -1.90-0.03123-0.0625-0.004*75 -3.223 0.0398354 0.1537978 Transit -0.50-0.03125-0.06230-0.004125-0.008750 -4.070 0.0170774 0.0659330 Total NA 0.2590113 1.0000000 The probability of choosing transit is smaller for this traveler than would have been predicted using the model reported in the preceding example. This model will give decreasing transit probabilities for higher income travelers and increasing transit probabilities for lower income travelers. That is, the lower the traveler’s income, the greater his/her probability of choosing the least expensive mode of travel (transit), an intuitive and reasonable result. Example 4 – Interaction of Mode Attributes and Decision-Maker Related Biases An alternative method of including income in the utility specification is to use income as a deflator of cost by forming a variable by dividing cost by income. This formulation reflects the rationale that cost becomes a less important factor in the choice of a travel mode as the income of the traveler increases. The revised utility functions and calculations are shown in Table 4.12 using the values for the modal attributes and income as used in preceding example. utility_table( c(&quot;Drive Alone&quot; = &quot; -0.031*21-0.062*4-0.153*(175/50) &quot;, &quot;Shared Ride&quot; = &quot; -1.90-0.031*23-0.062*5-0.153*(75/50) &quot;, &quot;Transit&quot; = &quot;-0.45-0.031*25-0.062*30-0.153*(125/50)&quot;) ) %&gt;% kbl(caption = &quot;MNL Probabilities for In and Out of Vehicle Time, Cost/Income Model&quot;) %&gt;% kable_styling() %&gt;% add_header_above(c(&quot; &quot; = 1, &quot;Utility&quot;= 2, &quot; &quot; = 2), align = &quot;center&quot;) Table 4.12: MNL Probabilities for In and Out of Vehicle Time, Cost/Income Model Utility Alternative Expression Value Exponent Probability Drive Alone -0.03121-0.0624-0.153*(175/50) -1.4345 0.2382345 0.7631451 Shared Ride -1.90-0.03123-0.0625-0.153*(75/50) -3.1525 0.0427451 0.1369270 Transit -0.45-0.03125-0.06230-0.153*(125/50) -3.4675 0.0311949 0.0999278 Total NA 0.3121745 1.0000000 This specification of income in the utility function also results in lower income travelers predicted to have higher probability of choosing transit; it also suggests that such travelers will increase their probability of choosing carpool, the least expensive mode. The reader should compute the probabilities for different income values and verify the response pattern. 4.4 Measures of Response to Changes in Attributes of Alternatives Choice probabilities in logit models are a function of the values of the attributes that define the utility of the alternatives; therefore, it is useful to know the extent to which the probabilities change in response to changes in the value of those attributes. For example, in a traveler’s mode choice decision, an important question is to what extent the probability of choosing a mode (rail, for example) will decrease/increase, if the fares of that mode are increased by a certain amount. Similarly, a transit agency may want to know the gain in ridership that is likely to occur in response to service improvements (increased frequency). This section describes various aspects of understanding and quantifying the response to changes in attributes of alternatives. 4.4.1 Derivatives of Choice Probabilities One measure for evaluating the response to changes is to calculate the derivatives of the choice probabilities of each alternative with respect to the variable in question. Usually, one is concerned about the change in probability of an alternative, \\(P_i\\), with respect to the change in attributes of that alternative \\(X_i\\). This measure, the direct derivative, is computed by differentiating \\(P_i\\) with respect to \\(X_{ik}\\), the \\(k^{th}\\) attribute of alternative \\(i\\). The mathematical expression for the direct derivative of \\(P_i\\) with respect to \\(X_{ik}\\) is: \\[\\begin{equation} \\displaystyle \\frac{\\partial P_{i}}{\\partial X_{ik}} = \\displaystyle \\frac{\\partial V_{i}}{\\partial X_{ik}} \\times (P_{i}) \\times (1-P_{i}) \\tag{4.43} \\end{equation}\\] where \\(V_i\\) is the utility of the alternative.7 Typically the utility function is specified to be linear in parameters; that is: \\[\\begin{equation} V_{i} = \\beta_{0} + \\beta_{1}X_{1i} + \\beta_{2}X_{2i} + \\cdots + \\beta_{k}X_{ki} + \\cdots + \\beta_{K}X_{Ki} \\tag{4.44} \\end{equation}\\] In this case, the expression for the direct derivative of \\(P_i\\) with respect to \\(X_{ik}\\) reduces to: \\[\\begin{equation} \\displaystyle \\frac{\\partial P_{i}}{\\partial X_{ki}} = \\beta_{k} \\times (P_{i}) \\times (1-P_{i}) \\tag{4.45} \\end{equation}\\] where \\(\\beta_{k}\\) is the coefficient of attribute \\(k\\). The value of the derivative is largest at \\(P_{i} = \\frac{1}{2}\\) and becomes smaller as \\(P_{i}\\) approaches zero or one. This implies that the magnitude of the response to a change in an attribute will be greatest when the choice probability for the alternative under consideration is 0.5 and this response diminishes as the probability approaches zero or one. The direct derivative is simply the slope of the logit model probability curve illustrated in Figure 4.4 and that its mathematical properties are consistent with the qualitative discussion of the S-shape of the logit probability curve in section 4.1.1. The sign of the derivative is the same as the sign of the parameter describing the impact of \\(X_{ik}\\) in the utility of alternative \\(i\\). Thus, an increase in \\(X_{ik}\\) will increase (decrease) \\(P_{i}\\) if \\(\\beta_{ik}\\) is positive (negative). Often it is important to understand how the choice probability of other alternatives changes in response to a given change in the attribute level of the action alternative. This measure, termed the \\(cross\\) \\(derivative\\), is obtained by computing the derivative of the choice probability of an alternative,\\(P_{j}\\) , with respect to the attribute of the changed alternative, \\(X_{ik}\\). This \\(cross\\) \\(derivative\\) for linear utility functions is:8 \\[\\begin{equation} \\displaystyle \\frac{\\partial P_{i}}{\\partial X_{ki}} = \\beta_{k} \\times (P_{i}) \\times (1-P_{j}) \\tag{4.46} \\end{equation}\\] Often it is important to understand how the choice probability of other alternatives changes in response to a given change in the attribute level of the action alternative. This measure, termed the cross derivative, is obtained by computing the derivative of the choice probability of an alternative, \\(P_j\\), with respect to the attribute of the changed alternative, \\(X_{ik}\\). This cross derivative for linear utility functions is: \\[\\begin{equation} \\displaystyle \\frac{\\partial P_{j}}{\\partial X_{ik}} = \\beta_{k} \\times (P_{i}) \\times (P_{j}) \\forall_{i} \\ne j \\tag{4.47} \\end{equation}\\] where \\(\\beta_{jk}\\) is the coefficient of the \\(k^{th}\\) attribute of alternative \\(j\\), \\(P_{i}\\) is the probability of alternative \\(i\\), and \\(P_{j}\\) is the probability of alternative \\(j\\). In this case, the sign of the derivative is opposite to the sign of the parameter describing the impact of \\(X_{ik}\\) on the utility of alternative \\(i\\). Thus an increase in \\(X_{ik}\\) will decrease (increase) the probability of choosing alternative, \\(P_{i}\\), if the parameter \\(\\beta_{k}\\) is positive (negative). In this case, the sign of the derivative is opposite to the sign of the parameter describing the impact of \\(X_{ik}\\) on the utility of alternative \\(i\\). Thus an increase in \\(X_{ik}\\) will decrease (increase) the probability of choosing alternative, \\(P_j\\), if the parameter \\(\\beta_k\\) is positive (negative). It is useful to recognize that the sum of the derivatives over all the alternatives must be equal to zero. That is, \\[\\begin{align} \\sum_{\\forall_{j}}\\frac{\\partial P_{j}}{\\partial X_{ik}}&amp;= \\frac{\\partial P_{j}}{\\partial X_{ik}} + \\sum_{\\forall_{j \\ne i}}\\frac{\\partial P_{j}}{\\partial X_{ik}}\\\\ &amp;= \\beta_{k}P_{i}(1-P_{i}) - \\sum_{\\forall_{j \\ne i}}\\beta_{k}P_{i}P_{j}\\\\ &amp;= \\beta_{k}P_{i}(1-P_{i}) - \\beta_{k}P_{i}\\sum_{\\forall_{j \\ne i}}P_{j}\\\\ &amp;= \\beta_{k}P_{i}(1-P_{i}) - \\beta_{k}P_{i}(1-P_{i})\\\\ &amp;= 0 \\tag{4.48} \\end{align}\\] This is as expected. Since the sum of all probabilities is fixed at one, the sum of the derivatives of the probability due to a change in any attribute of any alternative must be equal to zero. 4.4.2 Elasticities of Choice Probabilities Elasticity is another measure that is used to quantify the extent to which the choice probabilities of each alternative will change in response to the changes in the value of an attribute. In general, elasticity is defined as the percentage change in the response variable with respect to a one percent change in an explanatory variable. In the context of logit models, the response variable is the choice probability of an alternative, such as \\(P_i\\), and the explanatory variable is the attribute \\(X_{ik}\\). Elasticities are different from derivatives in that elasticities are normalized by the variable units. To clearly illustrate the concept of elasticity, let us consider that \\(P_{i1}\\) and \\(P_{i2}\\) are choice probabilities of an alternative \\(i\\) at attribute levels \\(X_{i1}\\) and \\(X_{i2}\\), respectively. In this case, the elasticity is the proportional change in the probability divided by the proportional change in the attribute under consideration: \\[\\begin{equation} \\text{Elasticity} = \\frac{\\text{Pct Change in Probability}}{\\text{Pct Change in Variable}} = \\frac{(P_{2}-P_{1})/P_{1}}{(X_{2}-X_{1})/X_{1}} = \\frac{\\Delta P/P_{1}}{\\Delta X/X_{1}} \\tag{4.49} \\end{equation}\\] There is some ambiguity in the computation of this elasticity measure in terms of whether it should be normalized using the original probability-attribute combination (\\(P_{i1}\\), \\(X_{i1}\\) ) or the new probability-attribute combination (\\(P_{i2}\\), \\(X_{i2}\\)). A compromise approach is to compute the elasticity relative to the mid-point of both sets of variables, yielding a measure called the arc elasticity. The expression for arc elasticity is: There is some ambiguity in the computation of this elasticity measure in terms of whether it should be normalized using the original probability-attribute combination (\\(P_{i1}\\), \\(X_{i1}\\)) or the new probability-attribute combination (\\(P_{i2}\\), \\(X_{i2}\\)). A compromise approach is to compute the elasticity relative to the mid-point of both sets of variables, yielding a measure called the arc elasticity. The expression for arc elasticity is: \\[\\begin{equation} \\displaystyle Arc Elasticity = \\frac{\\Bigg(\\frac{(P_{2}-P_{1})}{(P_{1}+P_{2})/2)}\\Bigg)}{\\Bigg(\\frac{(X_{2}-X_{1})}{(X_{1}+X_{2})/2)}\\Bigg)} = \\frac{\\Bigg(\\frac{(\\Delta P)}{(P_{1}+P_{2})/2)}\\Bigg)}{\\Bigg(\\frac{(\\Delta X)}{(X_{1}+X_{2})/2)}\\Bigg)} \\tag{4.50} \\end{equation}\\] Estimates of elasticity will differ depending on whether the normalization is at the start value, final value or mid-point values. This confusion can be avoided by computing elasticities for \\(\\underline{very\\ small}\\) changes. When the elasticity is computed for infinitesimally small changes, the elasticity obtained is termed the point elasticity. The expression for point elasticity is given as a function of the derivatives discussed earlier (section 4.4.1): \\[\\begin{equation} \\displaystyle \\eta_{X}^{P} = \\frac{\\Bigg(\\frac{\\partial P}{P}\\Bigg)}{\\Bigg(\\frac{\\partial X}{X}\\Bigg)} = \\Bigg(\\frac{\\partial P}{\\partial X}\\Bigg) \\times \\Bigg(\\frac{X}{P}\\Bigg) \\tag{4.51} \\end{equation}\\] Estimates of elasticity will differ depending on whether the normalization is at the start value, final value or mid-point values. This confusion can be avoided by computing elasticities for very small changes. When the elasticity is computed for infinitesimally small changes, the elasticity obtained is termed the point elasticity. The expression for point elasticity is given as a function of the derivatives discussed earlier (section 4.4.1): \\[\\begin{equation} \\displaystyle \\eta_{X_{ik}}^{P_{i}} = \\frac{\\Bigg(\\frac{\\partial P_{i}}{P}\\Bigg)}{\\Bigg(\\frac{\\partial X_{ik}}{X_{ik}}\\Bigg)} = \\Bigg(\\frac{\\partial P_{i}}{\\partial X_{ik}}\\Bigg) \\times \\Bigg(\\frac{X_{ik}}{P_{i}}\\Bigg) \\tag{4.52} \\end{equation}\\] We are interested in both direct- and cross-elasticities corresponding to the direct- and cross-derivatives discussed above. The direct elasticity measures the percent change in the choice probability of alternative, \\(P_i\\) with respect to a percent change in the attribute level (\\(X_{ik}\\)) of that alternative: We can substitute equation 4.45 into 4.51 to obtain the following expression for the direct elasticity \\[\\begin{equation} \\displaystyle \\eta_{X_{ik}}^{P_{i}} = \\beta_{k}P_{i}(1-P_{i})\\Bigg(\\frac{X_{ik}}{P_{i}}\\Bigg) = \\beta_{k}X_{ik}(1-P_{i}) \\tag{4.53} \\end{equation}\\] Thus, the direct elasticity is not only a function of the parameter value, \\(\\beta_{k}\\), for the attribute in the utility, but is also a function of the attribute level, \\(X_{ik}\\), at which the elasticity is being computed. Thus, the direct elasticity is not only a function of the parameter value, \\(\\beta_k\\), for the attribute in the utility, but is also a function of the attribute level, \\(X_{ik}\\), at which the elasticity is being computed. Similarly, the cross-elasticity is defined as the proportional change in the choice probability of an alternative (\\(P_j\\)) with respect to a proportional change in some attribute of another alternative (\\(X_{ik}\\)). The expression for cross elasticity in a multinomial logit model is given by: \\[\\begin{equation} \\displaystyle \\eta_{X_{ik}}^{P_{j}} = \\frac{\\Bigg(\\frac{\\partial P_{j}}{P_{j}}\\Bigg)}{\\Bigg(\\frac{\\partial X_{ik}}{X_{ik}}\\Bigg)} = \\Bigg(\\frac{\\partial P_{j}}{\\partial X_{ik}}\\Bigg) \\times \\Bigg(\\frac{X_{ik}}{P_{j}}\\Bigg) \\ \\forall j\\ne i \\tag{4.54} \\end{equation}\\] We substitute equation 4.46 into 4.53 to obtain the following expression for cross elasticity of logit model probabilities: \\[\\begin{equation} \\displaystyle \\eta_{X_{ik}}^{P_{i}} = (-\\beta_{k}P_{i}P_{j})\\Bigg(\\frac{X_{ik}}{P_{j}}\\Bigg) = -\\beta_{k}X_{ik}P_{i} \\tag{4.55} \\end{equation}\\] An important property of MNL models is that the cross-elasticities are the same for all the other alternatives in the choice set. This property of the multinomial logit model is another manifestation of the IIA property discussed in the previous section. The elasticity expressions derived above are based on the assumption that the independent variables for which the elasticities are being derived are continuous variables (e.g., travel time and travel cost). However, if the variable of interest is discrete in nature (e.g., number of automobiles in a household), it is not differentiable by definition. For this reason, derivatives can not be derived for ordinal or categorical variables. An alternative is to calculate the incremental change is each probability with respect to a one unit change in an ordered variable or a category shift for categorical variables and to use the differences to compute arc elasticities. 4.5 Measures of Responses to Changes in Decision Maker Characteristics Choice probabilities in logit models are also a function of the values of the characteristics of the decision maker (traveler). Therefore, it is equally useful to know the extent to which the probabilities of alternatives change in response to changes in the value of these characteristics. For example, in a traveler’s mode choice decision, an important question is to what extent the probability of choosing a mode will decrease/increase, if the income of the traveler changes by a certain amount. This section formulates both the derivatives and elasticity equations for evaluating such responses and thereby provides understanding and quantifies the response to changes in the characteristics of travelers. 4.5.1 Derivatives of Choice Probabilities Derivatives indicate the change in probability of each alternative in the choice set per unit change in a characteristic of the traveler. The analysis approach is similar to that employed in section 4.4. The important difference is that in section 4.4, we were assessing the impact of a change in probability of an alternative in response to a change in an attribute of a single alternative; either the same alternative (direct-derivative and direct-elasticity) or another alternative (cross-derivative and cross-elasticity). In the case of traveler characteristics, those characteristics may appear in alternative specific form in all alternatives (except for one reference alternative). Thus, we are considering what, in effect, becomes a combination of one direct response and multiple cross responses. Consider, for example, the probability of choosing alternative \\(i\\) in response to a change in income, specific to alternative \\(i\\). That is, \\[\\begin{equation} \\frac{\\partial P_i}{\\partial Inc_i} = (1 - P_i)P_i\\beta_{Inc_i} \\tag{4.56} \\end{equation}\\] However, since an identical change in income will occur for all alternatives in which income appears as an alternative specific variable, we consider the cross-derivative of the probability of choosing alternative \\(i\\) in response to a change in income, specific to alternative \\(j\\). That is, \\[\\begin{equation} \\frac{\\partial P_i}{\\partial Inc_j} = -P_iP_j\\beta_{Inc,_j} \\tag{4.57} \\end{equation}\\] The corresponding sum over all alternatives \\(i \\ne j\\) is \\[\\begin{equation} \\sum_{j\\ne i}\\frac{\\partial P_i}{\\partial Inc_j} = -P_i\\sum_{j \\ne i}P_j\\beta_{Inc,_j} \\tag{4.58} \\end{equation}\\] and the sum over all alternatives including \\(i\\) is \\[\\begin{equation} \\begin{split} \\frac{\\partial P_i}{\\partial Inc} = P_i(1-P_i)\\beta_{Inc,_i}-\\sum_{j\\ne i}P_iP_j\\beta_{Inc,_j}\\\\ = P_i\\beta_{Inc,_j} - \\sum_{\\forall j}P_iP_j\\beta_{Inc,_j}\\\\ = P_i[\\beta_{Inc,_i} - \\sum_{\\forall j}P_j\\beta_{Inc,_j}]\\\\ = P_i[\\beta_{Inc,_i} - \\overline{\\beta}_{Inc}]\\\\ \\end{split} \\tag{4.59} \\end{equation}\\] where \\(\\overline{\\beta}_{Inc}\\) is the probability weighted average of the alternative specific income parameters That is, the derivative of the probability with respect to a change in income is equal to the probability times the amount by which the income coefficient for that alternative exceeds the probability weighted average income coefficient over all alternatives9. It should be apparent that the sum over all alternatives of the income derivatives must be equal to one to ensure that the total probability over all alternatives is unchanged by any change in income. This can be shown by summing equation 4.58 over all alternatives in the choice set. 4.5.2 Elasticities of Choice Probabilities Elasticity is another measure that can be used to quantify the extent to which the choice probabilities are influenced by changes in a variable; in this case, a variable that describes the characteristics of the traveler. In this case, the elasticity of the probability of alternative \\(i\\) to a change in income is given by \\[\\begin{equation} \\eta_{Inc}^{P_i} = (\\beta_{Inc_i} - \\overline{\\beta}_{Inc}) \\times Inc \\tag{4.60} \\end{equation}\\] As before, the elasticity represents the proportional change in probability of an alternative to a proportional change in the explanatory variable. 4.6 Model Estimation: Concept and Method Logit model development consists of formulating model specifications and estimating numerical values of the parameters for the various attributes specified in each utility function by fitting the models to the observed choice data. The critical elements of this process become the selection of a preferred specification based on statistical measures and judgment. Under some circumstances, the model developer may impose constraints on the estimation to ensure desired relationships with respect to the relative value of different variables. 4.6.1 Graphical Representation of Model Estimation We illustrate the basic concepts of model estimation using a binary choice model with two variables and no constant. Consider that the only two modes available to a traveler are auto and bus and the deterministic component of the utility function for the two modes is defined as follows: \\[\\begin{equation} V_{Auto} = \\beta_1 \\times TravelTime_{Auto} + \\beta_{2} \\times TravelCost_{Auto} \\tag{4.61} \\end{equation}\\] \\[\\begin{equation} V_{Bus} = \\beta_1 \\times TravelTime_{Bus} + \\beta_{2} \\times TravelCost_{Bus} \\tag{4.62} \\end{equation}\\] Let us assume that in this example, bus has higher travel time and lower cost than car. For a traveler, the choice of travel mode will depend on his/her relative valuation of travel time and travel cost. A traveler who values time much more than cost will have a higher utility for car; whereas, a traveler who values time less than cost will have a higher utility for bus. This concept is illustrated in Figure 4.5 which shows the time and cost values for auto and bus iso-utility line10 for both types of travelers. When the iso-utility lines are steep enough to ensure that some iso-utility line is below bus and above car (case 1) implying a low value of time, bus will be the chosen mode. Conversely, if the iso-utility lines are flat enough to ensure that some iso-utility line is below car and above bus (case 2) implying a high value of time, car will be the chosen mode. The concept of iso-utility lines can be used to graphically describe the estimation of model parameters using observed choice data. This is illustrated in Figure 4.6 which shows the observed choice data for two travelers where each traveler has a choice between bus and car. The first traveler chooses bus (Bus 1) whereas the second traveler chooses car (Car 2). The objective is to find an iso-utility line with a slope that is steep enough to place Bus 1 above Car 1 and flat enough to place Bus 2 below Car 2. The figure shows that there many iso-utility lines with different slopes that satisfy the above conditions. However, even with only two observations, the range of the slopes of these lines is limited. The addition of more choice observation will further reduce the possible range of iso-utility lines. If all choosers are governed by the strict utility equations 4.60 and 4.61; additional observations will narrow the range of results to any satisfactory level of precision. However, as discussed previously, we expect that the analyst will not know all the variables that influence the traveler’s choice and/or will measure some variables differently than the user. Thus, it is unlikely that the observations can be separated by a single boundary. In this case, it becomes necessary to use an estimation method which scores different estimation results in terms of how well they identify the chosen alternatives. This is accomplished by using maximum likelihood estimation methods. The maximum likelihood method consists of finding model parameters which maximize the likelihood (posterior probability) of the observed choices conditional on the model. That is, to maximize the likelihood that the sample was generated from the model with the selected parameter values. 4.6.2 Maximum Likelihood Estimation Theory The procedure for maximum likelihood estimation involves two important steps: 1) developing a joint probability density function of the observed sample, called the likelihood function, and 2) estimating parameter values which maximize the likelihood function. The likelihood function for a sample of ‘T’ individuals, each with ‘J’ alternatives is defined as follows: \\[\\begin{equation} L(\\beta) = \\prod_{\\forall t \\in T} \\prod_{\\forall j \\in J}(P_{jt}(\\beta))^{\\delta_{jt}} \\tag{4.63} \\end{equation}\\] where \\(\\delta_{jt} = 1\\) is chosen indicator (\\(=1\\)if \\(j\\) is chosen by individual \\(t\\) and 0, otherwise) and \\(P_{jt}\\) is the probability that individual \\(t\\) chooses alternative \\(j\\). The values of the parameters which maximize the likelihood function are obtained by finding the first derivative of the likelihood function and equating it to zero. Since the log of a function yields the same maximum as the function and is more convenient to differentiate, we maximize the log-likelihood function instead of the likelihood function itself. The expressions for the log likelihood function and its first derivative are shown in equations (4.64) and (4.65) respectively: \\[\\begin{equation} LL(\\beta) = Log(L(\\beta)) = \\sum_{\\forall t \\in T} \\sum_{\\forall j \\in J} \\delta_{jt} \\times ln(P_{jt}(\\beta)) \\tag{4.64} \\end{equation}\\] \\[\\begin{equation} \\frac{\\partial (LL)}{\\partial \\beta_k} = \\sum_{\\forall t \\in T} \\sum_{\\forall j \\in J} \\delta_{jt} \\times \\frac{1}{P_{jt}} \\times \\frac{\\partial P_{jt}(\\beta)}{\\partial \\beta} \\qquad \\forall k \\tag{4.65} \\end{equation}\\]11 Further development of the derivative requires representation of the probability function, \\(P_{jt}\\), expanded from the version that appears in Equation 4.5 is \\[\\begin{equation} P_{jt}= \\frac{\\exp({X&#39;}_{jt}\\beta)}{\\sum_{j&#39;}\\exp({X&#39;}_{jt}\\beta)} \\tag{4.66} \\end{equation}\\] and the first derivative with respect to each element of \\(\\beta\\) is \\[\\begin{equation} \\frac{\\partial P_{jt}}{\\partial \\beta_k} = P_{jt}\\left({X&#39;}_{jkt}-\\sum_{j&#39;}P_{j&#39;t}X_{j&#39;kt}\\right) \\forall k \\tag{4.67} \\end{equation}\\]12 Substituting Equation (4.67) into Equation 4.64 gives \\[\\begin{equation} \\frac{\\partial (LL)}{\\partial \\beta_k} = \\sum_{\\forall t \\in T} \\sum_{\\forall j \\in J} \\delta_{jt} \\left({X&#39;}_{jt} - \\sum_{j&#39;t} P_{j&#39;t}X_{j&#39;t} \\right) \\\\ = \\sum_{\\forall t \\in T} \\sum_{\\forall j \\in J} (\\delta_{jt} - P_{j&#39;t}) {X&#39;}_{jt} \\forall k \\tag{4.68} \\end{equation}\\] for the derivative of the log-likelihood with respect to \\(\\beta_k\\). The maximum likelihood is obtained by setting Equation (4.68) equal to zero and solving for the best values of the parameter vector, \\(\\hat{\\beta}\\). We can be sure this is the solution for a maximum value provided that the second derivative is negative definite. In this case, the second derivative of the log-likelihood with respect to \\(\\beta\\) is \\[\\begin{equation} \\frac{\\partial^2 (LL)}{\\partial \\beta \\partial \\beta&#39;} = \\sum_{\\forall t \\in T} \\sum_{\\forall j \\in J} - P_{j&#39;t}({X&#39;}_{jt}-\\overline{X}_t)({X&#39;}_{jt}-\\overline{X}_t)&#39; \\tag{4.69} \\end{equation}\\] is negative definite for all values of \\(\\beta\\). Equations (4.68) and (4.69) are used to solve the maximum likelihood problem using a variety of available algorithms. In most practical problems, this involves significant computations and specialized computer programs to find the desired solution. The following example illustrates the application of maximum likelihood to estimate logit model parameters. 4.6.3 Example of Maximum Likelihood Estimation Suppose a logit model of binary choice between car and bus is to be estimated. For simplicity, let us assume the utility specification includes only the travel time variable and that the deterministic portion of the utility function for the two modes is defined as follows: \\[\\begin{equation} $\\displaystyle V_{Auto} = \\beta_{1} \\times Travel \\ Time_{Auto}$ \\tag{4.70} \\end{equation}\\] \\[\\begin{equation} $\\displaystyle V_{Bus} = \\beta_{1} \\times Travel \\ Time_{Bus}$ \\tag{4.71} \\end{equation}\\] Suppose that the estimation sample consists of observations of mode choice of only three individuals. The modal travel times and observed choice for each of the three individuals in the sample is as follows: Individual # Auto Travel Time Bus Travel Time Chosen Mode 1 30 minutes 50 minutes Car (mode 1) 2 20 minutes 10 minutes Car (mode 2) 3 40 minutes 30 minutes Bus (mode 2) According to the logit model, the probabilities for the observed mode for each individual are: \\[\\begin{align} \\text{Individual}_1 \\ (P_{11}) &amp;= \\frac{\\exp(30\\beta)}{\\exp(50\\beta)+\\exp(30\\beta)} = \\frac{1}{1+\\exp(20\\beta)} \\tag{4.72}\\\\ \\text{Individual}_2 (P_{12}) &amp;= \\frac{\\exp(20\\beta)}{\\exp(10\\beta)+\\exp(20\\beta)} = \\frac{1}{1+\\exp(-10\\beta)} \\tag{4.73}\\\\ \\text{Individual}_3 \\ (P_{23}) &amp;= \\frac{\\exp(30\\beta)}{\\exp(30\\beta)+\\exp(40\\beta)} = \\frac{1}{1+\\exp(10\\beta)} \\tag{4.74} \\end{align}\\] The log-likelihood expression for this sample will be as follows: \\[\\begin{align} LL &amp;= \\sum_{j=1,2}\\sum_{t=1,2,3}\\delta_{jt} \\times \\ln(P_{jt})\\\\ &amp;= 1 \\times \\ln(P_{11}) + 0 \\times \\ln(P_{21}) + 1 \\times \\ln(P_{12}) \\ldots \\\\ &amp;= \\ln(P_{11})+\\ln(P_{12})+\\ln(P_{23})\\\\ \\tag{4.75} \\end{align}\\] A maximum likelihood estimator finds the value of the parameter \\(\\beta\\) which maximizes the log-likelihood value. This solution is obtained by setting the first derivative of the log-likelihood function equal to zero, and solving for \\(\\hat{\\beta}\\). However, for this illustrative example, we can plot the graph for log-likelihood (or likelihood) as a function of \\(\\beta\\) to find the point where the maximum occurs. Figure 4.5 shows the graph of likelihood and log-likelihood as a function of \\(\\beta\\). It can be seen that the point where the maximum occurs is identical for both the likelihood and the log-likelihood functions, i.e., at \\(\\beta = -0.076\\). This value is called the maximum likelihood estimate of \\(\\beta\\). Practical applications of logit models include multiple parameters and many observations. Consequently, the maximum likelihood estimates for the parameters cannot be found graphically. Specialized software packages are available for this purpose. # calculate probabilities for example individuals demo_ps &lt;- function(beta){ v1a &lt;- beta * 30 v1t &lt;- beta * 50 p1 &lt;- exp(v1a) / (exp(v1t) + exp(v1a)) v2a &lt;- beta * 20 v2t &lt;- beta * 10 p2 &lt;- exp(v2a) / (exp(v2t) + exp(v2a)) v3a &lt;- beta * 40 v3t &lt;- beta * 30 p3 &lt;- exp(v3t) / (exp(v3t) + exp(v3a)) c(p1, p2, p3) } # calculate likelihood function demo_likelihood &lt;- function(beta) { ps &lt;- demo_ps(beta) prod(ps) } # calculate log-likelihood demo_loglikelihood &lt;- function(beta) { ps &lt;- demo_ps(beta) sum(log(ps)) } tibble( beta = seq(-0.2, 0, by = 0.001) ) %&gt;% rowwise() %&gt;% mutate( Likelihood = demo_likelihood(beta), `Log Likelihood` = demo_loglikelihood(beta) ) %&gt;% gather(likelihood, value, -beta) %&gt;% ggplot(aes(x = beta, y = value)) + geom_line() + xlab(expression(beta)) + ylab(&quot;Likelihood Function Value&quot;) + facet_grid(likelihood ~ ., scales = &quot;free_y&quot;) + theme_bw() Figure 4.5: Likelihood and log-likelihood as a function of a parameter value. These include numerical problems, because the MNP can only be calculated using multi-dimensional integration, and problems of interpretation. A special case of the MNP, when the error terms are distributed independently (no covariance) and identically (same variance), obtains estimation and prediction results that are very similar to those for the MNL model.↩︎ A model for which the probability can be calculated without use of numerical integration or simulation methods.↩︎ The exponent of a summation, \\(\\exp(A+B)\\), is equal to the product of the exponents of the elements in the sum, \\(\\\\exp(A) \\exp(B)\\) .↩︎ We use tables to illustrate calculation of the utility values and MNL probabilities. The first column shows the specification expression with appropriate values for variables and parameters, the second shows the calculated utility value, the third shows the exponent of the utility including the sum of the exponents, and the fourth shows the probability values.↩︎ This example ignores the increase in bus service frequency which might increase the probability of persons choosing bus; however, the increase is unlikely to be of the magnitude suggested by the IIA property.↩︎ In this case, we show the preservation of probabilities for the individual. In general, the individual probabilities are expected to change.↩︎ Interested readers are referred to train (1986) for a derivation and proof.↩︎ As before, interested readers are referred to Train (1986) for derivation and proof.↩︎ This comparison is independent of which alternative is chosen as the reference alternative since the effect of changing the reference alternative will be to increase each parameter by the same value.↩︎ Iso-utility lines connect all points for which the values of time and cost result in the same utility. The slope of these lines equals the inverse of the value of time, \\(\\beta_1/\\beta_2\\).↩︎ Dependence of \\(P_{j&#39;t}\\) on \\(b\\) is made implicit to simplify notation.↩︎ Dependence of \\(P_{j&#39;t}\\) on \\(b\\) is made implicit to simplify notation.↩︎ "],["estimation-chapter.html", "Chapter 5 Data Assembly and Estimation of Simple Multinomial Logit Models 5.1 Introduction 5.2 Data Requirements Overview 5.3 Sources and Methods for Traveler and Trip Related Data Collection 5.4 Methods for Collecting Mode Related Data 5.5 Data Structure for Estimation 5.6 Application Data for Work Mode Choice in the San Francisco Bay Area 5.7 Estimation of MNL Model with Basic Specification 5.8 Value of Time", " Chapter 5 Data Assembly and Estimation of Simple Multinomial Logit Models # packages used in this chapter library(tidyverse) # general data munging library(haven) # read spss data into R library(mlogit) # multinomial logit estimation library(modelsummary) # pretty tables library(kableExtra) # pretty tables library(labelled) # point labels # helping with book creation library(knitr) knitr::opts_chunk$set(cache = TRUE) 5.1 Introduction This chapter describes the estimation of basic specifications for the multinomial logit (MNL) model including the collection and organization of data required for model estimation. The chapter is organized as follows: Section 5.2 presents an overview of the data required to estimate mode choice models. Section 5.3 reviews data collection approaches for obtaining traveler and trip-related data. Section 5.4 discusses the methods for collecting data which describes the availability and service characteristics of the various modal alternatives. Section 5.5 illustrates two different data structures used by software packages for estimation of MNL and NL models. Section 5.6 describes the data used to estimate work mode choice model in the San Francisco Bay Region. Section 5.7 describes preliminary estimation results for mode choice to work based on this data and interpret these results in terms of judgment, descriptive measures and statistical tests. Section 5.8 goes into more detail on value of time estimates retrieved from choice models. CHAPTER 6 extends this example to the estimation of more sophisticated models. CHAPTER 7 develops a parallel example for shop/other mode choice in the San Francisco Bay Region. CHAPTER 9 extends the examples from previous chapters and explores nested logit models for work and shop/other trips in the San Francisco Bay Region. Additional examples based on data collected in different urban regions are presented in the appendices. 5.2 Data Requirements Overview The first step in the development of a choice model is to assemble data about traveler choice and the variables believed to influence that choice process. In the context of travel mode choice, such data include: Traveler and trip related variables that influence the travelers’ assessment of modal alternatives (e.g., income, automobile ownership, trip purpose, time of day of travel, origin and destination of trip, and travel party size), Mode related variables describing each alternative available to the traveler (e.g., travel time, travel cost and service frequency for carrier modes) and The observed or reported mode choice of the traveler (the “dependent” or “endogenous” variable). The first two categories of variables are selected to describe the factors which influence each decision maker’s choice of an alternative. These independent or exogenous variables are likely to differ across trip purpose. The commonly used explanatory variables in mode choice models include: Traveler (Decision Maker) Related Variables: Income of traveler or traveler’s household, Number of automobiles in traveler’s household, Number of workers in traveler’s household, Sex of the traveler, Age group of the traveler, Functions of these variables such as number of autos divided by number of workers Trip Context Variables: Trip purpose, Employment density at the traveler’s workplace, Population density at the home location and Dummy variable indicating whether the traveler’s workplace is in the Central Business District (CBD). Mode (Alternative) Related Variables: Total travel time, In-vehicle travel time, Out-of-vehicle travel time, Walk time, Wait time, Number of transfers Transit headway and Travel cost. Interaction of Mode and Traveler or Trip Related Variables: Travel cost divided by household income, Travel time or cost interacted with sex or age group of traveler, and Out-of-vehicle time divided by total trip distance. 5.3 Sources and Methods for Traveler and Trip Related Data Collection Traveler and trip related data (including the actual mode choice of the traveler) needed for estimation of mode choice models are generally obtained by surveying a sample of travelers from the population of interest. This section discusses the types of surveys that may be used to obtain traveler and/or trip-related information (Section 5.3.1) and associated sample design considerations (Section 5.3.2). 5.3.1 Travel Survey Types There are several types of travel surveys. The most common of these are household, workplace and intercept surveys. Household Travel Surveys involve contacting respondents in their home and collecting information regarding their household characteristics (e.g., number of members in household, automobile ownership, etc.), their personal characteristics (such as income, work status, etc.) and the travel decisions made in the recent past (e.g., number of trips, mode of travel for each trip, etc.). Historically, most household traveler surveys were conducted through personal interviews in the respondent’s home. Currently, most household travel surveys are conducted using telephone or mail-back surveys, or a combination of both. It is common practice to include travel diaries as a part of the household travel survey. Travel diaries are a daily log of all trips (including information about trip origin and destination, start and end time, mode of travel, purpose at the origin and destination, etc.) made by each household member during a specified time period. This information is used to develop trip generation, trip distribution, and mode choice models for various trip purposes. Recently, travel diaries have been extended to include detailed information about the activities engaged in at each stop location and at home to provide a better understanding of the motivation for each trip and to associate trips of different purposes with different members of the household. Also, in some cases, diaries have been collected repeatedly from the same ‘panel’ of respondents to understand changes in their behavior over time. Workplace Surveys involve contacting respondents at their workplace. The information collected is similar to that for household surveys but focuses exclusively on the traveler working at that location and on his/her work and work-related trips. Such surveys are of particular interest in understanding work commute patterns of individuals and in designing alternative commuter services. Destination Surveys involve contacting respondents at other destinations. Similar information is collected as for workplace surveys but the objective is to learn more about travel to other types of destinations and possibly to develop transportation services which better serve such destinations. Intercept Surveys “intercept” potential respondents during their travel. The emphasis of the survey is on collecting information about the specific trip being undertaken by the traveler. Intercept surveys are commonly used for intercity travel studies due to the high cost of identifying intercity travelers through home-based or work-based surveys. In intercept surveys, travelers are intercepted at a roadside rest area for highway travel and on board carriers (or at carrier terminals) for other modes of travel. The traveler is usually given a brief survey (paper or interview) for immediate completion or future response and/or recruited for a future phone survey. A variant of highway intercept surveys is to record the license plate of vehicles and subsequently contact the owners of a sample of vehicles to obtain information on the trip that was observed. Intercept surveys can be used to cover all available modes or they can be used to enrich a household or workplace survey sample by providing additional observations for users of infrequently used modes since few such users are likely to be identified through household or workplace surveys. 5.3.2 Sampling Design Considerations The first issue to consider in sample design is the population of interest in the study. Obviously, the population of interest will depend on the purpose of the study. In the context of urban work mode choice analysis, the population of interest would be all commuters in the urban region. In the context of non-business intercity mode choice, the population of interest would be all non-business intercity travelers in the relevant corridor. However, most surveys are designed to addresses a number of current or potential analysis and decision issues. Thus, the population of interest is selected based on the full range of such issues and is likely to include a wide range of households and household members each undertaking a variety of trips. After identifying the population of interest, the next step in sample design is to determine the unit for sampling. The sampling units should be mutually exclusive and collectively exhaust the population. Thus, if the population of interest is commuters in an urban region, the sampling unit could be firms in the area (whose employees collectively represent the commuting population). Within each firm, all or a sample of workers could be interviewed. However, if the survey is addressed to multiple urban travel issues, the population of interest is likely to be all individuals or households resident in the urban region. A comprehensive list of all sampling units constitutes the sampling frame. This may be a directory of firms or households obtained from a combination of public and private sources such as local or regional commerce departments, business directories, tourism offices, utilities, etc. Of course, the sampling frame may not always completely represent the population of interest. For example, some commuters may be employed by firms outside the urban region and some households may not have telephones or other utility connections. Once the sampling frame is determined, a sampling design is used to select a sample of cases. The most common class of sampling procedures is probability sampling, where each sampling unit has a pre-determined probability of being selected into the survey sample. A probability sampling procedure in which each sampling unit has an equal probability of being selected is simple random sampling. In this method, the sampling units are selected randomly from the sampling frame. This would apply to household sampling, for example. An alternative approach for work place sampling would be to sample each employer to further sample workers for those employers sampled. This is referred to as a two-stage sample. In either case, the result is an unbiased sample which is representative of the population of interest. Simple random sampling offers the advantage of being easy to understand, communicate, and implement in the field, making it less prone to errors. However, a random sample may not adequately represent some population segments of interest. This problem can be addressed by using stratified random sampling. This entails partitioning the sampling frame into several mutually exclusive and collectively exhaustive segments (or strata) based on one or more stratification variables, followed by random sampling within each stratum. Thus, households in a region may be stratified by location within the region; city vs. suburban residence; or income. Similarly, employment firms in a region may be stratified by the number of employees or the type of business. Stratified random sampling may be useful in cases where it is important to understand the characteristics of certain subpopulations as well as the overall population. For example, it might be useful to study the mode choice behavior of employees working for very small employers in a region and compare their behavior with those of employees working for large employers. But if the number of small employers in a region is a small proportion of all employers, they may not be well-represented in a simple random sample. In such a case, the analyst might stratify the sampling frame to ensure adequate representation of very small employers in the survey sample. Stratified random sampling can also be less expensive than simple random sampling. This can occur, for example, because per-person sampling is less expensive if a few large employers are targeted rather than several smaller ones. Finally, increased dispersion in the range of important independent variables can be increased through “clever” identification of alternative strata based on income, household size, number of vehicles owned or number of workers providing benefits in estimation efficiency. The use of stratified random sampling does not present any new problems in estimation as long as the stratification variable(s) is (are) exogenous to the choice process. However, in some situations, one may want to use the discrete choice of interest (the dependent or endogenous variable) as the stratification variable. For example, if the bus mode is rarely chosen for urban or intercity travel, a random sampling procedure or even an exogenously stratified sample might not provide sufficient observations of bus riders to understand the factors that affect the choice of the bus mode. In this case, bus riders can be intentionally over sampled by interviewing them at bus stops or on board the buses. Such choice based sampling may also be motivated by cost considerations. Special techniques are required to estimate model parameters using choice based sampling methods. A further problem is that it may be difficult to obtain a random sample as it may not be possible to get an up to date and complete list of potential respondents from which to select a sample. This is the primary reason for using “deterministic rules” of sampling. In systematic sampling, sample units are drawn by deterministic rather than random rules. For example, rather than drawing a random sample of 5 percent all households in a region from a published directory, a systematic sampling plan may pick out every 20th household in the directory. As long as there is no inherent bias in setting up the deterministic rule, the systematic sampling plan is essentially equivalent to random sampling, and the choice of one over the other may be a matter of operational convenience. In addition to the sampling approaches discussed above, combinations of the approaches can also be used. For example, enriched sampling uses a combination of household or workplace sampling with choice based sampling to increase the number of transit users in the study data. As with choice based sampling, special estimation techniques are required to offset the biases associated with this sampling approach. Another issue in survey sampling is the sample size to be used. The size of the sample required to adequately represent the population is a function of the level of statistical accuracy and confidence desired from the survey. The precision of parameter estimates and the statistical validity of estimation results improve with sample size. However, the cost of the survey also increases with sample size and in many cases it is necessary to restrict the sample size to ensure that the cost of the survey remains within budgetary constraints. The decision about sample size requires a careful evaluation of the need for adequate data to satisfy study objectives vis-à-vis budgetary constraints. Interested readers are referred to M. Ben-Akiva and Lerman (1985) or Börsch-Supan (1987) for a more comprehensive discussion of sampling methods and sample size issues. 5.4 Methods for Collecting Mode Related Data Surveys can be used to collect information describing the trip maker and his or her household, the context of the trip (purpose, time of day, frequency of travel, origin, and destination), the chosen mode and the respondent’s perception of travel service. However, objective data about modal service (mode availability and level of service) must be obtained from other sources. Modal data is usually generated from simulation of network service characteristics including carrier schedules and fare and observed volumes, travel times and tolls on roadway links. Network analysis provides the zone-to-zone in-vehicle travel times for the highway (non-transit) and transit modes (the urban area is divided into several traffic analysis zones for travel demand analysis purposes). The highway out-of-vehicle time by the highway mode is assigned a nominal value to reflect walk access/egress to/from the car. The transit out-of-vehicle time is based on transit schedules, the presence or absence of transfers, and location of bus stops vis-à-vis origin and destination locations. The highway distance of travel is obtained from the network structure and a per-mile vehicle operation cost is applied to obtain highway zone-to-zone driving costs. Parking costs are obtained from per-hour parking rates at the destination zone multiplied by half the estimated duration of the activity pursued at the destination zone (allowing half the parking cost to be charged to the incoming and departing trips) and toll costs can be identified from the network. Transit cost is determined from the actual fare for travel between zones plus any access costs to/from the transit station from/to the origin/destination. The highway in-vehicle times, out-of-vehicle times, and costs are used as the relevant values for driving alone and these values are modified appropriately to reflect increased in-vehicle times and decreased driving/parking costs for the shared ride modes. The travel times for non-motorized modes (such as bike and walk) are obtained from the zone-to-zone distance and an assumed walk/bike speed. Finally, the appropriate travel times and cost between zones is appended to each trip in the trip file based on the origin and destination zones of the trip. 5.5 Data Structure for Estimation # Read in raw SPSS file # # We received the work mode choice dataset from Laurie Garrow, who had converted # the file into a labeled SPSS data object. This code reads the file into R # using the haven::read_spss function, and then creates a new alternative column # as the label of the alternative number sf_work_mode &lt;- read_spss(&quot;data-raw/Work Trips/SPSS/SF MTC Work MC Data NewVars.sav&quot;) %&gt;% mutate(altname = as_factor(altnum, levels = &quot;labels&quot;)) # Convert into mlogit dfidx data frame # mlogit requires instructions on which rows are the alternative, and which rows # are the cases. This dataset is in IDCase-ALT format sf_mlogit &lt;- dfidx(sf_work_mode, idx = c(&quot;case&quot;, &quot;altname&quot;)) # write to data/ folder for future use write_rds(sf_mlogit, &quot;data/worktrips.rds&quot;) The data collected from the various sources described in the previous sections must be assembled into a single data set to support model estimation. This can be accomplished using a variety of spreadsheet, data base, statistical software or user prepared programs. The structure of the resultant data files must satisfy the format requirements of the software packages designed for choice model estimation. The commonly used software packages for discrete choice model estimation require the data to be structured in one of two formats: a) the trip format or b) the trip-alternative format. This are commonly referred to as IDCase (each record contains all the information for mode choice over alternatives for a single trip) or IDCase-IDAlt (each record contains all the information for a single mode available to each trip maker so there is one record for each mode for each trip). In the trip format, each record provides all the relevant information about an individual trip, including the traveler/trip related variables, mode related variables for all available modes and a variable indicating which alternative was chosen. In the trip-alternative format, each record includes information on the traveler/trip related variables, the attributes of that modal alternative, and a choice variable that indicates whether the alternative was or was not chosen.13 The two data structures are illustrated in Tables 5.1 and 5.2 for four observations (individuals) with up to three modal alternatives available. The first columns in both formats is the household and person ID value. In the trip (or IDCase) format, this is followed by traveler/trip related variables (e.g., income), the level of service (time and cost in the figure) variables associated with each alternative and a variable that indicates the chosen alternative. In the trip-alternative (or IDCase-IDAlt) format, the second column generally identifies the alternative number with which that record is associated. Additional columns will generally include a 0-1 variable indicating the chosen alternative,14 the number of alternatives available, traveler/trip related variables mode related attributes for the alternative with which the record is associated. The unavailability of an alternative is indicated in the trip format by zeros Either of the two data formats may be used to represent the information required for model estimation. The choice is based on the programming decisions of the software developer taking into account data storage and computational implications of each choice. #trip-alt trip_alt &lt;- sf_work_mode %&gt;% filter(case &lt;= 4) %&gt;% select(hhid, perid, Alternative = altname, chosen, IVTT = ivtt, Income = hhinc) kbl(trip_alt, caption= &quot;Data Layout Type II: Trip-Alternative Format&quot;) %&gt;% kable_styling() Table 5.1: Data Layout Type II: Trip-Alternative Format hhid perid Alternative chosen IVTT Income 2 1 Drive alone 1 13.38 42.5 2 1 Share ride 2 0 18.38 42.5 2 1 Share ride 3+ 0 20.38 42.5 2 1 Transit 0 25.90 42.5 2 1 Bike 0 40.50 42.5 3 1 Drive alone 0 29.92 17.5 3 1 Share ride 2 0 34.92 17.5 3 1 Share ride 3+ 0 21.92 17.5 3 1 Transit 1 22.96 17.5 3 1 Bike 0 58.95 17.5 5 1 Drive alone 1 8.60 12.5 5 1 Share ride 2 0 13.60 12.5 5 1 Share ride 3+ 0 15.60 12.5 5 1 Transit 0 16.87 12.5 6 1 Drive alone 0 30.60 55.0 6 1 Share ride 2 0 35.70 55.0 6 1 Share ride 3+ 0 22.70 55.0 6 1 Transit 1 24.27 55.0 trip_format &lt;- sf_work_mode %&gt;% filter(case &lt;= 4) %&gt;% select(hhid, perid, chosen, ivtt, Income = hhinc, altname, altnum) %&gt;% group_by(hhid, perid) %&gt;% mutate( chosen = altname[which(chosen == 1)], altname = str_c(altname, &quot; - Travel Time&quot;)) %&gt;% select(-altnum) %&gt;% spread(altname, ivtt, fill = 0) kbl(head(trip_format), caption= &quot;Data Layout Type I: Trip Format&quot;) %&gt;% kable_styling() Table 5.2: Data Layout Type I: Trip Format hhid perid chosen Income Bike - Travel Time Drive alone - Travel Time Share ride 2 - Travel Time Share ride 3+ - Travel Time Transit - Travel Time 2 1 Drive alone 42.5 40.50 13.38 18.38 20.38 25.90 3 1 Transit 17.5 58.95 29.92 34.92 21.92 22.96 5 1 Drive alone 12.5 0.00 8.60 13.60 15.60 16.87 6 1 Transit 55.0 0.00 30.60 35.70 22.70 24.27 5.6 Application Data for Work Mode Choice in the San Francisco Bay Area The examples used in previous chapters are based on simulated or hypothetical data to highlight fundamental concepts of multinomial logit choice models. Henceforth, our discussion of model specification and interpretation of results will be based on application data sets assembled from travel survey and other data collection to support transportation decision making in selected urban regions. Use of real data provides richer examples and “hands-on” experience in estimating mode choice models. The data used in this chapter was collected for the analysis of work trip mode choice in the San Francisco Bay Area in 1990. The San Francisco Bay Area work mode choice data set comprises 5,029 home-to-work commute trips in the San Francisco Bay Area. The data is drawn from the San Francisco Bay Area Household Travel Survey conducted by the Metropolitan Transportation Commission (MTC) in the spring and fall of 1990 (see ((whiteco?), 1991) for details of survey sampling and administration procedures). This survey included a one day travel diary for each household member older than five years and detailed individual and household socio-demographic information. There are six work mode choice alternatives in the region: drive alone, shared-ride with 2 people, shared ride with 3 or more people, transit, bike, and walk.15 The drive alone mode is available for a trip only if the trip-maker’s household has a vehicle available and if the trip-maker has a driver’s license. The shared-ride modes (with 2 people and with 3 or more people) are available for all trips. Transit availability is determined based on the residence and work zones of individuals. The bike mode is deemed available if the one-way home-to-work distance is less than 12 miles, while the walk mode is considered to be available if the one-way home to work distance is less than 4 miles (the distance thresholds to determine bike and walk availability are determined based on the maximum one-way distance of bike and walk-users, respectively). Level of service data were generated by the Metropolitan Transportation Commission for each zone pair and for each mode. These data were appended to the home-based work trips based on the origin and destination of each trip. The data includes traveler, trip related area and mode related variables for each trip including in-vehicle travel time, out-of-vehicle travel time, travel cost, travel distance, and a mode availability indicator. Table 5.3 provides information about the availability and usage of each alternative and the average values of in-vehicle time, out-of-vehicle time and travel cost in the sample. Drive alone is available to most work commuters in the Bay Area and is the most frequently chosen alternative. The shared-ride modes are available for all trips (by construction) and together account for the next largest share of chosen alternatives. The combined total of drive alone and shared ride trips represent close to 85% of all work trips. Transit trips constitute roughly 10% of work trips, a substantially greater share than in most metropolitan regions in the U.S. The fraction of trips using non-motorized modes (walk and bike) constitutes a small but not insignificant portion of total trips. #calculations ======================================= #calculate IVTT sf_wm_ivtt &lt;- sf_work_mode %&gt;% select(hhid, perid, altnum, chosen, ivtt, hhinc) %&gt;% group_by(hhid, perid) %&gt;% mutate( chosen = max(chosen * altnum) ) %&gt;% spread(altnum, ivtt, fill = 0) ivtt_raw &lt;- apply(sf_wm_ivtt,2,function(x) mean(x[x&gt;0])) #calculate OVTT sf_wm_ovtt &lt;- sf_work_mode %&gt;% select(hhid, perid, altnum, chosen, ovtt, hhinc) %&gt;% group_by(hhid, perid) %&gt;% mutate( chosen = max(chosen * altnum) ) %&gt;% spread(altnum, ovtt, fill = 0) ovtt_raw &lt;- apply(sf_wm_ovtt,2,function(x) mean(x[x&gt;0])) #calculate OVTT for walk (using TVTT) sf_wm_tvtt &lt;- sf_work_mode %&gt;% select(hhid, perid, altnum, chosen, tvtt, hhinc) %&gt;% group_by(hhid, perid) %&gt;% mutate( chosen = max(chosen * altnum) ) %&gt;% spread(altnum, tvtt, fill = 0) tvtt_raw &lt;- apply(sf_wm_tvtt,2,function(x) mean(x[x&gt;0])) #calculate market share Base_model &lt;- mlogit(chosen ~ cost + tvtt | hhinc, data = sf_mlogit) mrktshr_raw &lt;- Base_model$freq / nrow(sf_wm_tvtt) #calculate COST sf_wm_cost &lt;- sf_work_mode %&gt;% select(hhid, perid, altnum, chosen, cost, hhinc) %&gt;% group_by(hhid, perid) %&gt;% mutate( chosen = max(chosen * altnum) ) %&gt;% spread(altnum, cost, fill = 0) cost_raw &lt;- apply(sf_wm_cost,2,function(x) mean(x[x&gt;0])) #create the table ================================== statsJtoWork &lt;- tibble( &quot;Mode&quot;= c(&quot;1. Drive Alone&quot;,&quot;2. Shared Ride (2)&quot;,&quot;3. Shared Ride (3+)&quot;, &quot;4. Transit&quot;, &quot;5. Bike&quot;, &quot;6. Walk&quot;), &quot;Fraction of Sample with Mode Available (%)&quot; = c(94.6,100.0,100.0,79.6,34.6,29.4), &quot;Market Share (%)&quot; = c(mrktshr_raw) * 100, &quot;Average IVTT (minutes)&quot; = c(ivtt_raw[ -c(1:4)]), &quot;Average OVTT (minutes)&quot; = c(ovtt_raw[c(5:9)], tvtt_raw[c(10)]), &quot;Average Cost (1990 cents)&quot; = c(cost_raw[-c(1:4)])) #display the table ================================= kbl(statsJtoWork, digits = 1, caption = &quot;Sample Statistics for Bay Area Journey-to-Work Modal Data&quot;) %&gt;% kable_styling() Table 5.3: Sample Statistics for Bay Area Journey-to-Work Modal Data Mode Fraction of Sample with Mode Available (%) Market Share (%) Average IVTT (minutes) Average OVTT (minutes) Average Cost (1990 cents) Drive Alone 94.6 72.3 20.9 3.7 176.4 Shared Ride (2) 100.0 10.3 25.2 3.9 89.3 Shared Ride (3+) 100.0 3.2 26.8 3.9 50.4 Transit 79.6 9.9 24.6 28.8 122.8 Bike 34.6 1.0 28.0 3.7 NaN Walk 29.4 3.3 NaN 48.7 NaN 5.7 Estimation of MNL Model with Basic Specification We use the San Francisco Bay Area data to estimate a multinomial logit work mode choice model using a basic specification which includes travel time, travel cost and household income as the explanatory variables. Travel time and travel cost represent mode related attributes; all other things being equal, a faster mode of travel is more likely to be chosen than a slower mode and a less expensive mode is more likely to be chosen than a costlier mode. Household income is included in the model with the expectation that travelers from high income households are more likely to drive alone than to use other travel modes. The multinomial logit work trip mode choice models are estimated using ALOGIT, LIMDEP and ELM software, to illustrate differences in the outputs of these packages,16 as well as a specially programmed module for Matlab. The data sets, input control files, and estimation output results for this a selection of other model specifications for both software packages are included in the CD-ROM supplied with this manual. The Matlab module code, command files and output for all specifications in the manual are also included in the CD-ROM. The travel time (TT) and travel cost (TC) variables are specified as generic in this model. This implies that an increase of one unit of travel time or travel cost has the same impact on modal utility for all six modes. Household Income (Inc) is included as an alternative-specific variable. The drive alone mode is considered the base alternative for household income and the modal constants (see section 4.1.2.2 for a discussion of the need for a base alternative for these variables). The following mode labels are used in the subsequent discussion and equations: DA (drive alone), SR2 (shared ride with 2 people), SR3+ (shared ride with 3 or more people), TR (transit), BK (bike) and WK (walk). The deterministic portion of the utility for these modes, based on the utility specification discussed above, may be written as: \\[\\begin{equation} V_{DA} = \\beta_{1} \\times TT_{DA} + \\beta_{2} \\times TC_{DA} \\tag{5.1} \\end{equation}\\] \\[\\begin{equation} V_{SR2} = \\beta_{SR2} + \\beta_{1} \\times TT_{SR2} + \\beta_{2} \\times TC_{SR2} + \\gamma_{SR2} \\times Inc \\tag{5.2} \\end{equation}\\] \\[\\begin{equation} V_{SR3+} = \\beta_{SR3+} + \\beta_{1} \\times TT_{SR3+} + \\beta_{2} \\times TC_{SR3+} + \\gamma_{SR3+} \\times Inc \\tag{5.3} \\end{equation}\\] \\[\\begin{equation} V_{TR} = \\beta_{TR} + \\beta_{1} \\times TT_{TR} + \\beta_{2} \\times TC_{TR} + \\gamma_{TR} \\times Inc \\tag{5.4} \\end{equation}\\] \\[\\begin{equation} V_{BK} = \\beta_{BK} + \\beta_{1} \\times TT_{BK} + \\beta_{2} \\times TC_{BK} + \\gamma_{BK} \\times Inc \\tag{5.5} \\end{equation}\\] \\[\\begin{equation} V_{WK} = \\beta_{WK} + \\beta_{1} \\times TT_{WK} + \\beta_{2} \\times TC_{WK} + \\gamma_{WK} \\times Inc \\tag{5.5} \\end{equation}\\] The estimation results reported in this manual are obtained from software programmed using the mlogit package for R, with estimation code embedded in the document. The output for the above model specification is shown in structured format in Table 5.4. Other commercial and free software packages are available, including ALOGIT, LIMDEP, Biogeme (Python), Apollo (R), and ELM. The outputs from these and other software package typically include, at least, the following estimation results: Parameter17 names, parameter estimates, standard errors of these estimates and the corresponding t-statistics for each variable/parameter; Log-likelihood values at zero (equal probability model), constants only (market shares model) and at convergence and Rho-Squared and other indicators of goodness of fit. In addition, different software reports a variety of other information either as part of the default output or as a user selected option. These include: The number of observations, The number of cases for which each alternative is available, The number of cases for which each alternative is chosen, The number of iterations required to obtain convergence, and The status of the convergence process at each iteration. The value for the log-likelihood at zero and constants can be obtained for either software by estimating models without (zero) and with (constants) alternative specific constants18 and no other variables. Further, the log-likelihood at zero can be calculated directly as $ _t ln(1/NAlt_t)$ In the next three sections, we review the estimation results for the base model using informal judgment-based tests (section 5.7.1), goodness-of-fit measures (section 5.7.2), and statistical tests (section 5.7.3). These elements, taken together, provide a basis to evaluate each model and to compare models with different specifications. base &lt;- mlogit(chosen ~ ivtt + cost, data = sf_mlogit) # estimate a model with constants only by constraining a single generic variable # to be zero market_shares &lt;- mlogit(chosen ~ ivtt, data = sf_mlogit, constPar = c(&quot;ivtt&quot; = 0)) # Estimate a null model by constraining ALL the parameters to be zero. fixed_coefs &lt;- rep(0,6) %&gt;% setNames(c(names(coef(market_shares)), &quot;ivtt&quot;)) null_model &lt;- mlogit(chosen ~ ivtt, data = sf_mlogit, start = fixed_coefs, iterlim = 0) basic_estimation &lt;- list( &quot;Null Model&quot; = null_model, &quot;Market Shares&quot; = market_shares, &quot;Base Model&quot; = base ) modelsummary( basic_estimation, title = &quot;Estimation Results for Zero Coefficient, Constants Only, and Base Models&quot; ) Table 5.4: Estimation Results for Zero Coefficient, Constants Only, and Base Models Null Model Market Shares Base Model (Intercept) × Share ride 2 0.000 -2.137 -2.425 (0.044) (0.048) (0.058) (Intercept) × Share ride 3++ 0.000 -3.303 -3.856 (0.046) (0.081) (0.095) (Intercept) × Transit 0.000 -1.950 -2.060 (0.053) (0.051) (0.065) (Intercept) × Bike 0.000 -3.335 -3.424 (0.085) (0.145) (0.166) (Intercept) × Walk 0.000 -2.040 -2.717 (0.073) (0.085) (0.096) ivtt 0.000 -0.032 (0.003) (0.005) cost -0.005 (0.000) Num.Obs. 5029 5029 5029 AIC 14631.2 8277.8 7600.3 BIC Log.Lik. -7309.601 -4132.916 -3793.129 rho2 -0.505 0.149 0.219 rho20 0.189 0.541 0.579 5.7.1 Informal Tests A variety of informal tests can be applied to an estimated model. These tests are designed to assess the reasonableness of the implications of estimated parameters. The most common tests concern: The sign of parameters (do the associated variables have a positive or negative effect on the alternatives with which they are associated?), The difference (positive or negative) within sets of alternative specific variables (does the inclusion of this variable have a more or less positive effect on one alternative relative to another?) and The ratio of pairs of parameters (is the ratio between the parameters of the correct sign and in a reasonable range?). 5.7.1.1 Signs of Parameters The most basic test of the estimation results is to examine the signs of the estimated parameters with theory, intuition and judgment regarding the expected impact of the corresponding variables. The estimated coefficients on the travel time and cost variables in Table 5.4 are negative, as expected, implying that the utility of a mode decreases as the mode becomes slower and/or more expensive. This, in turn, will reduce the choice probability of the corresponding mode. 5.7.1.2 Differences in Alternative Specific Variable Parameters across Alternatives We often have expectations about the impact of decision-maker characteristics on different alternatives. For example, when analyzing mode choice, we expect a number of variables to be more positive for automobile alternatives, especially Drive Alone, than for other alternatives. These include income, automobile ownership, home ownership, single family dwelling unit, etc. Since DA is the reference alternative in these models, we expect negative parameters on all alternative specific income variables, with small values for the shared ride alternatives and larger values for other alternatives, to reflect our intuition that increasing income will be associated with decreased preference for all other alternatives relative to drive alone. All the estimated alternative specific income parameters in Table 5.4 Estimation Results for Zero Coefficient, Constants Only and Base Models are negative, as expected, with the exception of the parameter for shared ride 3+. The positive sign for the shared ride 3+ parameter is counter-intuitive but very small and not significantly different from zero. An approach to address this problem is described in section 5.7.3.1. Additional informal tests involve comparisons among the estimated income parameters. The differences in the magnitude of these alternative-specific income parameters indicate the relative impact of increasing income on the utility and, hence, the choice probability of each mode. The results reported in Table 5 2 show that an increase in income will have a larger negative effect on the utilities of the non-motorized modes (bike and walk) than on those of transit and shared ride 2 modes. It is important to understand that the change in the choice probability of that alternative is not determined by the sign of the income parameter for a particular alternative but on the value of the parameter relative to the weighted mean of the income parameters across all alternatives, as described in section 4.5. For example, in the base model specification (Table 5.4), an increase in income will increase the probability of choosing drive alone and shared ride 3+ (the alternatives with the most positive parameters)19 and will decrease the probability of choosing walk and bike (the alternatives with the smallest, most negative, parameters). However, the effect on shared ride 2 and transit is unclear; as income increases, they will lose some probability to drive alone and shared ride 3+ and gain some from walk and bike. The net effect will depend on the difference between the parameter for the alternative of interest and the individual choice probability weighted average of all the alternative specific income parameters (including zero for the base alternative) as illustrated in equation 4.58. 5.7.1.3 The Ratio of Pairs of Parameters The ratio of the estimated travel time and travel cost parameters provides an estimate of the value of time implied by the model; this can serve as another important informal test for evaluating the reasonableness of the model. For example, in the Base Model reported in Table 5.4, the implied value of time is \\(-0.0315962/-0.0050606\\) or 6.2435342 cents per minute (the units are determined from the units of the time and cost variables used in estimation). This is equivalent to $6.26 per hour which is much lower that the average wage rate in the area at the time of the survey, approximately $21.20 per hour, suggesting that the estimated value of time may be too low. We revisit this issue in greater detail in the next chapter. Similar ratios may be used to assess the reasonableness of the relative magnitudes of other pairs of parameters. These include out of vehicle time relative to in vehicle time, travel time reliability (if available) relative to average travel time, etc. 5.7.2 Overall Goodness-of-Fit Measures This section presents a descriptive measure, called the rho-squared value (\\(\\rho^2\\)) which can be used to describe the overall goodness of fit of the model. We can understand the formulation of this value in terms of the following figure which shows the scalar relationship among the log-likelihood values for a zero coefficients model (or the equally likely model), a constants only or market share model, the estimated model and a perfect prediction model. In the figure, LL(0) represents the log-likelihood with zero coefficients (which results in equal likelihood of choosing each available alternative), \\(LL(0)\\) represents the log-likelihood for the constants only model, \\(LL(\\hat{\\beta})\\) represents the log-likelihood for the estimated model and LL(*) = 0 is the log-likelihood for the perfect prediction model. Figure 5.1: Relationship between Different Log-likelihood Measures The relationships among modeling results will always appear in the order shown provided the estimated model includes a full set of alternative specific constants. That is, the constants only model is always better than the equally likely model, and the estimated model with constants is always better than the constants only model. The order of different estimated models will vary except that any model which is a restricted version of another model will be to the left of the unrestricted model. The rho-squared (\\(\\rho_0^2\\)) value is based on the relationship among the log-likelihood values indicated in Figure 5.2. It is simply the ratio of the distance between the reference model and the estimated model divided by the difference between the reference model and a perfect model. If the reference model is the equally likely model, the rho square with respect to zero, \\(\\rho_0^2\\), is: \\[\\begin{equation} \\rho_0^2 = \\frac{LL(\\hat{\\beta}) - LL(0)}{LL(\\star) - LL(0)} \\tag{5.6} \\end{equation}\\] Since the log-likelihood value for the perfect model is zero,20 the \\(\\rho_0^2\\) measure reduces to: \\[\\begin{equation} \\rho_0^2 = 1- \\frac{LL(\\hat{\\beta})}{LL(0)} \\tag{5.7} \\end{equation}\\] Similarly, the rho-square with respect to the constants only model is: \\[\\begin{equation} \\rho_0^2 = \\frac{LL(\\hat{\\beta}) - LL(c)}{LL(\\star) - LL(c)} = 1- \\frac{LL(\\hat{\\beta})}{LL(c)} \\tag{5.8} \\end{equation}\\] By definition, the values of both rho-squared measures lie between 0 and 1 (this is similar to the R^2 measure for linear regression models). A value of zero implies that the model is no better than the reference model, whereas a value of one implies a perfect model; that is, every choice is predicted correctly. The rho-squared values for the basic model specification in Table 5.4 are computed based on the formulae shown below as: \\[\\begin{equation} \\rho_0^2 = 1- \\frac{(-3626.2)}{(-7309.6)} = 0.5039 \\qquad \\rho_c^2 = 1- \\frac{(-3626.2)}{(-4132.9)} = 0.1226 \\tag{5.9} \\end{equation}\\] The rho-squared measures are widely used to describe the goodness of fit for choice models because of their intuitive formulation. The \\(\\rho_0^2\\) measures the improvement due to all elements of the model, including the fit to market shares, which is not very interesting for disaggregate analysis so it should not be used to assess models in which the sample shares are very unequal. The rho-squared measure with respect to the constant only model, \\(\\rho_c^2\\) , controls for the choice proportions in the estimation sample and is therefore a better measure to use for evaluating models. A problem with both rho-squared measures is that there are no guidelines for a “good” rho-squared value. Consequently, the measures are of limited value in assessing the quality of an estimated model and should be used with caution even in assessing the relative fit among alternative specifications. It is preferable to use the log-likelihood statistic (which has a formal and convenient mechanism to test among alternative model specifications) to support the selection of a preferred specification among alternative specifications. Another problem with the rho-squared measures is that they improve no matter what variable is added to the model independent of its importance. This directly results from the fact that the objective function of the model is being modeled with one or more additional degrees of freedom and that the same data that is used for estimation is used to assess the goodness of fit of the model. One approach to this problem is to replace the rho-squared measure with an adjusted rho-square measure which is designed to take account of these factors. The adjusted rho-squared for the zero model is given by: \\[\\begin{equation} \\bar{\\rho_0^2} = \\frac{[LL(\\hat{\\beta}) - K] -LL(0)}{LL(\\star) - LL(0)} = 1-\\frac{LL(\\hat{\\beta}) - K}{LL(0)} \\tag{5.10} \\end{equation}\\] where \\(K\\) is the number of degrees of freedom (parameters) used in the model. The corresponding adjusted rho-squared for the constants only model is given by: \\[\\begin{equation} \\bar{\\rho_c^2} = \\frac{LL(\\hat{\\beta}) - K - (LL(C)-K_{MS}}{LL(\\star) - (LL(C)-K_{MS})} = 1-\\frac{LL(\\hat{\\beta}) - K}{LL(C)-K_{MS}} \\tag{5.11} \\end{equation}\\] where \\(K_{MS}\\) is the number of degrees of freedom (parameters) used in the constants only model. 5.7.3 Statistical Tests Statistical tests may be used to evaluate formal hypotheses about individual parameters or groups of parameters taken together. In this section we describe each of these tests. 5.7.3.1 Test of Individual Parameters There is sampling error associated with the model parameters because the model is estimated from only a sample of the relevant population (the relevant population includes all commuters in the Bay Area). The magnitude of the sampling error in a parameter is provided by the standard error associated with that parameter; the larger the standard error, the lower the precision with which the corresponding parameter is estimated. The standard error plays an important role in testing whether a particular parameter is equal to some hypothesized value, as we discuss next. The statistic used for testing the null hypothesis that a parameter \\(\\hat{\\beta_{k}}\\) is equal to some hypothesized value, \\({\\beta_{k}^*}\\), is the asymptotic t-statistic, which takes the following form: \\[\\begin{equation} \\displaystyle t-statistic = \\frac{\\hat{\\beta_{k}}-\\beta_{k}^{*}}{S_{k}} \\tag{5.12} \\end{equation}\\] where \\(\\hat{\\beta_{k}}\\) is the estimate for the \\(k^{th}\\) parameter, \\(\\beta_{k}^{*}\\) is the hypothesized value for the \\(k^{th}\\) parameter and \\(S_{k}\\) is the standard error of the estimate. Sufficiently large absolute values of the t-statistic lead to the rejection of the null hypothesis that the parameter is equal to the hypothesized value. When the hypothesized value, \\(\\beta_{k}^{*}\\), is zero, the t-statistic becomes the ratio of the estimated parameter to the standard error. The default estimation output from most software packages includes the t-statistic for the test of the hypothesis that the true value is zero. The rejection of this null hypothesis implies that the corresponding variable has a significant impact on the modal utilities and suggests that the variable should be retained in the model. Low absolute values of the t-statistic imply that the variable does not contribute significantly to the explanatory power of the model and can be considered for exclusion. If it is concluded that the hypothesis is not rejected, the equality constraint can be incorporated in the model by creating a new variable \\(X_{kl} = X_{k} + X_{l}\\) . The selection of a critical value for the t-statistic test is a matter of judgment and depends on the level of confidence with which the analyst wants to test his/her hypotheses. The critical t-values for different levels of confidence for samples sizes larger than 150 (which is the norm in mode choice analysis) are shown in Table 5-3. It should be apparent that the critical t-value increases with the desired level of confidence. Thus, one can conclude that a particular variable has no influence on choice (or equivalently that the true parameter associated with the variable is zero) can be rejected at the 90% level of confidence if the absolute value of the t-statistic is greater than 1.645 and at the 95% level of confidence if the t-statistic is greater than 1.960.21 tibble(confid = c(.9, .95, .99, .995, .999)) %&gt;% mutate(tval=qnorm((1-confid)/2, lower.tail = FALSE)) %&gt;% kbl(caption = &quot;Critical t-Values for Selected Confidence Levels and Large Samples&quot;, col.names = c(&quot;Confidence Level&quot;, &quot;Critical t-value (two-tailed test)&quot;)) %&gt;% kable_styling() Table 5.5: Critical t-Values for Selected Confidence Levels and Large Samples Confidence Level Critical t-value (two-tailed test) 0.900 1.644854 0.950 1.959964 0.990 2.575829 0.995 2.807034 0.999 3.290527 these_colors &lt;- wesanderson::wes_palette(&quot;Zissou1&quot;) ggplot(data.frame(x = c(-4,4))) + # Plot the pdf stat_function( fun = function(x) dt(x, df = 29), aes(x), geom = &quot;area&quot;, color = &quot;grey75&quot;, fill = &quot;grey90&quot;, alpha = 1) + # Shade above 2 stat_function( fun = function(x) ifelse(x &gt;= 1.645, dt(x, df = 29), NA), aes(x), geom = &quot;area&quot;, color = NA, fill = these_colors[4], alpha = 1) + # Shade above 1.645 stat_function( fun = function(x) ifelse(x &gt;= 2, dt(x, df = 29), NA), aes(x), geom = &quot;area&quot;, color = NA, fill = these_colors[5], alpha = 1) + # Shade below -1.645 stat_function( fun = function(x) ifelse(x &lt;= -1.645, dt(x, df = 29), NA), aes(x), geom = &quot;area&quot;, color = NA, fill = these_colors[4], alpha = 1) + # Shade below -2 stat_function( fun = function(x) ifelse(x &lt;= -2, dt(x, df = 29), NA), aes(x), geom = &quot;area&quot;, color = NA, fill = these_colors[5], alpha = 1) + ggtitle(expression(paste(&quot;The&quot;, italic(t), &quot; distribution with a 90% and 95% confidence interval&quot;))) + xlab(expression(italic(t))) + theme_bw() We illustrate the use of the t-test by reviewing the t-statistics for each parameter in the initial model specification (Table 5-2). Both the travel cost and travel time parameters have large absolute t-statistic values (20.6 and 16.6, respectively) which lead us to reject the hypothesis that these variables have no effect on modal utilities at a confidence level higher than 99.9%. Thus, these variables should be retained in the model. All of the other t-statistics, except for Income-Shared Ride 2, Income-Shared Ride 3+ and the walk constant are greater than 1.960 (95% confidence) supporting the inclusion of the corresponding variables. The t-statistics on the shared ride specific income variables are even less than 1.645 in absolute value (90% confidence), suggesting that the effect of income on the utilities of the shared ride modes may not differentiate them from the reference (drive alone) mode. Consequently, the analyst should consider removing these income variables from the utility function specifications for the shared ride modes. The case is particularly compelling for removal of the income shared ride 3+ variable since the t-statistic is very low and the parameter has a counter-intuitive sign. Another alternative would be to combine the two shared ride income parameters suggesting that income has differential effect between drive alone and shared ride but not between shared ride 2 and shared ride 3+ (when this is done, the combined variable obtains a small negative parameter which is not statistically different from zero). This variable could be deleted or retained according to the judgment of the analyst as described in Section 6.2.1. An alternative approach is to report the t-statistic to two or three decimal places and calculate the probability that a t-statistic value of that magnitude or higher would occur due to random variation in sampling as shown in Table 5-4. This is reported as the significance level, which is the complement of the level of confidence. The significance of each parameter can be read directly from the table. Parameters with significance greater than 0.05 (lower in magnitude but more significant), provide a stronger basis for rejecting the hypothesis that the true parameter is zero and that the corresponding variable can be excluded from the model. On the other hand, significance levels of 0.163 (for Income-SR2), 0.888 (for Income-SR3+) and 0.287 (for ASC-Walk) provide little evidence about whether the corresponding variable should or should not be included in the model.22 Model 1 (Intercept) × Share ride 2 -2.178*** (-20.815) (Intercept) × Share ride 3++ -3.725*** (-20.964) (Intercept) × Transit -0.671*** (-5.060) (Intercept) × Bike -2.376*** (-7.804) (Intercept) × Walk -0.207 (-1.066) cost -0.005*** (-20.597) tvtt -0.051*** (-16.565) hhinc × Share ride 2 -0.002 (-1.397) hhinc × Share ride 3++ 0.000 (0.141) hhinc × Transit -0.005*** (-2.891) hhinc × Bike -0.013** (-2.406) hhinc × Walk -0.010*** (-3.194) Num.Obs. 5029 AIC 7276.4 BIC Log.Lik. -3626.186 rho2 0.253 rho20 0.598 Note: The numbers in the parentheses are the t-statistics * p &lt; 0.1, ** p &lt; 0.05, *** p &lt; 0.01 It is important to recognize that a low t-statistic does not require removal of the corresponding variable from the model. If the analyst has a strong reason to believe that the variable is important, and the parameter sign is correct, it is reasonable to retain the variable in the model. A low t-statistic and corresponding low level of significance can best be interpreted as providing little or no information rather than as a basis for excluding a variable. Also, one should be cautious about prematurely deleting variables which are expected to be important as the same variable may be significant when other variables are added to or deleted from the model. The lack of significance of the alternative specific walk constant is immaterial since the constants represent the average effect of all the variables not included in the model and should always be retained despite the fact that they do not have a well-understood behavioral interpretation. 5.7.3.2 Test of Linear Relationship between Parameters It is often interesting to determine if two parameters are statistically different from one another or if two parameters are related by a specific value ration. These tests are similarly based on the t-statistic; however, the formulation of the test is somewhat different from that described in Section 5.7.3.1. To test the hypothesis \\(H_{0}:\\beta_{k} = \\beta_{l}\\) vs. \\(H_{A}:\\beta_{k} \\ne \\beta_{l}\\); we use the asymptotic t-statistic, which takes the following form: \\[\\begin{equation} \\displaystyle t-statistic = \\frac{\\hat{\\beta_{k}}-\\hat\\beta_{l}}{\\sqrt{S_{k}^{2}+S_{l}^{2}-2S_{k,l}}} (\\#eq:asymptotic H0vsHA) \\end{equation}\\] where \\(\\hat{\\beta_{k}}\\), \\(\\hat{\\beta_{l}}\\) are the estimates for the \\(k^{th}\\) and \\(l^{th}\\) parameters, \\(S_{k}\\), \\(S_{l}\\) are the standard errors of the estimates for the \\(k^{th}\\) and \\(l^{th}\\) parameters and \\(S_{k,l}\\) is the error covariance for the estimates for the \\(k^{th}\\) and \\(l^{th}\\) parameters. That is the ratio is the differences between the two parameter estimates and the standard deviation of that difference. As before, sufficiently large absolute values of the t-statistic lead to the rejection of the null hypothesis that the parameters are equal. Again, rejection of this null hypothesis implies that the two corresponding variables have a significant different impact on the modal utilities and suggests that the variable should be retained in the model and low absolute values of the t-statistic imply that the variables do not have significantly different effects on the utility function or the explanatory power of the model and can be combined in the model. This test can be readily extended to the test of a hypothesis that the two parameters are related by a predefined ratio; for example, the parameter for time and cost may be related by an a priori value of time. In that case, the null hypothesis becomes \\(H_{0}:\\beta_{cost} = (VOT) \\times \\beta_{time}\\) and the alternative hypothesis is \\(H_{A}:\\beta_{cost} \\ne (VOT) \\times \\beta_{time}\\). The corresponding t-statistic becomes \\[\\begin{equation} $\\displaystyle t-statistic = \\frac{\\hat{\\beta}_{cost}-(VOT)\\hat\\beta_{time}}{\\sqrt{S_{cost}^{2}+(VOT)^{2}S_{time}^{2}-2(VOT)S_{time,cost}}}$ (\\#eq:corresponding t-statistic) \\end{equation}\\] The interpretation is the same as above except that the hypothesis refers to the equality of one parameter to the other parameter times an a priori fixed value. In this case, if it is concluded that the hypothesis is not rejected, the ratio constraint can be incorporated in the model by creating a new variable \\(X_{time,\\ cost} = X_{cost}+(VOT)X_{time}\\). 5.7.3.3 Tests of Entire Models The t-statistic is used to test the hypothesis that a single parameter is equal to some pre-selected value or that there is a linear relationship between a pair of parameters. Sometimes, we wish to test multiple hypotheses simultaneously. This is done by formulating a test statistic which can be used to compare two models provided that one is a restricted version of the other; that is, the restricted model can be obtained by imposing restrictions (setting some parameters to zero, setting pairs of parameters equal to one another and so on) on parameters in the unrestricted model. This test statistic can then be used for any case when one or more restrictions are imposed on a model to obtain another model. If all the restrictions that distinguish between the restricted and unrestricted models are valid, one would expect the difference in log-likelihood values (at convergence) of the restricted and unrestricted models to be small. If some or all the restrictions are invalid, the difference in log-likelihood values of the restricted and unrestricted models will be “sufficiently” large to reject the hypotheses. This underlying logic is the basis for the likelihood ratio test. The test statistic is: \\[\\begin{equation} \\displaystyle -2\\times[LL_{R}-LL_{U}] \\tag{5.13} \\end{equation}\\] where \\(LL_{R}\\) is the log-likelihood of the restricted model, and \\(LL_{U}\\) is the log-likelihood of the unrestricted model. This test-statistic is chi-squared distributed. Example chi-squared distributions are shown in Figure 5.4. As with the test for individual parameters, the critical value for determining if the statistic is “sufficiently large” to reject the null hypothesis depends on the level of confidence desired by the model developer. It is also influenced by the number of restrictions23 between the models. Table 5-5 shows the chi-squared values for selected confidence levels and for different numbers of restrictions. Figure 5.5 illustrates the 90% and 95% confidence thresholds on the chi-squared distribution for five degrees of freedom. The critical chi-square values increase with the desired confidence level and the number of restrictions. these_colors = wesanderson::wes_palette(&quot;Darjeeling1&quot;) tibble( x = seq(0, 30, 0.01), `5` = dchisq(x, 5), `10` = dchisq(x, 10), `15` = dchisq(x, 15), ) %&gt;% gather(&quot;Degrees of Freedom&quot;, &quot;Chi-Squared&quot;, -x) %&gt;% ggplot(aes(x = x, y = `Chi-Squared`, color = `Degrees of Freedom`)) + geom_line() + scale_color_manual(values = these_colors) + theme_bw() Figure 5.2: Chi-Squared Distribution for 5, 10, and 15 Degrees of Freedom ggplot(data.frame(x = c(0, 20)), aes(x = x)) + stat_function(fun = dchisq, args = list(df = 5)) + labs( x = &quot;Test Values&quot;, y = &quot;PDF&quot;) + theme_bw() Figure 5.3: Chi-Squared Distribution for 5 Degrees of Freedom Showing 90% and 95% confidence Thresholds Table 5.6: Critical Chi-Squared (\\(\\chi^2\\)) Values for Selected Confidence Levels by Number of Restrictions Number of Restrictions Level.of.Conf. X1 X2 X3 X4 X5 X7 X10 X12 X15 90% 2.71 4.61 6.25 7.78 9.24 12.01 15.99 18.54 22.31 95% 3.84 5.99 7.81 9.49 11.07 14.06 18.31 21.02 25.00 99% 6.63 9.21 11.34 13.28 15.09 18.48 23.21 26.21 30.58 99.5% 7.88 10.60 12.84 14.86 16.75 20.28 25.19 28.30 32.80 99.9% 10.83 13.82 16.27 18.47 20.51 24.32 29.59 32.91 37.70 The likelihood ratio test can be applied to test null hypotheses involving the exclusion of groups of variables from the model. Table 5-6 illustrates the tests of two hypotheses describing restriction on some or all the parameters in the San Francisco Bay Area commuter mode choice model. The first hypothesis is that all the parameters are equal to zero. The formal statement of the null hypothesis in this case, is: \\[\\begin{equation} \\displaystyle H_{0,a}:\\beta_{Travel\\ Time} = \\beta_{Travel\\ Cost} = 0, \\\\ \\beta_{SR2} = \\beta_{SR3} = \\beta_{TR} = \\beta_{WK} = \\beta_{BK} = 0, and \\\\ \\beta_{Income-SR2} = \\beta_{Income-SR3} = \\beta_{Income-Transit} = \\beta_{Income-Bike} = \\beta_{Income-Walk} = 0 \\tag{5.14} \\end{equation}\\] This test is not very useful because we almost always reject the null hypothesis that all coefficients are zero. A somewhat more useful null hypothesis is that the variables in the initial model specification provide no additional information in addition to the market share information represented by the alternative specific constants. The restrictions for this null hypothesis are: \\[\\begin{equation} \\displaystyle H_{0,b}:\\beta_{Travel\\ Time} = \\beta_{Travel\\ Cost} = 0, and \\\\ \\beta_{Income-SR2} = \\beta_{Income-SR3+} = \\beta_{Income-Transit}, and \\\\ \\beta_{Income-Bike} = \\beta_{Income-Walk} = 0 \\tag{5.15} \\end{equation}\\] The log-likelihood values needed to test each of these hypotheses are reported in Table 5.4. In each case, we include the log-likelihood of the restricted and unrestricted models, the calculated chi-square value and the number of restrictions or degrees of freedom as shown in Table 5-6. The confidence or significance of the rejection of the null hypothesis in each case can be obtained by referring to Table 5-5, more extensive published tables or software (most spreadsheet programs) that calculates the precise level of confidence/significance associated with each test result. Table 5.7: Likelihood Ratio Test for Hypothesis \\(H_{0,a}\\) and \\(H_{0,b}\\) Hypothesis LL_U LL_R test_stat df Crtical Chi-Squared at 99.9% Conf. P-value \\(H_{0a}\\) -3626.186 -7309.601 7366.829 12 32.90949 0 \\(H_{0b}\\) -3626.186 -4132.916 1013.459 7 24.32189 0 These two applications of the likelihood ratio test correspond to situations where the null hypothesis leads to a highly restrictive model. These cases are not very interesting since the real value of the likelihood ratio test is in testing null hypotheses which are not so extreme. The log-likelihood ratio test can be applied to test null hypotheses involving the exclusion of selected groups of variables from the model. We consider two such hypotheses. The first is that the time and cost variables have no impact on the mode choice decision, that is, \\(H_{0,C} : \\beta_{Travel Time} = \\beta_{Travel Cost} = 0\\) The second is that income has no effect on the travel mode choice; that is \\(H_{0,D} : \\beta_{Income-SR2} = \\beta_{Income-SR3+} = \\beta_{Income-Transit} = \\beta_{Income-Bike} = \\beta_{Income-Walk} = 0\\) The restricted models that reflect each of these hypotheses and the corresponding unrestricted model are reported in Table 5-7 along with their log-likelihood values. sf_mlogit_basemodels &lt;- sf_mlogit base_model &lt;- mlogit(chosen ~ tvtt + cost| hhinc, data = sf_mlogit_basemodels) incomebase_model &lt;- mlogit(chosen ~ 1 | hhinc, data = sf_mlogit_basemodels) timecostbase_model &lt;- mlogit(chosen ~ tvtt + cost, data = sf_mlogit_basemodels) base_estimation &lt;- list( &quot;Base Model&quot; = base_model, &quot;Base Model without Time and Cost Variables&quot; = incomebase_model, &quot;Base Model without Income Variables&quot; = timecostbase_model ) modelsummary( base_estimation, fmt = &quot;%.4f&quot;, title = &quot;Estimation Results for Base Model and its Restricted Versions&quot; ) (#tab:base_models table 5-7)Estimation Results for Base Model and its Restricted Versions Base Model Base Model without Time and Cost Variables Base Model without Income Variables (Intercept) × Share ride 2 -2.1780 -2.1098 -2.3083 (0.1046) (0.0993) (0.0547) (Intercept) × Share ride 3++ -3.7251 -3.4722 -3.7024 (0.1777) (0.1656) (0.0929) (Intercept) × Transit -0.6709 -1.8198 -0.9739 (0.1326) (0.1023) (0.0885) (Intercept) × Bike -2.3763 -2.6721 -3.0705 (0.3045) (0.3028) (0.1539) (Intercept) × Walk -0.2068 -1.5985 -0.7040 (0.1941) (0.1636) (0.1293) tvtt -0.0513 -0.0514 (0.0031) (0.0031) cost -0.0049 -0.0049 (0.0002) (0.0002) hhinc × Share ride 2 -0.0022 -0.0004 (0.0016) (0.0015) hhinc × Share ride 3++ 0.0004 0.0030 (0.0025) (0.0024) hhinc × Transit -0.0053 -0.0022 (0.0018) (0.0016) hhinc × Bike -0.0128 -0.0122 (0.0053) (0.0054) hhinc × Walk -0.0097 -0.0089 (0.0030) (0.0030) Num.Obs. 5029 5029 5029 AIC 7276.4 8267.2 7289.2 BIC Log.Lik. -3626.186 -4123.615 -3637.579 rho2 0.2534 0.1510 0.2511 rho20 0.5976 0.5424 0.5963 #This code recreates table 5-7 in the text with the correct coefficients and log likelihood #However, the output does not have the correct rho-square values, and is missing a number of separate statistics The statistical test of the hypothesis that time and cost have no effect has a chi-square value of \\[\\begin{equation} \\chi^2 = -2(-4123.6-(-3626.2))=994.8 \\tag{5.16} \\end{equation}\\] with two degrees of freedom (two parameters constrained to zero). The critical \\(\\chi^2\\) with two degrees of freedom at 99.9% confidence (or 0.001 level of significance) is 13.82. Similarly, the statistical test of the hypothesis that income has no effect on mode choice has a chi-square value of \\[\\begin{equation} \\chi^2 = -2(-3637.6-(-3626.2))=22.8 \\tag{5.17} \\end{equation}\\] with five degrees of freedom (five income parameters are constrained to zero). The critical \\(\\chi^2\\) with five degrees of freedom at 99.9% confidence level (or 0.001 level of significance) is 20.51. Thus, both null hypotheses can be rejected at very high levels; that is, neither time and cost nor the income variables should be excluded from the model. The log-likelihood ratio tests for both the above hypotheses are summarized in Table 5-8. tibble( Hypothesis = c(&quot;$H_{0c}$&quot;,&quot;$H_{0d}$&quot;), LL_U = rep(base_model$logLik, 2), LL_R = c(incomebase_model$logLik, timecostbase_model$logLik) ) %&gt;% mutate( test_stat = -2 * (LL_R - LL_U), df = c(2, 5), &quot;Crtical Chi-Squared at 99.9% Conf.&quot; = qchisq(0.999, df), &quot;P-value&quot; = pchisq(test_stat, df, lower.tail = FALSE) ) %&gt;% kbl(align = &#39;c&#39;, caption = &quot;Likelihood Ratio Test for Hypothesis $H_{0,c}$ and $H_{0,d}$&quot;) %&gt;% kable_styling() Table 5.8: Likelihood Ratio Test for Hypothesis \\(H_{0,c}\\) and \\(H_{0,d}\\) Hypothesis LL_U LL_R test_stat df Crtical Chi-Squared at 99.9% Conf. P-value \\(H_{0c}\\) -3626.186 -4123.615 994.8581 2 13.81551 0.0000000 \\(H_{0d}\\) -3626.186 -3637.579 22.7845 5 20.51501 0.0003711 5.7.3.4 Non-nested Hypothesis Tests The likelihood ratio test can only be applied to compare models which differ due to the application of restrictions to one of the models. Such cases are referred to as nested hypothesis tests. However, there are important cases when the rival models do not have this type of restricted – unrestricted relationship. For example, we might like to compare the base model to an alternative specification in which the variable cost divided by income is used to replace cost. This reflects the expectation that the importance of cost diminishes with increasing income. This analysis can be performed by using the non-nested hypothesis test proposed by (J. L. Horowitz and Lerman (1986), 1982). The non-nested hypothesis test uses the adjusted likelihood ratio index, \\(\\overline{\\rho}^2\\), to test the hypothesis that the model with the lower \\(\\overline{\\rho}^2\\) value is the true model.24 In this test, the null hypothesis that the model with the lower value is the true model is rejected at the significance level determined by the following equation:25 \\[\\begin{equation} Significance Level = \\Phi \\left[-{(2(\\overline{\\rho}^2_H-\\overline{\\rho}^2_L) \\times LL(0) + (K_H - K_L))}^{1/2}\\right] \\tag{5.18} \\end{equation}\\] where \\(\\overline{\\rho}^2_L\\) is the adjusted likelihood ratio index for the model with the lower value, \\(\\overline{\\rho}^2_H\\) is the adjusted likelihood ratio index for the model with the higher value \\(K_H\\),\\(K_L\\) are the numbers of parameters in models H and L, respectively, and \\(\\Phi\\) is the standard normal cumulative distribution function. We illustrate the non-nested hypothesis test by applying it to compare the base model with alternative specifications that replace the cost variable with cost divided by income or cost divided by ln(income). The estimation results for all three models are presented in Table 5-9. Since the model using cost not adjusted for income has the best goodness of fit (highest \\(\\overline{\\rho}^2\\)), the null hypotheses for these tests is that the model with cost by income variable or the model with cost by ln(income) is the true model. higher \\(\\overline{\\rho}^2\\). Since all the models have the same number of parameters, the term (K_H-K_L) drops out, and the equation for the test of the cost by income model being true is: \\[\\begin{align*} \\Phi \\left[\\left(-{(2(\\overline{\\rho}^2_H-\\overline{\\rho}^2_L) \\times LL(0) )}^{1/2}\\right)\\right] &amp;= \\Phi \\left[-{(-2(0.5023-0.4897)(-7309.6))}^{1/2}\\right] \\\\ &amp;= \\Phi [-13.58] \\ll 0.001 \\tag{5.19} \\end{align*}\\] The corresponding test for the cost by ln(income) being true is: \\[\\begin{align*} \\Phi \\left[\\left(-{(2(\\overline{\\rho}^2_H-\\overline{\\rho}^2_L) \\times LL(0) )}^{1/2}\\right)\\right] &amp;= \\Phi \\left[-{(-2(0.5023-05015)(-7309.6))}^{1/2}\\right] \\\\ &amp;= \\Phi [-3.420] &lt; 0.001 \\tag{5.20} \\end{align*}\\] The above result implies that the null hypotheses that the models with cost by income variable or cost by ln(income) are true are rejected at a significance level greater than 0.001. However, the significance of rejection is much lower for the cost by ln(income) model and many analysts would adopt that specification on the grounds that it is conceptually more appropriate. This specification suggests that the value of money declines with income but the rate of decline diminishes at higher levels of income. sf_mlogit_costinc &lt;- sf_mlogit %&gt;% mutate( costbyinc = cost / hhinc, costbylninc = cost / log(hhinc) ) base_model &lt;- mlogit(chosen ~ tvtt + cost | hhinc, data = sf_mlogit_costinc) income_model &lt;- mlogit(chosen ~ tvtt + costbyinc | hhinc, data = sf_mlogit_costinc) lnincome_model &lt;- mlogit(chosen ~ tvtt + costbylninc | hhinc, data = sf_mlogit_costinc) income_estimation &lt;- list( &quot;Base Model&quot; = base_model, &quot;Model With Cost By Cost/Income&quot; = income_model, &quot;Model With Cost By ln(Income)&quot; = lnincome_model ) gm &lt;- modelsummary::gof_map gm$omit &lt;- TRUE modelsummary( income_estimation, title = &quot;Models with Cost vs. Cost/Income and Cost/Ln(Income)&quot; ) (#tab:cost_models)Models with Cost vs. Cost/Income and Cost/Ln(Income) Base Model Model With Cost By Cost/Income Model With Cost By ln(Income) (Intercept) × Share ride 2 -2.178 -2.377 -2.282 (0.105) (0.106) (0.105) (Intercept) × Share ride 3++ -3.725 -4.080 -3.906 (0.178) (0.175) (0.177) (Intercept) × Transit -0.671 -0.758 -0.731 (0.133) (0.132) (0.133) (Intercept) × Bike -2.376 -2.771 -2.556 (0.305) (0.296) (0.301) (Intercept) × Walk -0.207 -0.598 -0.369 (0.194) (0.195) (0.194) tvtt -0.051 -0.051 -0.051 (0.003) (0.003) (0.003) cost -0.005 (0.000) hhinc × Share ride 2 -0.002 0.003 0.000 (0.002) (0.002) (0.002) hhinc × Share ride 3++ 0.000 0.010 0.003 (0.003) (0.002) (0.002) hhinc × Transit -0.005 -0.001 -0.004 (0.002) (0.002) (0.002) hhinc × Bike -0.013 -0.004 -0.010 (0.005) (0.005) (0.005) hhinc × Walk -0.010 -0.002 -0.007 (0.003) (0.003) (0.003) costbyinc -0.169 (0.010) costbylninc -0.019 (0.001) Num.Obs. 5029 5029 5029 AIC 7276.4 7460.8 7282.0 BIC Log.Lik. -3626.186 -3718.390 -3629.000 rho2 0.253 0.234 0.253 rho20 0.598 0.587 0.597 5.8 Value of Time 5.8.1 Value of Time for Linear Utility Function The value of time, as described in Section 5.7.1.3, is calculated as the ratio of the parameter for time over the parameter for cost. This ratio assumes that the utility function is linear in both time and cost and that neither value is interacted with any other variables. That is, when the time and cost portion of the utility function is \\[\\begin{equation} V_i = ... + \\beta_{TVT}TVT_i + \\beta_{Cost}Cost_i + ... \\tag{5.21} \\end{equation}\\] the value of time is given by \\[\\begin{equation} VofT = \\beta_{TVT} \\Huge/ \\normalsize \\beta_{Cost} \\tag{5.22} \\end{equation}\\] The units of time value are obtained from the units of the variables used to measure time and cost. In the Base Model in Table 5.9, the units are minutes and cents. Thus the value of time in cents per minute implied by this model is -0.0513/-0.0049 = 10.5 cents per minute. This can be modified to $ per hour by multiply by 0.6 = (1/100 $ per cent)/(1/60 hour per minute). However, in general, the value of time is equal to the ratio between the derivative of utility with respect to time and the derivative of utility with respect to cost. That is \\[\\begin{equation} VofT = \\frac{\\partial{V_i}}{\\partial{Time_i}} \\Huge/ \\normalsize \\frac{\\partial{V_i}}{\\partial{Cost_i}} \\tag{5.23} \\end{equation}\\] In the case described in Equation 5.24, this produces the ratio in Equation 5.25. However, this more general formulation allows us to infer the value of time for a variety of special cases in addition to the linear utility case described above. 5.8.2 Value of Time when Cost is Interacted with another Variable This approach can be applied to any case including when either time or cost is interacted with another variable, usually a variable describing the decision maker or the decision context. For example, if cost is divided by income26 as in the second model reported in Table 5-9, on the basis that a unit of cost is proportionally less important with increasing income, the utility expression becomes \\[\\begin{equation} V_{it} = ... + \\beta_{TVT}TVT_{it} + \\beta_{CostInc}\\frac{Cost_{it}}{Income_t} + ... \\tag{5.24} \\end{equation}\\] and the value of time becomes \\[\\begin{equation} VofT = \\frac{\\partial{V_i}}{\\partial{Time_i}} \\Huge/ \\normalsize {\\frac{\\partial{V_i}}{\\partial{Cost_i}}} = {\\beta_{TVT}} \\Huge/ \\normalsize {\\beta_{CostInc}} \\Huge/ \\normalsize {Income_i} \\tag{5.25} \\end{equation}\\] which can be converted to \\[\\begin{equation} VofT = \\frac{\\frac{\\beta_{TVT}}{\\beta_{Cost}}}{Income($1000/year)}{cents/minute} \\tag{5.26} \\end{equation}\\] or \\[\\begin{equation} VofT = \\frac{0.6 \\times \\frac{\\beta_{TVT}}{\\beta_{Cost}}}{Income($1000/year)}{$/hour} \\end{equation}\\] Similarly, the value of time for the third specification in Table 5-9 is \\[\\begin{equation} VofT = \\frac{0.6 \\times \\frac{\\beta_{TVT}}{\\beta_{Cost}}}{ln[Income($1000/year)]}{$/hour} \\end{equation}\\] The value of time implied by each of these formulations is illustrated in Table 5-10 and Figure 5.6 by showing the values of time for different income levels. In each case, the values of travel time appear to be quite low. This will be addressed in model specification refinement (Section 6.2.6). tibble( AnnualIncome = c(25000, 50000, 75000, 100000, 125000)) %&gt;% mutate(HourlyWage= AnnualIncome/2000) %&gt;% mutate(linear = c(6.26, 6.26, 6.26, 6.26, 6.26)) %&gt;% mutate(CostIncome = c(4.53, 9.07, 13.60, 18.13, 21.94)) %&gt;% mutate(CostLn = c(5.18, 6.29, 6.95, 7.41, 7.72)) %&gt;% knitr::kable( caption = &quot;Value of Time vs. Income&quot;, col.names = c(&quot;Annual Income&quot;, &quot;Hourly Wage&quot;, &quot;Linear&quot;, &quot;Cost/Income&quot;, &quot;Cost/LN(Inc.)&quot;)) Table 5.9: Value of Time vs. Income Annual Income Hourly Wage Linear Cost/Income Cost/LN(Inc.) 25000 12.5 6.26 4.53 5.18 50000 25.0 6.26 9.07 6.29 75000 37.5 6.26 13.60 6.95 100000 50.0 6.26 18.13 7.41 125000 62.5 6.26 21.94 7.72 Another approach that can be used in this case is to relate the value of travel directly to the wage rate by assuming that the working year consists of 2000 hours or 120,000 minutes and recognizing that $1000 dollars is equivalent to 100,000 cents. This gives us \\[\\begin{equation} Units_{VofT} = cents \\Huge/ \\normalsize minute \\Huge/ \\normalsize $1000 \\Huge/ \\normalsize year \\tag{5.27} \\end{equation}\\] \\[\\begin{equation} = cents \\Huge/ \\normalsize minute \\Huge/ \\normalsize 100,000~cents \\Huge/ \\normalsize 120,000~minutes \\end{equation}\\] \\[\\begin{equation} = 1.2 \\end{equation}\\] That is, there are no units but a simple factor of 1.2. This is interpreted as the value by which the ratio of the parameters should be multiplied to get the value of travel time as a fraction of the wage rate. In the cost by income model in Table 5-9 Models with Cost vs. Cost/Income and Cost/Ln(Income), this becomes \\[\\begin{equation} VofT = \\beta_{TVT} \\Huge/ \\normalsize \\beta_{CostInc} \\times 1.2 = \\frac{-0.0512}{-0.1692} \\times 1.2 = 0.363~Wage~Rate \\tag{5.28} \\end{equation}\\] which, as before, is quite low. However, as shown in Figure 5.6 and discussed in Section 5.7.3.4, this specification and the related specification for cost by ln(income) have the advantage that the value of time is differentiated across households with different income. 5.8.3 Value of Time for Time or Cost Transformation If time or cost is transformed, it becomes necessary to explicitly take the derivative of utility with respect to both time and cost. For example, if time enters the utility function using the natural log transformation, to suggest that the utility effect of increasing time decreases with time, the utility function becomes \\[\\begin{equation} V_{it} = ... + \\beta_{ln(TVT)}ln(TVT_{it}) + \\beta_{Cost}Cost_{it} + ... \\tag{5.29} \\end{equation}\\] and the value of time becomes \\[\\begin{equation} VofT = \\frac{\\partial{V_{it}}}{\\partial{Time_{it}}} \\Huge/ \\normalsize \\frac{\\partial{V_{it}}}{\\partial{Cost_{it}}} = \\beta_{ln(TVT)} \\Huge/ \\normalsize TVT_{it} \\Huge/ \\normalsize \\beta_{Cost} = \\frac{\\beta_{ln(TVT)}}{\\beta_{Cost}} \\times \\frac{1}{TVT_{it}} \\tag{5.30} \\end{equation}\\] Similarly, if cost is entered as the natural log of cost, the value of time becomes \\[\\begin{equation} VofT = \\frac{\\partial{V_{it}}}{\\partial{Time_{it}}} \\Huge/ \\normalsize \\frac{\\partial{V_{it}}}{\\partial{Cost_{it}}} = \\beta_{TVT} \\Huge/ \\normalsize \\beta_{ln(Cost)} \\Huge/ \\normalsize Cost_{it} = \\frac{\\beta_{TVT}}{\\beta_{ln(Cost)}} \\times Cost_{it} \\tag{5.31} \\end{equation}\\] which can be reported in a table for selected values of time or plotted in a graph of Value of Time as a function of TVT or Cost, as appropriate (see below). Models using each of these formulations are estimated and reported, along with the Base Model in Table 5-11. The goodness of fit is substantially improved by using ln(time), which is generally expected, but is worse when using ln(cost), for which there is no conceptual basis. base_model &lt;- mlogit(chosen ~ tvtt + cost | hhinc, data = sf_mlogit) lntravaltime_model &lt;- mlogit(chosen ~ cost + log(tvtt) | hhinc, data = sf_mlogit) # lots of variables have zero cost, and log(0) = -Inf. To keep this model estimable, we can # add 0.01 dollars to all alternatives, because log function is monotonically increasing. lntravelcost_model &lt;- mlogit(chosen ~ tvtt + I(log(cost + 0.01)) | hhinc, data = sf_mlogit) transformations_estimation &lt;- list( &quot;Base Model&quot; = base_model, &quot;Model With Log of Travel Time&quot; = lntravaltime_model, &quot;Model With Log of Travel Cost&quot; = lntravelcost_model ) gm &lt;- modelsummary::gof_map gm$omit &lt;- TRUE modelsummary( transformations_estimation,fmt = &quot;%.4f&quot;, title = &quot;Base Model and Log Transformations&quot; ) Table 5.10: Base Model and Log Transformations Base Model Model With Log of Travel Time Model With Log of Travel Cost (Intercept) × Share ride 2 -2.1780 -1.7457 -2.4748 (0.1046) (0.1091) (0.1072) (Intercept) × Share ride 3++ -3.7251 -3.1395 -4.3121 (0.1777) (0.1805) (0.1782) (Intercept) × Transit -0.6709 0.0788 0.0194 (0.1326) (0.1509) (0.1371) (Intercept) × Bike -2.3763 -1.6413 -10.4405 (0.3045) (0.3092) (0.5238) (Intercept) × Walk -0.2068 1.1878 -7.7790 (0.1941) (0.2324) (0.4402) tvtt -0.0513 -0.0602 (0.0031) (0.0032) cost -0.0049 -0.0034 (0.0002) (0.0002) hhinc × Share ride 2 -0.0022 -0.0026 -0.0009 (0.0016) (0.0016) (0.0015) hhinc × Share ride 3++ 0.0004 0.0001 0.0025 (0.0025) (0.0025) (0.0024) hhinc × Transit -0.0053 -0.0066 -0.0051 (0.0018) (0.0019) (0.0018) hhinc × Bike -0.0128 -0.0125 -0.0131 (0.0053) (0.0053) (0.0054) hhinc × Walk -0.0097 -0.0090 -0.0089 (0.0030) (0.0031) (0.0031) log(tvtt) -2.3992 (0.1244) I(log(cost + 0.01)) -1.0150 (0.0502) Num.Obs. 5029 5029 5029 AIC 7276.4 7205.0 7383.4 BIC Log.Lik. -3626.186 -3590.502 -3679.717 rho2 0.2534 0.2608 0.2424 rho20 0.5976 0.6015 0.5916 The implications for value of time of these different formulations are shown in Table 5-12 and Table 5-13 Value of Time for Log of Cost Model and also in Figure 5.7 and Figure 5.8. # in a log of time model, the value of time is a function of the trip time. ln_vot &lt;- function(model, ttime){ ValueCentsMin = coef(model)[&quot;log(tvtt)&quot;] / (coef(model)[&quot;cost&quot;] * ttime) } tibble( triptime = c(5, 15, 30, 60, 90, 120), vot = ln_vot(lntravaltime_model, triptime) ) %&gt;% mutate(vot_dhr = vot * 0.6) %&gt;% kbl(digits = 2, caption = &quot;Value of Time for Log of Time Model&quot;, col.names = c(&quot;Trip Time (min)&quot;, &quot;Value of Time (cents/min)&quot;, &quot;Value of Time ($/hr)&quot;)) %&gt;% kable_styling() Table 5.11: Value of Time for Log of Time Model Trip Time (min) Value of Time (cents/min) Value of Time ($/hr) 5 139.76 83.86 15 46.59 27.95 30 23.29 13.98 60 11.65 6.99 90 7.76 4.66 120 5.82 3.49 tibble( triptime = seq(5, 120, by = 1), vot = 0.6 * ln_vot(lntravaltime_model, triptime) ) %&gt;% ggplot(aes(y = vot, x = triptime)) + geom_line() + scale_y_continuous(labels=scales::dollar_format())+ labs( x= &quot;Time of Trip (min)&quot;, y = &quot;Value of Time ($/hr)&quot;) + theme_bw() Figure 5.4: Value of time for log of time model as a function of trip time. Table 5.12: Value of Time for Log of Cost Model Trip cost Value of time ($/hr) $0.25 0.85 $0.50 $1.71 $1.00 $3.42 $2.00 $6.83 $5.00 $17.09 References "],["specification-chapter.html", "Chapter 6 Model Specification Refinement: San Francisco Bay Area Work Mode Choice 6.1 Introduction 6.2 Alternative Specifications 6.3 Market Segmentation 6.4 Summary", " Chapter 6 Model Specification Refinement: San Francisco Bay Area Work Mode Choice # work trips data frame constructed in chapter 5 sf_mlogit &lt;- read_rds(&quot;data/worktrips.rds&quot;) 6.1 Introduction This chapter describes and demonstrates the refinement of the utility function specification for the multinomial logit (MNL) model for work mode choice in the San Francisco Bay Area. The process combines the use of intuition, statistical analysis and testing, and judgment. The intuition and judgment components of the model refinement process are based on theory, anecdotal evidence, logical analysis, and the accumulated empirical experience of the model developer. This empirical experience can be and often is enhanced through the advice of others or through review of reports and published papers documenting previous modeling studies for similar choice problems and contexts. We explore a variety of different specifications of the utility functions to demonstrate some of the most common specifications and testing methods. These tests include both formal statistical tests and informal judgments about the signs, magnitudes, or relative magnitudes of parameters based on our knowledge about the underlying behavioral relationships that influence mode choice. The use of judgment and experience is an essential element of successful model development since it is almost impossible to determine the “best” model specification solely on the basis of statistical tests. A model that fits the data well may not necessarily describe the causal relationships and may not produce the most reasonable predictions. Also, it is not uncommon to find several model specifications that, for all practical purposes, fit the data equally well, but which have very different specifications and forecast implications. Therefore, practical model building involves considerable use of subjective judgment and is as much an art as it is a science. Different modelers have different styles and approaches to the model development process. One of the most common approaches is to start with a minimal specification which includes those variables that are considered essential to any reasonable model. In the case of mode choice, such a specification might include travel time, travel cost and departure frequency where appropriate for each alternative. Working from this minimal specification, incremental changes are proposed and tested in an effort to improve the model in terms of its behavioral realism and/or its empirical fit to the data while avoiding excessive complexity of the model. Another common approach is to start with a richer specification which represents the model developer’s judgment about the set of variables that is likely to be included in the final model specification. For example, such a model might include travel time (separated into in-vehicle and out-of-vehicle time), out of vehicle travel time might be adjusted to take account of the total distance traveled, out of pocket travel cost (possibly adjusted by household income), frequency of departure for carrier modes, household automobile ownership or availability, household income, and size of the travel party. We adopt the first of these methods in the following section for refinement of the specification of a model of work mode choice as it is the most appropriate approach for those who are new to discrete choice modeling. At each stage in the model development process, we introduce incremental changes to the modal utility functions and re-estimate the model with the objective of finding a more refined model specification that performs better statistically and is consistent with theory and our a priori expectations about mode choice behavior. We introduce small changes at each step as the estimation results for each stage provide useful insights which may be helpful in further refining the model. The appropriateness of each specification change is evaluated at each step using both judgmental and statistical tests. In the rest of this chapter, we describe and demonstrate this process for work mode choice in the San Francisco Bay Area. 6.2 Alternative Specifications The basic multinomial logit mode choice model for work commute in the San Francisco Bay Area was reported in Table 5.4 in CHAPTER 5 . The refinements we consider include: - Different specifications of the income effects, - Different specifications of travel time, - Additional decision maker related variables such as gender and automobiles owned, - Additional variables that represent the interaction of decision maker related variables with mode related variables (e.g., interaction of income with cost), and - Additional trip context variables (e.g., dummy variable indicating if the trip origin/destination is in a Central Business District). 6.2.1 Refinement of Specification for Alternative Specific Income Effects The estimation results for the base model in CHAPTER 5 yielded time and cost parameter estimates that had the expected (negative) sign and were statistically significant. The parameters for the alternative specific income variables were significant and had the expected sign (negative relative to drive alone) except for the shared ride specific income variables (shared ride 2 and shared ride 3+) which were not significant and the sign on the shared ride 3+ income variable was counter-intuitive. All else being equal, we expect the preference for shared ride 2 to be negative relative to drive alone and for shared ride 3+ to be more negative than shared ride 2 because of the increasing inconvenience of coordinating with other travelers as the number of persons in the ride sharing group increases. However, the empirical results provide only limited support for the first expectation and are inconsistent with the second expectation. This suggests that the effect of income on choice is not necessarily different among the automobile modes. We approach this inconsistency between expectation and empirical results by thinking of other plausible relationships for the effect of income on shared ride choice and developing alternative specifications which represent these relationships. Options for consideration include: The effect of income relative to drive alone is the same for the two shared ride modes (shared ride 2 and shared ride 3+) but is different from drive alone and different from the other modes. This relationship is represented by constraining the income coefficients in the two shared alternatives to be equal as follows: \\[\\begin{equation} H_0 : \\beta_{IncomeSR2} = \\beta_{IncomeSR3+} \\tag{6.1} \\end{equation}\\] The effect of income relative to drive alone is the same for both shared ride modes and transit but is different for the other modes. This is represented in the model by constraining the income coefficients in both shared ride modes and the transit mode to be equal as: \\[\\begin{equation} H_0 : \\beta_{Income-SR2} = \\beta_{Income-SR3+} = \\beta_{Income-Transit} \\tag{6.2} \\end{equation}\\] The effect of income on all the automobile modes (drive alone, shared ride 2, and shared ride 3+) is the same, but the effect is different for the other modes. We include this constraint by setting the income coefficients in the utilities of the automobile modes to be equal. In this case, we set them to zero since drive alone is the reference mode. \\[\\begin{equation} H_0 : \\beta_{IncomeSR2} = \\beta_{IncomeSR3+} = 0 \\tag{6.3} \\end{equation}\\] The estimation results for the base model (from CHAPTER 5) and for these three alternative models are reported in Table ??. The parameter estimates for all three models are consistent with expectations. That is, the effect of increasing income is neutral or negative for the shared ride modes relative to drive alone and equal to or more negative for transit, bike and walk than for shared ride. Further, all the parameters are significant except for the shared ride income parameters in Model 1W. Selection of one of these four models to represent the effect of income should consider the statistical relationships among them and the reasonableness of the resultant models. Since Models 1W, 2W and 3W are constrained versions of the Base Model and Models 2W and 3W are constrained versions of Model 1W, we can use the likelihood ratio test to evaluate the hypotheses implied by each of these models (see section 5.7.3.2). We use this test to determine if the hypothesis that each of these models is the true model is or is not rejected by the less restricted model. The likelihood ratio statistics (Equation 5.16), the degrees of freedom or number of restrictions and the level of significance for each test are reported relative to the Base Model and to Model 1W in Table 6.2, respectively. The Base Model cannot reject any of the subsequent models at a reasonable level of significance. Further, the Base Model has a counter-intuitive relationship between the parameters for shared ride 2 and shared ride 3+. Thus, Model 1W or Model 3W can represent the effect of income on mode choice in this case. We choose Model 1W because it is most consistent with our prior hypotheses about the effect of income on preference between drive alone and shared ride and other modes. However, the differences among these models are small both statistically and behaviorally so the decision should be subject to a review before adoption of the final specification.27 model_base &lt;- mlogit(chosen ~ tvtt + cost | hhinc, data = sf_mlogit, ) #Having issues setting Shared Ride 2 and 3+ to be equal to each other model_1w &lt;- mlogit(chosen ~ tvtt + cost | hhinc, data = sf_mlogit) #Having issues setting Shared Ride 2, 3+, and Transit to be equal to each other model_2w &lt;- mlogit(chosen ~ tvtt + cost | hhinc, data = sf_mlogit) model_3w &lt;- mlogit(chosen ~ tvtt + cost | hhinc, data = sf_mlogit, constPar = c(&#39;hhinc:Share ride 2&#39; = 0, &#39;hhinc:Share ride 3++&#39; = 0)) altspecinc_estimation &lt;- list( &quot;Base Model &quot; = model_base, &quot;Model 1W&quot; = model_1w, &quot;Model 2W&quot; = model_2w, &quot;Model 3W&quot; = model_3w ) modelsummary( altspecinc_estimation, fmt = &quot;%.4f&quot;, title = &quot;Alternative Specifications of Income Variable&quot; ) Table 6.1: Alternative Specifications of Income Variable Base Model Model 1W Model 2W Model 3W (Intercept) × Share ride 2 -2.1780 -2.1780 -2.1780 -2.3043 (0.1046) (0.1046) (0.1046) (0.0547) (Intercept) × Share ride 3++ -3.7251 -3.7251 -3.7251 -3.7036 (0.1777) (0.1777) (0.1777) (0.0930) (Intercept) × Transit -0.6709 -0.6709 -0.6709 -0.6976 (0.1326) (0.1326) (0.1326) (0.1304) (Intercept) × Bike -2.3763 -2.3763 -2.3763 -2.3981 (0.3045) (0.3045) (0.3045) (0.3038) (Intercept) × Walk -0.2068 -0.2068 -0.2068 -0.2292 (0.1941) (0.1941) (0.1941) (0.1933) tvtt -0.0513 -0.0513 -0.0513 -0.0513 (0.0031) (0.0031) (0.0031) (0.0031) cost -0.0049 -0.0049 -0.0049 -0.0049 (0.0002) (0.0002) (0.0002) (0.0002) hhinc × Share ride 2 -0.0022 -0.0022 -0.0022 (0.0016) (0.0016) (0.0016) hhinc × Share ride 3++ 0.0004 0.0004 0.0004 (0.0025) (0.0025) (0.0025) hhinc × Transit -0.0053 -0.0053 -0.0053 -0.0049 (0.0018) (0.0018) (0.0018) (0.0018) hhinc × Bike -0.0128 -0.0128 -0.0128 -0.0125 (0.0053) (0.0053) (0.0053) (0.0053) hhinc × Walk -0.0097 -0.0097 -0.0097 -0.0093 (0.0030) (0.0030) (0.0030) (0.0030) Num.Obs. 5029 5029 5029 5029 AIC 7276.4 7276.4 7276.4 7278.5 BIC Log.Lik. -3626.186 -3626.186 -3626.186 -3627.234 rho2 0.2534 0.2534 0.2534 0.2532 rho20 0.5976 0.5976 0.5976 0.5975 Table 6.2: Likelihood Ratio Tests between Models 1W, 2W, 3W and Base Model Model loglik lrtest p_val Model 1W -3626.186 0.000000 1 Model 2W -3626.186 0.000000 1 Model 3W -3627.234 2.094772 0 6.2.2 Different Specifications of Travel Time The specification for travel time in the above models implies that the utility value of time is equal for all the alternatives and between in-vehicle and out-of-vehicle time. However, we expect travelers in non-motorized modes to be more sensitive to travel time than travelers in motorized modes (since walking or biking is physically more demanding than traveling in a car) and we expect that travelers are more sensitive to out-of-vehicle travel time (OVT) than to in vehicle travel time (IVT). The estimation results for two specifications of travel time that relax these constraints are reported with those for Model 1W in Table 6.3. Model 5W relaxes the time constraints in Model 1W by specifying distinct time variables for the motorized and non-motorized modes based on our expectation that travelers are likely to be more sensitive to travel time by non-motorized modes. Model 6W relaxes the constraint further by disaggregating the travel time for motorized modes into distinct components for IVT and OVT. This specification allows the two components of travel time for motorized travel to have different effects on utility with the expectation that travelers are more sensitive to out-of-vehicle time than in-vehicle time. The estimation results for Model 5W rejects the hypothesis of equal value of travel time across modes implied in Model 1W and Model 6W rejects the hypothesis of equal value of in and out of travel time for the motorized modes at a very high level of significance \\((0.001)\\). The estimated parameters associated with travel time in Model 6W have the correct signs and the magnitude of the parameters for OVT for motorized modes and for time for non-motorized modes are larger in magnitude than the parameter for IVT, as expected; however, the parameter for IVT is very small and not statistically significant. Further, the ratio of OVT to IVT for motorized modes, 30 times, is far greater than expected. Nonetheless, since Model 6W rejects the constraints imposed by both Models 1W and 5W at a very high level of significance, we cannot discard this model without further exploration. Another perspective on the suitability of these models can be obtained by calculating the relative importance of each component of travel time and cost which gives us the implied value of each component of time. The implied value of in-vehicle-time for motorized modes is computed for each model using the estimated motorized in-vehicle-time and cost parameters and similarly for the other time components: \\[\\begin{equation} $\\displaystyle = \\text{Value of motorized IVTT (\\$/hour)} = \\frac{\\beta_\\text{motorized ivtt (1/min.)}}{\\beta_{cost (1/cents)}} \\times \\frac{60 min./hour}{100 cents/\\$} $ \\tag{6.4} \\end{equation}\\] The implied values of in- and out-of-vehicle times for motorized modes in Models 1W, 5W, and 6W are reported in Table 6.4. The values of motorized in-vehicle time and non-motorized time are somewhat low but not unreasonable compared to the average wage rate of $21.20 per hour in the region (1990 dollars); however, the value of in-vehicle time is unreasonably low. Nevertheless, the likelihood ratio tests reject both Model 5W and Model 1W at very high levels of significance. This raises doubt about the suitability of those models and suggests the need to consider other specifications to evaluate the influence of travel time components on the utilities of the different alternatives. Two approaches are commonly taken to identify a specification which is not statistically rejected by other models and has good behavioral relationships among variables. The first is to examine a range of different specifications in an attempt to find one which is both behaviorally sound and statistically supported. The other is to constrain the relationships between or among parameter values to ratios which we are considered reasonable. The formulation of these constraints is based on the judgment and prior empirical experience of the analyst. Therefore, the use of such constraints imposes a responsibility on the analyst to provide a sound basis for his/her decision. The advice of other more experienced analysts is often enlisted to expand and/or support these judgments. #Having issues setting Shared Ride 2 and 3+ to be equal to each other model_5w &lt;- mlogit(chosen ~ mot_tvtt + nm_tvtt + cost | hhinc, data = sf_mlogit) #Having issues setting Shared Ride 2 and 3+ to be equal to each other model_6w &lt;- mlogit(chosen ~ nm_tvtt + mot_ovtt + mot_ivtt + cost | hhinc, data = sf_mlogit) altspectvtt_estimation &lt;- list( &quot;Model 1W&quot; = model_1w, &quot;Model 5W&quot; = model_5w, &quot;Model 6W&quot; = model_6w ) modelsummary( altspectvtt_estimation, fmt = &quot;%.4f&quot;, title = &quot;Estimation Results for Alternative Specifications of Travel Time[^trumodel], [^valuesoftime]&quot; ) Table 6.3: Estimation Results for Alternative Specifications of Travel Time28,29 Model 1W Model 5W Model 6W (Intercept) × Share ride 2 -2.1780 -2.2279 -2.3961 (0.1046) (0.1052) (0.1075) (Intercept) × Share ride 3++ -3.7251 -3.7897 -3.9957 (0.1777) (0.1782) (0.1802) (Intercept) × Transit -0.6709 -0.8532 -0.4910 (0.1326) (0.1392) (0.1490) (Intercept) × Bike -2.3763 -1.8437 -1.7186 (0.3045) (0.3258) (0.3231) (Intercept) × Walk -0.2068 0.4773 0.4096 (0.1941) (0.2522) (0.2533) tvtt -0.0513 (0.0031) cost -0.0049 -0.0050 -0.0048 (0.0002) (0.0002) (0.0002) hhinc × Share ride 2 -0.0022 -0.0021 -0.0022 (0.0016) (0.0016) (0.0016) hhinc × Share ride 3++ 0.0004 0.0004 0.0003 (0.0025) (0.0025) (0.0025) hhinc × Transit -0.0053 -0.0054 -0.0057 (0.0018) (0.0018) (0.0019) hhinc × Bike -0.0128 -0.0125 -0.0122 (0.0053) (0.0053) (0.0052) hhinc × Walk -0.0097 -0.0095 -0.0093 (0.0030) (0.0031) (0.0031) mot_tvtt -0.0431 (0.0035) nm_tvtt -0.0687 -0.0632 (0.0053) (0.0054) mot_ovtt -0.0759 (0.0059) mot_ivtt -0.0025 (0.0062) Num.Obs. 5029 5029 5029 AIC 7276.4 7259.0 7203.3 BIC Log.Lik. -3626.186 -3616.494 -3587.643 rho2 0.2534 0.2554 0.2614 rho20 0.5976 0.5986 0.6018 Table 6.4: Implied Values of Time in Models 13W, 14W, and 15W Value of Time ($/hr) Model 1W Model 5W Model 6W Value of Non-Motorized Time 6.26 8.24 7.91 Value of Out-of-vehicle Time 6.26 5.17 9.50 Value of In-vehicle Time 6.26 5.17 0.32 The primary shortcoming of the specification in Model 6W is that the estimated value of IVT is unrealistically small. At least two alternatives can be considered for getting an improved estimate of the value of out-of-vehicle time. One is to use an approach that has been effective in other contexts; that is, to assume that the sensitivity of travelers to OVT diminishes with the trip distance. The idea behind this is that travelers are more willing to tolerate higher out-of-vehicle time for a long trip rather than for a short trip. We still expect that travelers will be more sensitive to OVT than IVT for any travel distance. A formulation which ensures this result is to include total travel time (the sum of in-vehicle and out-of-vehicle time) and out-of-vehicle time divided by distance in place of in- and out-of-vehicle travel time. This specification, as shown below, is consistent with our expectations provided that \\(\\beta_1\\) and \\(\\beta_2\\) are negative: \\[\\begin{equation} \\begin{split} V_{m} &amp;= \\gamma_{0,m} + \\beta_{1} \\times TTT_{m} + \\beta_{2} \\times \\Big(\\frac{OVT_{m}}{Dist}\\Big) + \\ldots\\\\ &amp;= \\gamma_{0,m} + \\beta_{1} \\times (IVT_{m} + OVT_{m}) + \\frac{\\beta_{2}}{Dist} \\times OVT_{m} + \\ldots\\\\ &amp;= \\gamma_{0,m} + \\beta_{1} \\times IVT_{m} + \\Big(\\beta_{1} + \\frac{\\beta_{2}}{Dist}\\Big) \\times OVT_{m} + \\ldots \\end{split} \\tag{6.5} \\end{equation}\\] An alternative approach is to impose a constraint on the relative importance of OVT and IVT. This is achieved by replacing the travel time variables in the modal utility equations with a weighted travel time (WTT) variable defined as in-vehicle time plus the appropriate travel time importance ratio (TIR) times out-of-vehicle time (IVT + TIR×OVT). The mechanics of how this constraint works is illustrated as follows: \\[\\begin{equation} \\begin{split} V_{m} &amp;= \\gamma_{0,m} + \\beta_{1} \\times IVT + (\\beta_{1} \\times TIR) \\times OVT + \\ldots \\\\ &amp;= \\gamma_{0,m} + \\beta_{1} \\times (IVT + TIR \\times OVT) + \\ldots\\\\ &amp;= \\gamma_{0,m} + \\beta_{1} \\times WTT + \\ldots \\end{split} \\tag{6.6} \\end{equation}\\] so that the parameter for out-of-vehicle time is equal to the parameter for in-vehicle time multiplied by the selected travel time ratio (TTR). In Models 8W and 9W, we use travel importance ratios of 2.5 and 4.0, respectively. The estimation results for these models compared to Model 6W are reported in Table 6-5. The parameter estimates obtained for the travel time, cost, and income variables in all four models have the correct signs and are statistically significant. Model 7W has substantially better goodness-of-fit than Models 6W, 8W and 9W. Since none of the other models are constrained versions of Model 7W, we use the non-nested hypothesis test (see Section 5.7.3.2, Equation 5.21) to compare it with Models 6W, 8W, and 9W. We illustrate the non-nested hypothesis test by applying it to the hypothesis that Model 6W is the true model given that Model 7W has a higher \\(\\bar{\\rho}^{2}\\). Since both models have the same number of parameters, the term (K7-K6) drops out, and the equation becomes \\[\\begin{equation} \\begin{split} \\mathrm{Level of Rejection} &amp;= \\Phi[-(-2(\\bar{\\rho_{7}}^{2}-\\bar{\\rho_{6}}^{2})\\ l(0))^{1/2}]\\\\ &amp;= \\Phi[-(-2(0.5129-0.5074)(-7309.6))^{1/2}]\\\\ &amp;= \\Phi(-8.97)&lt;&lt; 0.001 \\end{split} \\tag{6.7} \\end{equation}\\] That is, the null hypothesis that Model 6W is the true model is rejected with significance much greater than \\(0.001\\). Models 8W and 9W are also rejected as the true model at an even higher level of significance. sf_mlogit_trip_estimates &lt;- sf_mlogit %&gt;% mutate( TIR8 = (mot_ivtt + 2.4 * mot_ovtt), TIR9 = (mot_ivtt + 4 * mot_ovtt), ovtd = mot_ovtt/dist, scalemot = 2.4 * mot_ovtt, scalemot2 = 4 * mot_ovtt ) model_7w &lt;- mlogit(chosen ~ mot_tvtt + nm_tvtt + ovtd + cost | hhinc, data = sf_mlogit_trip_estimates) model_8w &lt;- mlogit(chosen ~ nm_tvtt + TIR8 + cost | hhinc, data = sf_mlogit_trip_estimates) model_9w &lt;- mlogit(chosen ~ nm_tvtt + TIR9 + cost | hhinc, data = sf_mlogit_trip_estimates) model_8a &lt;- mlogit(chosen ~ nm_tvtt + (mot_ivtt + scalemot) + cost | hhinc, data = sf_mlogit_trip_estimates) model_9a &lt;- mlogit(chosen ~ nm_tvtt + (mot_ivtt + scalemot2) + cost | hhinc, data = sf_mlogit_trip_estimates) Table 6.5: Estimation Results for Additional Travel Time Specification Testing Model 6W Model 7W Model 8W Model 9W (Intercept) × Share ride 2 -2.3961 -2.1519 -2.2923 -2.3302 (0.1075) (0.1047) (0.1042) (0.1039) (Intercept) × Share ride 3++ -3.9957 -3.6362 -3.8650 -3.9120 (0.1802) (0.1758) (0.1772) (0.1768) (Intercept) × Transit -0.4910 -0.0431 -0.5897 -0.5281 (0.1490) (0.1597) (0.1462) (0.1479) (Intercept) × Bike -1.7186 -2.6862 -1.8035 -1.7741 (0.3231) (0.3337) (0.3240) (0.3232) (Intercept) × Walk 0.4096 -1.0226 0.4439 0.4297 (0.2533) (0.2920) (0.2524) (0.2526) nm_tvtt -0.0632 -0.0475 -0.0664 -0.0652 (0.0054) (0.0055) (0.0053) (0.0053) mot_ovtt -0.0759 (0.0059) mot_ivtt -0.0025 (0.0062) cost -0.0048 -0.0041 -0.0049 -0.0048 (0.0002) (0.0002) (0.0002) (0.0002) hhinc × Share ride 2 -0.0022 -0.0020 -0.0022 -0.0022 (0.0016) (0.0015) (0.0016) (0.0016) hhinc × Share ride 3++ 0.0003 0.0006 0.0004 0.0003 (0.0025) (0.0025) (0.0025) (0.0025) hhinc × Transit -0.0057 -0.0072 -0.0055 -0.0055 (0.0019) (0.0019) (0.0018) (0.0018) hhinc × Bike -0.0122 -0.0119 -0.0124 -0.0123 (0.0052) (0.0052) (0.0053) (0.0052) hhinc × Walk -0.0093 -0.0082 -0.0095 -0.0094 (0.0031) (0.0032) (0.0031) (0.0031) mot_tvtt -0.0415 (0.0035) ovtd -0.1813 (0.0179) TIR8 -0.0262 (0.0019) TIR9 -0.0173 (0.0013) Num.Obs. 5029 5029 5029 5029 AIC 7203.3 7121.8 7216.8 7207.0 BIC Log.Lik. -3587.643 -3546.891 -3595.381 -3590.518 rho2 0.2614 0.2698 0.2598 0.2608 rho20 0.6018 0.6064 0.6010 0.6015 Before adopting Model 7W, it is a good idea to evaluate and interpret the relative importance of in-vehicle and out-of-vehicle time and between each component of time and cost. Despite the difference in the specification, this analysis is undertaken the same way as earlier; that is, the parameters for time is divided by the parameter for cost to obtain the values of time. The values of IVT and OVT in cents-per-minute (and dollars-per-hour) are shown in Table 6.6 as a function of distance. The time values are obtained as described earlier by dividing each of the time parameters (in utils-per-minute) by the cost parameter in utils per cent. For example, the values for Model 7W are: Value of IVTT \\(= \\frac{\\beta_{mot\\ tvtt}}{\\beta_{cost}} = \\frac{-0.0415}{-0.0041}\\) = 10.1 cents/min = $6.07/hr Value of OVT (5 Mile Trip) \\(= \\frac{\\beta_{mot\\ tvtt}+ \\frac{\\beta_{OVT/Dist}}{Dist}}{\\beta_{cost}}\\) \\(= \\frac{-0.0415+ \\frac{-0.1812}{5}}{-0.0041}\\) = 19.0 cents/min = $11.38/hr These values of time are fixed for IVT but vary with distance for OVT30 as reported in Table 6.6 for Model 7W. The corresponding values of time for Models 6W, 8W and 9W are shown in Table ?? Table 6.6: Model 7W Implied Values of Time as a Function of Trip Distance distance Value of Motorized Out-of-Vehicle Time Value of Motorized Total Time Value of Non-Motorized Time 5 NA 10.10156 11.53997 10 NA 10.10156 11.53997 20 NA 10.10156 11.53997 Table 6.7: Implied Values of Time in Models 6W, 8W, and 9W Value of Time ($/hr) Model 6W Model 8W Model 9W Value of Out-of-vehicle Time 9.50 NA NA Value of In-vehicle Time 0.32 NA NA The prevailing wage rate in the San Francisco Bay Area is $21.20 per hour31. In comparison, the values of in-vehicle time implied by Models 6W, 8W, and 9W are very low and the values of out of vehicle time are somewhat low. Model 7W produces higher, but still low, values of time. Finally, we can examine the ratio of time values of OVT relative to IVT for all four models as shown in Figure 6.1. The ratio for Model 6W is unacceptably high. Those for Models 7W, 8W and 9W are more reasonable. vottable &lt;- tibble( model = c(&quot;Model 6W&quot;, &quot;Model 7W&quot;, &quot;Model 8W&quot;, &quot;Model 9W&quot;), ovtt = c( VOTsimple(model_6w, &quot;mot_ovtt&quot;, &quot;cost&quot;), VOTsimple(model_7w, &quot;mot_tvtt&quot;, &quot;cost&quot;), VOTsimple(model_8a, &quot;scalemot&quot;, &quot;cost&quot;), VOTsimple(model_9a, &quot;scalemot2&quot;, &quot;cost&quot;)), ivtt = c(VOTsimple(model_6w, &quot;mot_ivtt&quot;, &quot;cost&quot;), VOTsimple(model_7w, &quot;mot_tvtt&quot;, &quot;cost&quot;), VOTsimple(model_8a, &quot;mot_ivtt&quot;, &quot;cost&quot;), VOTsimple(model_9a, &quot;mot_ivtt&quot;, &quot;cost&quot;)), ratio = ovtt / ivtt ) tibble( distance = .8:10, `Model 6W` = vottable$ratio[1], `Model 7W` = vottable$ratio[2] / distance, `Model 8W` = vottable$ratio[3], `Model 9W` = vottable$ratio[4], ) %&gt;% gather(model, vot, -distance) %&gt;% ggplot(aes(x = distance, y = vot, color = model)) + scale_color_discrete(&quot;Model&quot;) + geom_line() + xlab(&quot;Distance&quot;) + ylab(&quot;Value of Time Ratio&quot;) + scale_y_log10() ## Warning: attributes are not identical across measure variables; ## they will be dropped Figure 6.1: Ratio of Out-of-Vehicle and In-Vehicle Time Coefficients for Work Models 6, 7, 8, and 9 The selection of a preferred travel time specification among the four alternative specifications tested is relatively straightforward in this case. Model 7W outperforms the other models in all the evaluations undertaken; it has the best goodness-of-fit, the most intuitive relationship between the IVT and OVT variables and the most acceptable values of time32. Consequently, Model 7W is our preferred travel time specification. We can still consider imposing a constraint between the time and cost variables to force the value of time to more reasonable levels. However, we defer this until we explore other specification improvements. 6.2.3 Including Additinal Decision Maker Related Variables There are strong theoretical and empirical reasons to expect that a variety of decision maker related variables such as income, car availability, residential location, number of workers in the household and others, influence workers’ choice of travel mode. The models reported to this point include income as the only decision maker related explanatory variable. To the extent that these variables influence the mode choice decision of travelers, their inclusion in the model will increase the explanatory power and predictive accuracy of the model. There are two general approaches to including decision maker related variables in models. One is to include such variables as specific to each alternative (except for one base or reference alternative) to indicate the extent to which changes in the variable value will increase or decrease the utility of the mode to that traveler (relative to the reference alternative). The other is to include such variables as interactions with mode related characteristics. For example, dividing cost by income to reflect the decreasing importance of cost with increasing annual income. The inclusion of decision maker related variables as alternative specific variables is demonstrated in this section. Similar treatment of trip context variables is considered in Section 6.2.4. Interactions with mode characteristics are demonstrated in Section 6.2.5. We consider number of automobiles in the household, the number of autos divided by the number of household workers and the number of autos divided by the number of persons of driving age in the household. Since these variables are constant across all alternatives, they must be included as distinct variables for each alternative (except for the reference alternative). This is considered a full set of alternative specific variables. The estimation results for these specifications and Model 7W are reported in Table 6-8. These three new models have much better goodness-of-fit than Model 7W. Each model rejects Model 7W as the true model at a very high level of significance. The parameters for alternative specific automobile availability variables in all the three models have the expected signs, negative relative to drive alone, with the exception of the shared ride 3+ variable in Model 10W which is not significant. Further, the signs and magnitude of the parameters for time, cost, and income are stable across the models. Finally, Models 11W and 12W which include cars-perworker and cars-per-number-of-adults, respectively, reject Model 10W as the true model. Overall, Models 11W and 12W are superior to the other two models in terms of behavioral appeal, they provide an indication of automobile availability, and goodness of fit, they statistically reject Models 7W and 10W statistical fit. Model 11W has slightly better goodness-of-fit than Model 12W but the difference is so small that the non-nested hypothesis test is not able to distinguish between the two models. Therefore, selection of a preferred model is primarily a matter of judgment. We select Model 11W but selection of Model 12W would be equally appropriate. (#tab:Table 6-8 Estimation for Auto Availability)Estimation Results for Auto Availiability Specification Testing Model 7W Model 10W Model 11W Model 12W (Intercept) × Share ride 2 -2.1519 -2.0374 -1.5651 -1.5105 (0.1047) (0.1246) (0.1364) (0.1441) (Intercept) × Share ride 3++ -3.6362 -3.7004 -3.2375 -3.1128 (0.1758) (0.2073) (0.2195) (0.2315) (Intercept) × Transit -0.0431 0.5734 0.9262 1.0493 (0.1597) (0.1807) (0.1924) (0.1976) (Intercept) × Bike -2.6862 -2.2196 -1.8303 -1.9617 (0.3337) (0.3807) (0.4082) (0.4159) (Intercept) × Walk -1.0226 -0.4404 -0.2371 -0.2165 (0.2920) (0.3315) (0.3410) (0.3453) mot_tvtt -0.0415 -0.0378 -0.0384 -0.0380 (0.0035) (0.0036) (0.0036) (0.0036) nm_tvtt -0.0475 -0.0475 -0.0470 -0.0466 (0.0055) (0.0057) (0.0056) (0.0056) mot_ovttbydist -0.1813 -0.1786 -0.1814 -0.1849 (0.0179) (0.0185) (0.0185) (0.0187) cost -0.0041 -0.0041 -0.0042 -0.0042 (0.0002) (0.0002) (0.0002) (0.0002) hhinc × Share ride 2 -0.0020 -0.0024 -0.0022 -0.0019 (0.0015) (0.0016) (0.0016) (0.0016) hhinc × Share ride 3++ 0.0006 -0.0007 0.0001 0.0005 (0.0025) (0.0026) (0.0025) (0.0025) hhinc × Transit -0.0072 -0.0013 -0.0060 -0.0046 (0.0019) (0.0020) (0.0020) (0.0020) hhinc × Bike -0.0119 -0.0095 -0.0116 -0.0117 (0.0052) (0.0054) (0.0053) (0.0053) hhinc × Walk -0.0082 -0.0042 -0.0080 -0.0077 (0.0032) (0.0034) (0.0032) (0.0033) numveh × Share ride 2 -0.0325 (0.0393) numveh × Share ride 3++ 0.0655 (0.0586) numveh × Transit -0.5544 (0.0689) numveh × Bike -0.2293 (0.1316) numveh × Walk -0.3655 (0.0995) vehbywrk × Share ride 2 -0.4298 (0.0767) vehbywrk × Share ride 3++ -0.2732 (0.1129) vehbywrk × Transit -0.9903 (0.1157) vehbywrk × Bike -0.6731 (0.2515) vehbywrk × Walk -0.6286 (0.1627) autoperad × Share ride 2 -0.5875 (0.1088) autoperad × Share ride 3++ -0.4652 (0.1688) autoperad × Transit -1.4099 (0.1546) autoperad × Bike -0.6426 (0.3027) autoperad × Walk -0.7943 (0.2082) Num.Obs. 5029 5029 5029 5029 AIC 7121.8 7041.0 7015.8 7018.0 BIC Log.Lik. -3546.891 -3501.483 -3488.886 -3490.002 rho2 0.2698 0.2791 0.2817 0.2815 rho20 0.6064 0.6114 0.6128 0.6127 6.2.4 Including Trip Context variables The models considered to this point include variables that describe the attributes of alternatives, modes, and the characteristics of decision-makers (the work commuters). The mode choice decision also is influenced by variables that describe the context in which the trip is made. For example, a work trip to the regional central business district (CBD) is more likely to be made by transit than an otherwise similar trip to a suburban work place because the CBD is generally well-served by transit, has more opportunities to make additional stops by walking and is less auto friendly due to congestion and limited and expensive parking. This suggests that the model specification can be enhanced by including variables related to the context of the trip, such as destination zone location. We consider two distinct variables to describe the trip destination context. One is a dummy variable which indicates whether the destination zone (workplace) is located in the CBD; the other is the employment density of different workplace destinations. The CBD variable implies an abrupt increase in the likelihood of using public transit at the CBD boundary. The density variable implies a continuous increase in the likelihood of using public transit with increasing workplace density. A third option is to include both variables in the model. There is disagreement about whether to include such combinations of variables since they both represent the same underlying phenomenon: increasing transit use with increasing density of development. There is no firm rule about this point; each case must be evaluated on its merits based on statistical tests and reasonableness of the estimation results. As with the addition of characteristics of the traveler, we introduce each variable as a full set of alternative specific variables, each of which represents the effect of a change in that variable on the utility of the alternative relative to the reference alternative (drive alone). Model 13W adds the alternative specific CBD dummy variables to the variables in Model 11W. Model 14W adds the alternative specific employment density variables and Model 15W adds both. Estimation results for these specifications and Model 11W are reported in Table 6-9. ## Warning in sanity_ellipsis(vcov, ...): The `statistic_vertical` argument ## is deprecated and will be ignored. To display uncertainty estimates next to ## your coefficients, use a `glue` string in the `estimate` argument. See `? ## modelsummary` Table 6.8: Estimation Results for Models with Trip Context Variables Model 11W Model 13W Model 14W Model 15W (Intercept) × Share ride 2 -1.5651 -1.6134 -1.5818 -1.6192 (0.1364) (0.1403) (0.1370) (0.1403) (Intercept) × Share ride 3++ -3.2375 -3.6071 -3.2913 -3.6182 (0.2195) (0.2333) (0.2219) (0.2333) (Intercept) × Transit 0.9262 -0.2034 0.4180 -0.4729 (0.1924) (0.2426) (0.2090) (0.2512) (Intercept) × Bike -1.8303 -1.6502 -1.5966 -1.5145 (0.4082) (0.4284) (0.4170) (0.4296) (Intercept) × Walk -0.2371 0.0845 -0.0399 0.2108 (0.3410) (0.3476) (0.3442) (0.3483) mot_tvtt -0.0384 -0.0286 -0.0299 -0.0231 (0.0036) (0.0038) (0.0038) (0.0039) nm_tvtt -0.0470 -0.0464 -0.0459 -0.0467 (0.0056) (0.0057) (0.0057) (0.0058) mot_ovttbydist -0.1814 -0.1501 -0.1575 -0.1324 (0.0185) (0.0197) (0.0190) (0.0197) cost -0.0042 -0.0033 -0.0029 -0.0024 (0.0002) (0.0003) (0.0003) (0.0003) hhinc × Share ride 2 -0.0022 -0.0022 -0.0022 -0.0022 (0.0016) (0.0016) (0.0016) (0.0016) hhinc × Share ride 3++ 0.0001 -0.0004 -0.0003 -0.0005 (0.0025) (0.0025) (0.0025) (0.0025) hhinc × Transit -0.0060 -0.0061 -0.0070 -0.0070 (0.0020) (0.0020) (0.0020) (0.0021) hhinc × Bike -0.0116 -0.0111 -0.0112 -0.0109 (0.0053) (0.0052) (0.0053) (0.0053) hhinc × Walk -0.0080 -0.0078 -0.0079 -0.0081 (0.0032) (0.0032) (0.0032) (0.0032) vehbywrk × Share ride 2 -0.4298 -0.4129 -0.4044 -0.3988 (0.0767) (0.0769) (0.0764) (0.0769) vehbywrk × Share ride 3++ -0.2732 -0.2175 -0.2423 -0.1880 (0.1129) (0.1114) (0.1133) (0.1111) vehbywrk × Transit -0.9903 -0.9113 -0.9956 -0.9303 (0.1157) (0.1148) (0.1190) (0.1179) vehbywrk × Bike -0.6731 -0.6982 -0.7137 -0.7151 (0.2515) (0.2561) (0.2585) (0.2590) vehbywrk × Walk -0.6286 -0.7197 -0.6815 -0.7276 (0.1627) (0.1682) (0.1671) (0.1694) cbddumall × Share ride 2 0.2571 0.2037 (0.1100) (0.1246) cbddumall × Share ride 3++ 1.0520 1.0161 (0.1725) (0.1926) cbddumall × Transit 1.3556 1.2037 (0.1613) (0.1678) cbddumall × Bike 0.3755 0.4609 (0.3214) (0.3601) cbddumall × Walk 0.1740 0.1074 (0.2252) (0.2508) wkempden × Share ride 2 0.0011 0.0010 (0.0004) (0.0004) wkempden × Share ride 3++ 0.0022 0.0013 (0.0004) (0.0005) wkempden × Transit 0.0027 0.0021 (0.0004) (0.0004) wkempden × Bike 0.0011 0.0008 (0.0011) (0.0012) wkempden × Walk 0.0015 0.0018 (0.0007) (0.0008) Num.Obs. 5029 5029 5029 5029 AIC 7015.8 6928.9 6968.9 6906.7 BIC Log.Lik. -3488.886 -3440.445 -3460.438 -3424.361 rho2 0.2817 0.2917 0.2876 0.2950 rho20 0.6128 0.6182 0.6160 0.6200 Table 6.9: Implied Values of Time in Models 13W, 14W, and 15W Value of Time ($/hr) Model 13W Model 14W Model 15W Value of Motorized IVT 5.23 6.22 5.88 Value of Motorized OVT (10 mile trip) 7.97 9.50 9.25 Value of Motorized OVT (20 mile trip) 6.60 7.86 7.57 Value of Non-Motorized Time 8.48 9.54 11.89 Each of the new Models (13W, 14W and 15W) significantly reject Model 11W as the true model at a very high level of significance. Further, the parameters for all of the alternative specific CBD dummy and employment density variables have a positive sign, implying that all else being equal, an individual is less likely to choose drive alone mode for trips destined to a CBD and/or high employment density zones, as expected. Since Models 13W and 14W are restricted versions of Model 15W, we can use the loglikelihood test which rejects the hypothesis that each of these models is the true model. Therefore, purely on statistical grounds, Model 15W is preferred over Models 13W and 14W. However, this improvement in statistical fit comes at the cost of increased model complexity, and it may be appropriate to adopt Model 13W or 14W, sacrificing statistical fit in favor of parsimony33. For now, we choose Model 15W as the preferred model for its stronger statistical results, but we will return to the issue of model complexity. 6.2.5 Interactions between Trip maker and/or Context Characteristics and Mode Attributes Another approach to the inclusion of trip maker or context characteristics is through interactions with mode attributes. The most common example of this approach is to take account of the expectation that low-income travelers will be more sensitive to travel cost than high-income travelers by using cost divided by income in place of cost as an explanatory variable. Such a specification implies that the importance of cost in mode choice diminishes with increasing household income. Table 6-11 portrays the estimation results for two models that differ only in how they represent cost; Model 15W includes travel cost while Model 16W includes travel cost divided by income. ## Warning in sanity_ellipsis(vcov, ...): The `statistic_vertical` argument ## is deprecated and will be ignored. To display uncertainty estimates next to ## your coefficients, use a `glue` string in the `estimate` argument. See `? ## modelsummary` (#tab:income_interaction)Estimation Results for Models with Trip Context Variables Model 15W Model 16W (Intercept) × Share ride 2 -1.6192 -1.6976 (0.1403) (0.1419) (Intercept) × Share ride 3++ -3.6182 -3.7733 (0.2333) (0.2356) (Intercept) × Transit -0.4729 -0.6930 (0.2512) (0.2496) (Intercept) × Bike -1.5145 -1.6233 (0.4296) (0.4290) (Intercept) × Walk 0.2108 0.0751 (0.3483) (0.3492) mot_tvtt -0.0231 -0.0202 (0.0039) (0.0038) nm_tvtt -0.0467 -0.0455 (0.0058) (0.0058) mot_ovttbydist -0.1324 -0.1326 (0.0197) (0.0196) cost -0.0024 (0.0003) hhinc × Share ride 2 -0.0022 -0.0006 (0.0016) (0.0016) hhinc × Share ride 3++ -0.0005 0.0023 (0.0025) (0.0025) hhinc × Transit -0.0070 -0.0052 (0.0021) (0.0021) hhinc × Bike -0.0109 -0.0086 (0.0053) (0.0052) hhinc × Walk -0.0081 -0.0060 (0.0032) (0.0032) vehbywrk × Share ride 2 -0.3988 -0.3780 (0.0769) (0.0765) vehbywrk × Share ride 3++ -0.1880 -0.1475 (0.1111) (0.1101) vehbywrk × Transit -0.9303 -0.9400 (0.1179) (0.1185) vehbywrk × Bike -0.7151 -0.7046 (0.2590) (0.2586) vehbywrk × Walk -0.7276 -0.7240 (0.1694) (0.1696) cbddumall × Share ride 2 0.2037 0.2458 (0.1246) (0.1241) cbddumall × Share ride 3++ 1.0161 1.0923 (0.1926) (0.1909) cbddumall × Transit 1.2037 1.3024 (0.1678) (0.1657) cbddumall × Bike 0.4609 0.4829 (0.3601) (0.3613) cbddumall × Walk 0.1074 0.0936 (0.2508) (0.2524) wkempden × Share ride 2 0.0010 0.0016 (0.0004) (0.0004) wkempden × Share ride 3++ 0.0013 0.0022 (0.0005) (0.0005) wkempden × Transit 0.0021 0.0031 (0.0004) (0.0004) wkempden × Bike 0.0008 0.0019 (0.0012) (0.0012) wkempden × Walk 0.0018 0.0029 (0.0008) (0.0007) I(cost/hhinc) -0.0528 (0.0108) Num.Obs. 5029 5029 AIC 6906.7 6941.6 BIC Log.Lik. -3424.361 -3441.782 rho2 0.2950 0.2914 rho20 0.6200 0.6180 The cost by income variable has the expected sign and is statistically significant, but the overall goodness-of-fit for the cost divided by income model is lower than that for model 15 that uses cost without interaction with income. However, because theory and common sense suggest that the importance of cost should decrease with income, we may choose Model 16W despite the differences in the goodness-of-fit statistics. Since the estimation results contradict our understanding of the decision making behavior, it is useful to consider other aspects of model results. In the case of mode choice, we are particularly interested in the relative value of the time and cost parameters because it measures the implied value of time used by travelers in choosing their travel mode. Values of time evaluated with earlier models were somewhat lower than expected when compared to the average wage rate. Using the cost by income formulation in Model 16W, we can calculate the implied value of time using the relationship developed in Section 5.8.2. The implied values of IVT and OVT from Model 16W are substantially higher than those from Model 15W (Table 6-12) and more in line with our a priori expectations. This improvement in the estimate of values of time more than offsets the difference in goodness-of-fit so we adopt Model 16W as our preferred specification. Thus, our strong belief in both valuing time relative to wage rate and higher estimates of the value of time provide evidence which is strong enough to override the statistical test results. Nonetheless, we may still decide to impose parameter constraints to obtain higher values of time. VOTsimple &lt;- function(model, timevar, costvar) { coef(model)[timevar]*0.6/coef(model)[costvar] } VOTdistance &lt;- function(model, timevar, timedistvar, dist_value, costvar) { (coef(model)[timevar]+(coef(model)[timedistvar]/dist_value))*0.6/coef(model)[costvar] } model_15w &lt;- mlogit(chosen ~ mot_tvtt + nm_tvtt + I(mot_ovtt/dist) + cost | hhinc + vehbywrk + cbddumall + wkempden, data = sf_mlogit_tripcontext) model_16w &lt;- mlogit(chosen ~ I(cost/hhinc) + mot_tvtt + nm_tvtt + I(mot_ovtt/dist) | hhinc + vehbywrk + cbddumall + wkempden, data = sf_mlogit_tripcontext) tibble( &quot;Measure&quot; = c(&quot;Value of In-Vehicle Time&quot;,&quot;Value of Out-of-Vehilce Time (10 mile trip)&quot;, &quot;Value of Out-of-Vehilce Time (20 mile trip)&quot;), &quot;Model 15W&quot; = c( paste(&quot;$&quot;, round(VOTsimple(model_15w,&quot;mot_tvtt&quot;,&quot;cost&quot;),2), &quot;/hr&quot;), paste(&quot;$&quot;, round(VOTdistance(model_15w, &quot;mot_tvtt&quot;, &quot;I(mot_ovtt/dist)&quot;, 10,&quot;cost&quot;),2), &quot;/hr&quot;), paste(&quot;$&quot;, round(VOTdistance(model_15w, &quot;mot_tvtt&quot;, &quot;I(mot_ovtt/dist)&quot;, 20,&quot;cost&quot;),2), &quot;/hr&quot;) ), &quot;Model 16W (Wage Rate = $21.20)&quot; = c( paste(&quot;$&quot;, round(coef(model_16w)[&quot;mot_tvtt&quot;] / coef(model_16w)[&quot;I(cost/hhinc)&quot;] * 21.20, 2), &quot;/hr&quot;), paste(&quot;$&quot;, round((coef(model_16w)[&quot;mot_tvtt&quot;] + coef(model_16w)[&quot;I(mot_ovtt/dist)&quot;] / 10) / coef(model_16w)[&quot;I(cost/hhinc)&quot;] * 21.20, 2), &quot;/hr&quot;), paste(&quot;$&quot;, round((coef(model_16w)[&quot;mot_tvtt&quot;] + coef(model_16w)[&quot;I(mot_ovtt/dist)&quot;] / 20) / coef(model_16w)[&quot;I(cost/hhinc)&quot;] * 21.20, 2), &quot;/hr&quot;) )) %&gt;% kbl(caption = &quot;Implied Value of Time in Models 15W and 16W&quot;) %&gt;% kable_styling() Table 6.10: Implied Value of Time in Models 15W and 16W Measure Model 15W Model 16W (Wage Rate = $21.20) Value of In-Vehicle Time $ 5.88 /hr $ 8.1 /hr Value of Out-of-Vehilce Time (10 mile trip) $ 9.25 /hr $ 13.42 /hr Value of Out-of-Vehilce Time (20 mile trip) $ 7.57 /hr $ 10.76 /hr 15W 16W Motorized Travel Time -0.023 -0.020 (0.004) (0.004) Non-motorized Travel Time -0.047 -0.045 (0.006) (0.006) Motorized time per distance -0.132 -0.133 (0.020) (0.020) Trip Cost -0.002 (0.000) Trip cost divided by income -0.053 (0.011) Num.Obs. 5029 5029 AIC 6906.7 6941.6 BIC Log.Lik. -3424.361 -3441.782 rho2 0.295 0.291 rho20 0.620 0.618 6.2.6 Additional Model Refinement Generally, it is appropriate to test the preferred model specification against a variety of other specifications; particularly reviewing decisions made earlier in the model development process. Such testing would include reducing model complexity by the elimination of selected variables (e.g., dropping either the CBD Dummy or Employment Density variables or combining some of the alternative specific parameters), changing the form used for inclusion of different variables (e.g., replacing income by log of income) or adding new variables which substantially improve the explanatory power and behavioral realism of the model. In this section, we consider simplifying the model specification by dropping variables that are not statistically significant or by collapsing alternative specific variables that do not differ across alternatives. The cost and time parameters are all significant and should be included because they represent the impact of policy changes in mode service attributes. Among the traveler and context variables, those for income have the lowest t-statistics so might be considered for elimination; however, we prefer to keep these in the model since income differences are important in mode selection, particularly for transit. However, the extremely low values and lack of significance for the shared ride alternatives suggest that income has no differential impact on the choice of drive alone versus any of the shared ride alternatives and these variables should be dropped from the model (or constrained to zero). In addition, the parameter for the number of automobiles by number of workers variable for shared ride 3+ alternative is smaller in magnitude than the parameter for the shared ride 2 alternative. This is counter-intuitive as we expect shared ride 3+ travelers to be more sensitive to automobile availability. This can be addressed by constraining the alternative specific variables for the shared ride modes to be equal (we accomplish by summing the two variables). The estimation results for the simplified specification (constraining income for the shared ride alternatives to zero, and constraining the automobile ownership by number of workers variable for the two shared ride alternatives to be equal) and Model 16W are reported in Table 6-13. The goodness-of-fit for the two models are very close, suggesting that the constraints imposed to simplify the model do not significantly impact the explanatory power of the model. The results of the likelihood ratio test confirm that the restrictions imposed in Model 17W cannot be statistically rejected. The parameter estimates for all the variables have the right sign and are all statistically significant (except CBD dummy for bike and walk). We therefore select Model 17W as our preferred model. As discussed in the next section, the other major approach to searching for improved models is market segmentation and segmenting the population into groups which are expected to use different criteria in making their mode choice decisions. # Model 17 W model_17w &lt;- mlogit(chosen ~ I(cost/hhinc) + mot_tvtt + nm_tvtt + I(mot_ovtt/dist) | hhinc + vehbywrk + cbddumall + wkempden, data = sf_mlogit_tripcontext, constPar = c(&quot;hhinc:Share ride 2&quot; = 0, &quot;hhinc:Share ride 3++&quot; = 0, &quot;vehbywrk:Share ride 2&quot; = -0.3166, &quot;vehbywrk:Share ride 3++&quot; = -0.3166)) #table 6-13 list_1617 &lt;- list( &quot;Model 16W&quot; = model_16w, &quot;Model 17W&quot; = model_17w ) modelsummary(list_1617, title = &quot;Estimation Results for Model 16W and Its Constrained Version&quot;) Table 6.11: Estimation Results for Model 16W and Its Constrained Version Model 16W Model 17W (Intercept) × Share ride 2 -1.698 -1.808 (0.142) (0.063) (Intercept) × Share ride 3++ -3.773 -3.434 (0.236) (0.126) (Intercept) × Transit -0.693 -0.685 (0.250) (0.244) (Intercept) × Bike -1.623 -1.629 (0.429) (0.426) (Intercept) × Walk 0.075 0.068 (0.349) (0.346) I(cost/hhinc) -0.053 -0.052 (0.011) (0.010) mot_tvtt -0.020 -0.020 (0.004) (0.004) nm_tvtt -0.045 -0.045 (0.006) (0.006) I(mot_ovtt/dist) -0.133 -0.133 (0.020) (0.020) hhinc × Share ride 2 -0.001 (0.002) hhinc × Share ride 3++ 0.002 (0.003) hhinc × Transit -0.005 -0.005 (0.002) (0.002) hhinc × Bike -0.009 -0.009 (0.005) (0.005) hhinc × Walk -0.006 -0.006 (0.003) (0.003) vehbywrk × Share ride 2 -0.378 (0.076) vehbywrk × Share ride 3++ -0.147 (0.110) vehbywrk × Transit -0.940 -0.946 (0.119) (0.114) vehbywrk × Bike -0.705 -0.702 (0.259) (0.257) vehbywrk × Walk -0.724 -0.722 (0.170) (0.167) cbddumall × Share ride 2 0.246 0.260 (0.124) (0.123) cbddumall × Share ride 3++ 1.092 1.069 (0.191) (0.191) cbddumall × Transit 1.302 1.309 (0.166) (0.166) cbddumall × Bike 0.483 0.489 (0.361) (0.361) cbddumall × Walk 0.094 0.102 (0.252) (0.252) wkempden × Share ride 2 0.002 0.002 (0.000) (0.000) wkempden × Share ride 3++ 0.002 0.002 (0.000) (0.000) wkempden × Transit 0.003 0.003 (0.000) (0.000) wkempden × Bike 0.002 0.002 (0.001) (0.001) wkempden × Walk 0.003 0.003 (0.001) (0.001) Num.Obs. 5029 5029 AIC 6941.6 6946.4 BIC Log.Lik. -3441.782 -3444.185 rho2 0.291 0.291 rho20 0.618 0.618 6.3 Market Segmentation The models considered to this point implicitly assume that the entire population, represented by the sample, uses the same model decision structure, variable and importance weights (parameters) to select their commute to work mode. That is, we assume that the population is homogeneous with respect to the importance it places on different aspects of service except as differentiated by decision-maker characteristics included in the model specification. If this assumption is incorrect, the estimated model will not adequately represent the underlying decision processes of the entire population or of distinct behavioral groups within the population. For example, mode preference may differ between low and high-income travelers as low-income travelers are expected to be more sensitive to cost and less sensitive to time than high-income travelers. This phenomenon is incorporated in the preceding models to a limited extent through the use of alternative specific income variables and cost divided by income in the utility specification. Market segmentation can be used to determine whether the impact of other variables is different among population groups. The most common approach to market segmentation is for the analyst to consider sample segments which are mutually exclusive and collectively exhaustive (that is, each case is included in one and only one segment). Models are estimated for the sample associated with each segment and compared to the pooled model (all segments represented by a single model) to determine if there are statistically significant and important differences among the market segments. Market segmentation is usually based on socio-economic and trip related variables such as income, auto ownership and trip purpose which may be used separately or jointly. Trip purpose has already been used in our analysis by considering work commute trips exclusively. Once segmentation variables are selected (income, auto ownership, etc.), different numbers of segments may be considered for each dimension (e.g., we could use high, medium and low income segments or only high and low income segments). All members of each segment are assumed to have identical preferences and identical sensitivities to all the variables in the utility equation. Analysts will often have some a priori ideas about the best segmentation variables and the appropriate groupings of the population with respect to these variables. In the case of continuous variables, such as income, the analyst may consider different boundaries between segments. In cases where the analyst does not have a strong basis for selecting model segments, he/she can test different combinations of socio-economic and trip-related variables in the data for segmentation. This approach is limited by the fact that the number of segments grows very fast with the number of segmentation variables (e.g., three income segments, two gender segments and three home location segments results in 18 distinct groups). The multiplicity of segments creates interpretational problems due to the complexity of comparing results among segments and estimation problems due to the small number of observations in some of the segments (with as many as 2,000 cases, eighteen segments would be likely to produce many segments with fewer than 100 cases and some with fewer than 50 cases, well below the threshold for reliable estimation results). The alternative of pre-defining market segments along one dimension at a time is practical and easy to implement but it has the disadvantage that this approach does not account for interactions among the segmentation variables. 6.3.1 Market Segmentation Tests The determination of whether to segment the data is based on a comparison of the pooled model for the entire sample/population and a set of segment specific models for each segment of the sample/population. This comparison includes: (1) a statistical test, referred to as the market segmentation or taste variation test, to determine if the segments are statistically different from one another, (2) statistical significance and reasonableness of the parameters in each of the segments, and (3) reasonableness of the relationships among parameters in each segment and between parameters in the different market segments. The statistical test for market segmentation consists of three steps. First, the sample is divided into a number of market segments which are mutually exclusive and collectively exhaustive. A preferred model specification is used to estimate a pooled model for the entire data set and to estimate models for each market segment. Finally, the goodness-of-fit differences between the segmented models (taken as a group) and the pooled model are evaluated to determine if they are statistically different. This test is an extension of the likelihood ratio test described earlier to test the difference between two models. In this case, the unrestricted model is the set of all the segmented models and the restricted model is the pooled model which imposes the restriction that the parameters for each segment are identical. sf_work &lt;- read_rds(&quot;data/worktrips.rds&quot;) base_model &lt;- mlogit(chosen ~ tvtt + cost | wkempden, data = sf_work) withincome &lt;- mlogit(chosen ~ tvtt + cost | hhinc + wkempden, data = sf_work) highincome &lt;- mlogit(chosen ~ tvtt + cost | hhinc + wkempden, data = sf_work %&gt;% filter(hhinc &gt; 50)) low_income &lt;- mlogit(chosen ~ tvtt + cost | hhinc + wkempden, data = sf_work %&gt;% filter(hhinc &lt;= 50)) list( &quot;Base&quot; = base_model, &quot;Income&quot; = withincome, &quot;High Income&quot; = highincome, &quot;Low Income&quot; = low_income ) %&gt;% modelsummary(fmt = &quot;%.5f&quot;, stars = TRUE, statistic_vertical = TRUE) ## Warning in sanity_ellipsis(vcov, ...): The `statistic_vertical` argument ## is deprecated and will be ignored. To display uncertainty estimates next to ## your coefficients, use a `glue` string in the `estimate` argument. See `? ## modelsummary` Base Income High Income Low Income (Intercept) × Share ride 2 -2.24062*** -2.12010*** -2.54700*** -2.09159*** (0.05926) (0.10550) (0.22662) (0.23154) (Intercept) × Share ride 3++ -3.63954*** -3.64748*** -4.61183*** -3.47000*** (0.10325) (0.17932) (0.38424) (0.37968) (Intercept) × Transit -1.48383*** -1.10480*** -1.28475*** -0.67247** (0.10843) (0.14602) (0.30938) (0.27050) (Intercept) × Bike -3.04236*** -2.37218*** -3.02584*** -0.59491 (0.16821) (0.30739) (0.69578) (0.53300) (Intercept) × Walk -0.93828*** -0.43252** -1.20998** -0.24907 (0.13652) (0.19730) (0.49709) (0.34167) tvtt -0.04378*** -0.04350*** -0.04055*** -0.04529*** (0.00320) (0.00322) (0.00468) (0.00447) cost -0.00312*** -0.00312*** -0.00308*** -0.00331*** (0.00031) (0.00031) (0.00039) (0.00050) wkempden × Share ride 2 0.00104*** 0.00109*** 0.00131*** 0.00078 (0.00037) (0.00037) (0.00045) (0.00067) wkempden × Share ride 3++ 0.00211*** 0.00212*** 0.00158*** 0.00294*** (0.00044) (0.00044) (0.00060) (0.00069) wkempden × Transit 0.00317*** 0.00331*** 0.00309*** 0.00367*** (0.00036) (0.00037) (0.00048) (0.00061) wkempden × Bike 0.00113 0.00132 0.00137 0.00056 (0.00103) (0.00104) (0.00119) (0.00219) wkempden × Walk 0.00221*** 0.00236*** 0.00177* 0.00299*** (0.00059) (0.00060) (0.00092) (0.00085) hhinc × Share ride 2 -0.00197 0.00193 0.00015 (0.00155) (0.00252) (0.00651) hhinc × Share ride 3++ 0.00028 0.01042*** -0.00300 (0.00252) (0.00392) (0.01085) hhinc × Transit -0.00708*** -0.00509 -0.02108*** (0.00196) (0.00328) (0.00769) hhinc × Bike -0.01254** -0.00376 -0.07430*** (0.00531) (0.00811) (0.01848) hhinc × Walk -0.01009*** -0.00234 -0.01316 (0.00304) (0.00541) (0.00971) Num.Obs. 5029 5029 2591 2438 AIC 7210.7 7193.1 3470.7 3716.6 BIC Log.Lik. -3593.335 -3579.553 -1718.350 -1841.308 rho2 0.26020 0.26304 0.23484 0.28743 rho20 0.60122 0.60275 0.62986 0.57848 * p &lt; 0.1, ** p &lt; 0.05, *** p &lt; 0.01 Thus, the null hypothesis is that \\(\\underline\\beta_1 = \\underline\\beta_2 = ... = \\underlineβ_s = ... = \\underlineβ_S\\) , where βs , is the vector of coefficients for the \\(S^{th}\\) market segment. Following the approach described in CHAPTER 5, we reject the null hypothesis that the restricted model is the correct model at significance level p if the calculated value of the statistic is greater than the test or critical value. That is, if: \\[\\begin{equation} $\\displaystyle -2 \\times [l_{R} - l_{U}]\\ge \\chi^{2}_{n,(p)}$ \\tag{6.8} \\end{equation}\\] Substituting the log-likelihood for the pooled model for \\(l_R\\) and the sum of market segment model log-likelihoods for lU in equation 5.16, the null hypothesis, that all segments have the same choice function, is rejected at level p if: \\[\\begin{equation} $\\displaystyle -2 \\times \\Bigg[l(\\beta) - \\sum^{S}_{s=1} l(\\beta_{s})\\Bigg]\\ge \\chi^{2}_{n,(p)}$ \\tag{6.9} \\end{equation}\\] Where \\(l(\\beta)\\) is the log-likelihood for the pooled model, \\(l(\\beta_{s})\\) is the log-likelihood of the model estimated with \\(s^{th}\\) market segment, \\(\\chi^{2}_{n}\\) is the chi-square distribution with n degrees of freedom, \\(n\\) is equal to the number of restrictions, \\(\\sum^{S}_{s=1} K_{s} - K\\) \\(K\\) is the number of coefficients in the pooled model, and \\(K_{s}\\) is the number of coefficients in the \\(s^{th}\\) market segment model. \\(K_{s}\\) is generally equal to \\(K\\) in which case \\(n\\) is given by \\(K x (S-1)\\)34 6.3.2 Market Segmentation Example We illustrate the market segmentation test for two cases, automobile ownership (zero/one car households and households with more than one car), and gender (male and female). In the case of segmentation by automobile ownership, it is appealing to include a distinct segment for households with no cars since the mode choice behavior of this segment is very different from the rest of the population due to their dependence on non-automobile modes. However, the small size of this segment in the data set, only 160 of the 5029 work trip reports from households with no cars, precludes use of a no car segment; this group is combined with the one car ownership households for estimation. Using the same utility specification as in Model 17W, the estimation results for the pooled and segmented models for auto ownership and for gender are reported in Table 6-14 and Table 6-15. We can make the following observations from the estimation results of the automobile ownership segmentation models (Table 6-14): The segmented model rejects the pooled model at a very high level of statistical significance \\(-2\\times\\Bigg[l(\\beta) - \\sum^{S}_{s=1} l(\\beta_{s})\\Bigg] = -2\\times[-3444.2-(-1049.3-2296.7)] = 196.4\\) The alternative specific constants for all other modes relative to drive alone are much more negative for the higher auto ownership group than for the lower auto ownership group. These differences indicate the increased preference for drive alone among persons from multi-car households. This makes intuitive sense, as travelers in households with fewer automobiles are more likely to choose non-automobile modes, all else being equal. The alternative specific income coefficients are insignificant or marginally significant for both segments suggesting that the effect of income differences is adequately explained by the segment difference. # uses Model 17W as the basis model_17w_lowcars &lt;- mlogit(chosen ~ I(cost/hhinc) + mot_tvtt + nm_tvtt + I(mot_ovtt/dist) | hhinc + vehbywrk + cbddumall + wkempden, data = sf_mlogit_tripcontext %&gt;% filter(numveh &lt;= 1), constPar = c(&quot;hhinc:Share ride 2&quot; = 0, &quot;hhinc:Share ride 3++&quot; = 0, &quot;vehbywrk:Share ride 2&quot; = -3.015, &quot;vehbywrk:Share ride 3++&quot; = -3.015)) model_17w_highcars &lt;- mlogit(chosen ~ I(cost/hhinc) + mot_tvtt + nm_tvtt + I(mot_ovtt/dist) | hhinc + vehbywrk + cbddumall + wkempden, data = sf_mlogit_tripcontext %&gt;% filter(numveh &gt;= 2), constPar = c(&quot;hhinc:Share ride 2&quot; = 0, &quot;hhinc:Share ride 3++&quot; = 0, &quot;vehbywrk:Share ride 2&quot; = -0.241, &quot;vehbywrk:Share ride 3++&quot; = -0.241)) # table 6-14 list( &quot;Pooled Model&quot; = model_17w, &quot;0-1 Car HH&#39;s&quot; = model_17w_lowcars, &quot;2+ Car HH&#39;s&quot; = model_17w_highcars ) %&gt;% modelsummary(fmt = &quot;%.5f&quot;, stars = TRUE, statistic_vertical = TRUE, title = &quot;Estimation Results for Market Segmentation by Automobile Ownership&quot;) ## Warning in sanity_ellipsis(vcov, ...): The `statistic_vertical` argument ## is deprecated and will be ignored. To display uncertainty estimates next to ## your coefficients, use a `glue` string in the `estimate` argument. See `? ## modelsummary` Table 6.12: Estimation Results for Market Segmentation by Automobile Ownership Pooled Model 0-1 Car HH’s 2+ Car HH’s (Intercept) × Share ride 2 -1.80786*** 0.59322*** -1.97908*** (0.06253) (0.13324) (0.07282) (Intercept) × Share ride 3++ -3.43378*** -0.78485*** -3.72017*** (0.12556) (0.22753) (0.15277) (Intercept) × Transit -0.68484*** 2.25826*** -2.16287*** (0.24373) (0.38045) (0.38267) (Intercept) × Bike -1.62890*** 0.97715 -3.21797*** (0.42578) (0.66850) (0.73350) (Intercept) × Walk 0.06816 2.90719*** -1.53470*** (0.34577) (0.51554) (0.57472) I(cost/hhinc) -0.05242*** -0.02267 -0.09808*** (0.01040) (0.01380) (0.01608) mot_tvtt -0.02019*** -0.02107*** -0.01870*** (0.00381) (0.00604) (0.00513) nm_tvtt -0.04545*** -0.04401*** -0.04503*** (0.00577) (0.00811) (0.00872) I(mot_ovtt/dist) -0.13287*** -0.11312*** -0.19437*** (0.01964) (0.02595) (0.03307) hhinc × Transit -0.00532*** -0.00645* 0.00036 (0.00198) (0.00355) (0.00263) hhinc × Bike -0.00864* -0.01166 -0.00192 (0.00515) (0.00949) (0.00650) hhinc × Walk -0.00600* -0.01200** 0.00067 (0.00315) (0.00596) (0.00407) vehbywrk × Transit -0.94623*** -3.96364*** -0.23984* (0.11367) (0.27217) (0.13456) vehbywrk × Bike -0.70211*** -2.66404*** -0.19047 (0.25716) (0.62232) (0.32833) vehbywrk × Walk -0.72180*** -3.34226*** -0.09746 (0.16735) (0.37268) (0.21095) cbddumall × Share ride 2 0.25983** 0.37243 0.16276 (0.12317) (0.24084) (0.14863) cbddumall × Share ride 3++ 1.06927*** 0.22942 1.33024*** (0.19114) (0.40639) (0.22088) cbddumall × Transit 1.30881*** 1.10644*** 1.27854*** (0.16570) (0.25932) (0.24433) cbddumall × Bike 0.48929 0.39513 0.48669 (0.36110) (0.53702) (0.50318) cbddumall × Walk 0.10175 0.02974 0.11138 (0.25209) (0.35050) (0.38715) wkempden × Share ride 2 0.00158*** 0.00204*** 0.00107** (0.00039) (0.00073) (0.00048) wkempden × Share ride 3++ 0.00226*** 0.00353*** 0.00134** (0.00045) (0.00091) (0.00055) wkempden × Transit 0.00313*** 0.00316*** 0.00288*** (0.00036) (0.00067) (0.00045) wkempden × Bike 0.00193 0.00151 0.00161 (0.00122) (0.00188) (0.00168) wkempden × Walk 0.00289*** 0.00379*** -0.00089 (0.00074) (0.00097) (0.00214) Num.Obs. 5029 1221 3808 AIC 6946.4 2156.6 4651.3 BIC Log.Lik. -3444.185 -1049.280 -2296.667 rho2 0.29091 0.36645 0.22374 rho20 0.61777 0.52038 0.66339 * p &lt; 0.1, ** p &lt; 0.05, *** p &lt; 0.01 The sensitivity to automobile availability is much higher among low auto ownership households where an increase in availability (from 0) will be relatively important, than among higher auto ownership households where the number of cars is likely to closely approximate the number of drivers and an increase in availability will be relatively unimportant. The differences in the alternative specific CBD dummy variables and the Employment Density variables are very small and not significant suggesting that these variables could be constrained to be equal across auto ownership segments. The differences in the time parameters also are very small and not significant suggesting that these variables could be constrained to be equal across auto ownership segments. The magnitude of the cost by income parameter is much smaller in the lower automobile ownership segment than in the higher automobile ownership segment indicating that cost may be of little importance in households with low car availability. We can make the following observations from the estimation results of the gender segmentation models (Table 6-15): The segmented model rejects the pooled model at a very high level of statistical significance. The alternative specific constants relative to the drive alone mode are less negative (more positive) in the female segment suggesting the preference for drive alone mode is less pronounced among females. This is especially true for the non-motorized modes (bike and walk) where the difference in the modal constants between the two groups is large and highly significant. # uses Model 17W as the basis model_17w_males &lt;- mlogit(chosen ~ I(cost/hhinc) + mot_tvtt + nm_tvtt + I(mot_ovtt/dist) | hhinc + vehbywrk + cbddumall + wkempden, data = sf_mlogit_tripcontext %&gt;% filter(femdum == 0), constPar = c(&quot;hhinc:Share ride 2&quot; = 0, &quot;hhinc:Share ride 3++&quot; = 0, &quot;vehbywrk:Share ride 2&quot; = 0.21, &quot;vehbywrk:Share ride 3++&quot; = 0.21 )) model_17w_females &lt;- mlogit(chosen ~ I(cost/hhinc) + mot_tvtt + nm_tvtt + I(mot_ovtt/dist) | hhinc + vehbywrk + cbddumall + wkempden, data = sf_mlogit_tripcontext %&gt;% filter(femdum == 1), constPar = c(&quot;hhinc:Share ride 2&quot; = 0, &quot;hhinc:Share ride 3++&quot; = 0, &quot;vehbywrk:Share ride 2&quot; = 0.607, &quot;vehbywrk:Share ride 3++&quot; = 0.607 )) # table 6-15 list( &quot;Pooled Model&quot; = model_17w, &quot;Males Only&quot; = model_17w_males, &quot;Females Only&quot; = model_17w_females ) %&gt;% modelsummary(fmt = &quot;%.5f&quot;, stars = TRUE, statistic_vertical = TRUE, title = &quot;Estimation Results for Market Segmentation by Gender&quot;) ## Warning in sanity_ellipsis(vcov, ...): The `statistic_vertical` argument ## is deprecated and will be ignored. To display uncertainty estimates next to ## your coefficients, use a `glue` string in the `estimate` argument. See `? ## modelsummary` Table 6.13: Estimation Results for Market Segmentation by Gender Pooled Model Males Only Females Only (Intercept) × Share ride 2 -1.80786*** -2.55136*** -3.14282*** (0.06253) (0.08243) (0.09680) (Intercept) × Share ride 3++ -3.43378*** -4.18976*** -4.77064*** (0.12556) (0.16736) (0.19156) (Intercept) × Transit -0.68484*** -1.13739*** -1.40011*** (0.24373) (0.35231) (0.35479) (Intercept) × Bike -1.62890*** -2.23618*** -1.75391** (0.42578) (0.53067) (0.74120) (Intercept) × Walk 0.06816 -1.55550*** 0.69532 (0.34577) (0.51427) (0.51243) I(cost/hhinc) -0.05242*** -0.06050*** -0.04241*** (0.01040) (0.01448) (0.01502) mot_tvtt -0.02019*** -0.01938*** -0.02027*** (0.00381) (0.00530) (0.00568) nm_tvtt -0.04545*** -0.02373*** -0.07168*** (0.00577) (0.00749) (0.00946) I(mot_ovtt/dist) -0.13287*** -0.19119*** -0.08886*** (0.01964) (0.03154) (0.02574) hhinc × Transit -0.00532*** -0.00172 -0.00818*** (0.00198) (0.00268) (0.00302) hhinc × Bike -0.00864* -0.00092 -0.03568*** (0.00515) (0.00566) (0.01371) hhinc × Walk -0.00600* -0.00458 -0.00384 (0.00315) (0.00456) (0.00445) vehbywrk × Transit -0.94623*** -0.65309*** -0.44164*** (0.11367) (0.15032) (0.16648) vehbywrk × Bike -0.70211*** -0.81375*** 0.31291 (0.25716) (0.31066) (0.36089) vehbywrk × Walk -0.72180*** -0.43103** -0.44055* (0.16735) (0.21532) (0.25244) cbddumall × Share ride 2 0.25983** 0.07495 0.66040*** (0.12317) (0.17327) (0.17732) cbddumall × Share ride 3++ 1.06927*** 1.47472*** 0.59881* (0.19114) (0.23567) (0.33441) cbddumall × Transit 1.30881*** 1.19366*** 1.46080*** (0.16570) (0.24275) (0.23542) cbddumall × Bike 0.48929 0.30632 1.08042* (0.36110) (0.46846) (0.59858) cbddumall × Walk 0.10175 0.20364 -0.02633 (0.25209) (0.37784) (0.35494) wkempden × Share ride 2 0.00158*** 0.00096* 0.00303*** (0.00039) (0.00053) (0.00066) wkempden × Share ride 3++ 0.00226*** 0.00062 0.00507*** (0.00045) (0.00061) (0.00078) wkempden × Transit 0.00313*** 0.00253*** 0.00454*** (0.00036) (0.00045) (0.00065) wkempden × Bike 0.00193 0.00055 0.00401* (0.00122) (0.00149) (0.00220) wkempden × Walk 0.00289*** 0.00135 0.00525*** (0.00074) (0.00104) (0.00116) Num.Obs. 5029 2842 2187 AIC 6946.4 3875.2 3195.9 BIC Log.Lik. -3444.185 -1908.617 -1568.968 rho2 0.29091 0.26396 0.30038 rho20 0.61777 0.62519 0.59961 * p &lt; 0.1, ** p &lt; 0.05, *** p &lt; 0.01 The female segment parameters for alternative specific variables; Income, Autos per Worker, CBD Dummy and Employment Density are generally more favorable to non-auto modes and especially bike and walk, but the differences are small and marginally or not significant. Both groups show almost identical sensitivity to motorized in-vehicle travel time. However, the female group is more sensitive to non-motorized travel time while the male group is more sensitive to out-of-vehicle time. The female segment exhibits a much lower sensitivity to cost than males. The above observations demonstrate that taste variations exist between the auto ownership segments and between the gender segments. However, in each case, the differences appear to be associated with a subset of parameters. One approach to simplifying the segmentation is to adopt a pooled model which includes segment related parameters where the differences are important35. For example, such a model would at a minimum include different parameters for each of the segment for the following variables: - Travel cost by income, - Total travel time for non-motorized modes, and - Out-of-vehicle time by distance. 6.4 Summary This chapter demonstrates the development of an MNL model specification for work mode to choice using data from the San Francisco Bay Area for a realistic context. We start with relatively simple model specifications and develop more complex models which provide additional insight into the behavioral choices being made. We begin with the variables: travel cost, total travel time and household income. We then develop a more comprehensive model which includes: 1) cost divided by income to account for travelers different sensitivity to cost depending on household income, 2) two variables for time by motorized vehicle (which capture the constraint that OVTT is valued less for longer trips than shorter trips but is valued more highly than IVTT for all trip distances) and an additional variable for non-motorized personal transport (walk and bike), 3) alternative specific income variables, 4) number of autos per worker in the household, 5) location of the work zone (CBD or not), and 6) employment density of the work location. The specification search was not necessarily exhaustive and improvements to the final preferred model specification are possible. The example describes the basis for the decisions made at each point in the model specification search process. Clearly, different decisions could be made at some of these points. Thus, the final model result is based on a complex mix of empirical results, statistical analysis and judgment. The challenge to the analyst is to make good judgment, describe the basis for the judgments made, and be prepared to demonstrate the implications of making different judgments. In the next chapter, we extend our work to consideration of home-based shop/other trips and we consider adoption of the more sophisticated nested logit model. References "],["other-purpose-chapter.html", "Chapter 7 San Francisco Bay Area Shop / Other Mode Choice 7.1 Introduction 7.2 Specification for Shop/Other Mode Choice Model 7.3 Initial Model Specification 7.4 Exploring Alternative Specifications", " Chapter 7 San Francisco Bay Area Shop / Other Mode Choice library(tidyverse) ## ── Attaching packages ─────────────────────────────────────── tidyverse 1.3.0 ── ## ✓ ggplot2 3.3.3 ✓ purrr 0.3.4 ## ✓ tibble 3.1.1 ✓ dplyr 1.0.5 ## ✓ tidyr 1.1.3 ✓ stringr 1.4.0 ## ✓ readr 1.4.0 ✓ forcats 0.5.1 ## ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ── ## x dplyr::filter() masks stats::filter() ## x dplyr::lag() masks stats::lag() library(haven) library(mlogit) ## Loading required package: dfidx ## ## Attaching package: &#39;dfidx&#39; ## The following object is masked from &#39;package:stats&#39;: ## ## filter library(modelsummary) Chapter 7 7.1 Introduction sf_shopother_raw &lt;- read_spss(&quot;data-raw/Shopping Trips/SPSS/MTC Shopping v2.SAV&quot;) %&gt;% mutate(ALTNAME = factor(ALTID, labels = c(&quot;Transit&quot;, &quot;Share 2&quot;, &quot;Share 3+&quot;,&quot;Drive alone and Share 2/3+&quot;, &quot;Share 2/3+&quot;,&quot;Bike&quot;, &quot;Walk&quot;, &quot;Drive alone&quot;))) names(sf_shopother_raw) &lt;- tolower(names(sf_shopother_raw)) sf_shopother &lt;- dfidx(sf_shopother_raw, idx = c(&quot;casenum&quot;, &quot;altname&quot;)) # write to data/ folder for future use write_rds(sf_shopother, &quot;data/shopother.rds&quot;) #add labels to alternative names 7.2 Specification for Shop/Other Mode Choice Model 7.3 Initial Model Specification 7.4 Exploring Alternative Specifications "],["nestedlogit-chapter.html", "Chapter 8 Nested Logit Model 8.1 Motivation 8.2 Formulation of Nested Logit Model 8.3 Nesting Structures 8.4 Statistical Testing of Nested Logit Structures", " Chapter 8 Nested Logit Model library(mlogit) ## Loading required package: dfidx ## ## Attaching package: &#39;dfidx&#39; ## The following object is masked from &#39;package:stats&#39;: ## ## filter library(tidyverse) ## ── Attaching packages ─────────────────────────────────────── tidyverse 1.3.0 ── ## ✓ ggplot2 3.3.3 ✓ purrr 0.3.4 ## ✓ tibble 3.1.1 ✓ dplyr 1.0.5 ## ✓ tidyr 1.1.3 ✓ stringr 1.4.0 ## ✓ readr 1.4.0 ✓ forcats 0.5.1 ## ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ── ## x dplyr::filter() masks dfidx::filter(), stats::filter() ## x dplyr::lag() masks stats::lag() library(modelsummary) library(haven) library(knitr) library(kableExtra) ## ## Attaching package: &#39;kableExtra&#39; ## The following object is masked from &#39;package:dplyr&#39;: ## ## group_rows 8.1 Motivation The Multinomial Logit Model (MNL) structure has been widely used for both urban and intercity mode choice models primarily due to its simple mathematical form, ease of estimation and interpretation, and the ability to add or remove choice alternatives. However, the MNL model has been widely criticized for its Independence of Irrelevant Alternatives (IIA) property (see Section 4.2. The IIA property of the MNL restricts the ratio of the choice probabilities for any pair of alternatives to be independent of the existence and characteristics of other alternatives in the choice set. This restriction implies that introduction of a new mode or improvements to any existing mode will reduce the probability of existing modes in proportion to their probabilities before the change. The IIA property is a major limitation of the MNL model as it implies equal competition between all pairs of alternatives, an inappropriate assumption in many choice situations. For example, in the case of urban mode choice among drive alone, shared ride, bus and light rail; the bus and light rail alternatives are likely to be more similar to each other than they are to either of the other alternatives due to shared attributes which are not included in the measured portion of the utility function; for example, bus and light rail may have the same fare structure and operating policies, the same lack of privacy, control of the environment, and so on. Such similarities, if not included in the measured portion of the utility function, lead to correlation between the errors associated with these alternatives, a violation of the assumptions which underlie the derivation of the MNL. &lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD The way in which this undesirable characteristic of the IIA property manifests itself can be illustrated using this example. Assume that the choice probabilities (for an individual or a homogeneous group of individuals) are 65%, 15%, 10% and 10% for drive alone, shared ride, bus and light rail, respectively. If the light rail service were to be improved in such a way as to increase its choice probability to 19%, the MNL model would predict that the shares of the other alternatives would decrease proportionately as shown in Table 8 1, decreasing the probability for the drive alone, shared ride and bus alternatives by a factor of 0.90. As a result, the MNL model predicts that most of the increased light rail ridership comes from drive alone (6.5%) while only 1.5% comes from car pool and 1% from bus. This is inconsistent with expectations and empirical evidence that most of the new light rail riders will be diverted from bus and carpool. This inconsistency is a direct result of the IIA property of the MNL model. Thus, in these types of choice situations, the MNL model will yield incorrect predictions of diversions from existing modes. ======= The way in which this undesirable characteristic of the IIA property manifests itself can be illustrated using this example. Assume that the choice probabilities (for an individual or a homogeneous group of individuals) are 65%, 15%, 10% and 10% for drive alone, shared ride, bus and light rail, respectively. If the light rail service were to be improved in such a way as to increase its choice probability to 19%, the MNL model would predict that the shares of the other alternatives would decrease proportionately as shown in Table 8-1, decreasing the probability for the drive alone, shared ride and bus alternatives by a factor of 0.90. As a result, the MNL model predicts that most of the increased light rail ridership comes from drive alone (6.5%) while only 1.5% comes from car pool and 1% from bus. This is inconsistent with expectations and empirical evidence that most of the new light rail riders will be diverted from bus and carpool. This inconsistency is a direct result of the IIA property of the MNL model. Thus, in these types of choice situations, the MNL model will yield incorrect predictions of diversions from existing modes. &gt;&gt;&gt;&gt;&gt;&gt;&gt; fc670364f9aaae40afdd9198bafb2008992265f2 More extreme examples of this phenomenon have been described in the modeling literature. Most widely known among them is the red bus/blue bus problem described in Section 4.2.1. These and numerous other examples illustrate that the IIA property is difficult to justify in situations where some alternatives compete more closely with each other than they do with other alternatives. This limitation of the MNL model results from the assumption of the independence of error terms in the utility of the alternatives Section 3.5, which is used to derive the model. Different models can be derived through the use of different assumptions concerning the structure of the error distributions of alternative utilities. Among them, the Nested Logit (NL) model (Williams, 1977; McFadden, 1978; Daly and Zachary, 1978), is the simplest and most widely used. The NL model represents important deviations from the IIA property but retains most of the computational advantages of the MNL model (Borsch-Supan, 1987). The NL model is characterized by grouping (or nesting) subsets of alternatives that are more similar to each other with respect to excluded characteristics than they are to other alternatives. Alternatives in a common nest exhibit a higher degree of similarity and competitiveness than alternatives in different nests. This level of competitiveness, represented by cross-elasticities between pairs of alternatives (the impact of a change in one mode on the probability of another mode) is identical for all pairs of alternatives in the nest. Complex tree structures can be developed which offer substantial flexibility in representing differential competitiveness between pairs of alternatives; however, the nesting structure imposes a system of restrictions concerning relationships between pairs of alternatives as will be discussed later in this chapter. 8.2 Formulation of Nested Logit Model The derivation of the nested logit model is based on the assumption that some of the alternatives share common components in their random error terms. That is, the random term of the nested alternatives can be decomposed into a portion associated with each alternative and a portion associated with groups of alternatives. For example, consider an urban mode choice where a traveler has four modes (drive alone, shared ride, commuter rail and bus) available for making an intercity trip. The utility equations for these alternatives are: \\[\\begin{align} U_{DA} &amp;= V_{DA} + \\epsilon_{DA} \\\\ U_{SR} &amp;= V_{SR} + \\epsilon_{SR} \\\\ U_{Bus} &amp;= V_{PT} + V_{Bus} + \\epsilon_{SR} + \\epsilon_{Bus} \\\\ U_{LTR} &amp;= V_{PT} + V_{LTR} + \\epsilon_{SR} + \\epsilon_{LTR} \\tag{8.1} \\end{align}\\] The utility terms for bus and light rail each include a distinct observed component, \\(V_{Bus}\\) and \\(V_{LTR}\\), and a common observed component, \\(V_{PT}\\) , for public transit (PT); they also include distinct random components, \\(\\varepsilon_{Bus}\\) and \\(\\varepsilon_{LTR}\\) , and a common random component, \\(\\varepsilon_{PT}\\) . The common error component creates a covariance between the total errors for bus, \\(\\varepsilon_{PT} + \\varepsilon_{Bus}\\) , and Light Rail, \\(\\varepsilon_{PT} + \\varepsilon_{LTR}\\) . This covariance violates the assumption underlying the MNL model representing an increased similarity between pairs of nested alternatives (bus and Light Rail, in this case) and leads to greater cross-elasticity between these alternatives. The total error for each of the four alternatives is assumed to be distributed Gumbel with scale parameter equal to one, as in the MNL model. The variance of these distributions is: \\[\\begin{equation} V_{AR} (\\epsilon_{DA}) = V_{AR} (\\epsilon_{SR}) = V_{AR} (\\epsilon_{PT} + \\epsilon_{Bus}) = V_{AR} (\\epsilon_{PT} + \\epsilon_{LTR}) = \\pi^2/6 \\tag{8.2} \\end{equation}\\] The distinct error components, \\(\\varepsilon_{Bus}\\) and \\(\\varepsilon_{LTR}\\) , also are assumed to be distributed Gumbel, but with scale parameter, \\(\\mu_{PT}\\) . However, in practice we estimate \\(\\theta_{PT} = \\frac{1}{\\mu_{PT}}\\), the inverse of the Gumbel scale parameter. \\(\\theta_{PT}\\) , commonly referred to as the logsum parameter, is bounded by zero and one. That is, the variance of these distributions is: \\[\\begin{equation} V_{AR}(\\epsilon_{Bus}) = V_{AR} (\\epsilon_{LTR}) = \\pi^2/(6 \\mu_{PT}^2) = (\\pi^2 \\theta_{PT}^2)/6 \\tag{8.3} \\end{equation}\\] where \\(\\mu_{PT}\\) is bounded by one and positive infinity (\\(\\theta_{PT}\\) is bounded by zero and one) to ensure that the conditional variance for bus, \\(Var(\\varepsilon_{Bus})\\) , is less than the total variance for bus, \\(Var(\\varepsilon_{PT}+\\varepsilon_{Bus})\\) , and similarly for Light Rail. This is required to ensure that the variance for the common public transit error component, \\(\\varepsilon_{PT}\\) , is non-negative. These assumptions are adequate to derive a nested logit model using utility maximization principles. The choice structure implied by these equations is depicted by the nesting structure in Figure 8.3, in which bus and light rail are more similar to each other than they are to drive alone and shared ride. It is convenient to interpret this structure as if there are two levels of choice even though the derivation of the model makes no assumptions about the structure of the choice process . The figure depicts an upper level (marginal) choice among drive alone, shared ride, and public transit and a lower level (conditional) choice between bus and light rail, given that public transit is chosen. knitr::include_graphics(rep(&quot;img/Twoleveltwoalternatives.PNG&quot;)) Figure 8.1: Two-Level Nest Structure with Two Alternatives in Lower Nest The choice probabilities for the lower level nested alternatives (commuter rail or bus), conditional on choice of these alternatives are given by: \\[\\begin{equation} Pr(BUS/PT) = \\frac{exp(V_{BUS}/ \\theta_{PT})}{exp(V_{BUS}/ \\theta_{PT}) + exp(V_{LTR}/ \\theta_{PT})} \\tag{8.4} \\end{equation}\\] \\[\\begin{equation} Pr(LTR/PT) = \\frac{exp(V_{LTR}/ \\theta_{PT})}{exp(V_{BUS}/ \\theta_{PT}) + exp(V_{LTR}/ \\theta_{PT})} \\tag{8.5} \\end{equation}\\] This is the standard logit form except for the inclusion of the logsum parameter in the denominator of each utility function. The marginal choice probabilities for the drive alone, shared ride, and public transit alternatives are: \\[\\begin{equation} Pr(DA) = \\frac{exp(V_{DA})} {exp(V_{DA}) + exp(V_{SR}) + exp(V_{PT} + \\theta_{PT} \\Gamma_{PT})} \\tag{8.6} \\end{equation}\\] \\[\\begin{equation} Pr(DA) = \\frac{exp(V_{SR})} {exp(V_{DA}) + exp(V_{SR}) + exp(V_{PT} + \\theta_{PT} \\Gamma_{PT})} \\tag{8.7} \\end{equation}\\] \\[\\begin{equation} Pr(DA) = \\frac{exp(V_{PT} + \\theta_{PT} \\Gamma_{PT})} {exp(V_{DA}) + exp(V_{SR}) + exp(V_{PT} + \\theta_{PT} \\Gamma_{PT})} \\tag{8.8} \\end{equation}\\] The expected utility of the public transit alternatives equals this value, \\(\\Gamma_{PT}\\) , times the logsum parameter, \\(\\theta_{PT}\\) , plus other attributes common to the pair of alternatives, \\(V_{PT}\\) . \\(\\Gamma_{PT}\\) is computed from the log of the sum of the exponents of the nested utilities (equations 8.4 and 8.5), commonly referred to as the “logsum” variable. \\[\\begin{equation} \\Gamma_{PT} = log \\left[ exp \\left( \\frac{V_{Bus}}{\\theta_{PT}} \\right) +exp \\left( \\frac{V_{LTR}}{\\theta_{PT}} \\right) \\right] \\tag{8.9} \\end{equation}\\] An important feature of these equations is that the logsum parameter, \\(\\theta_{PT}\\), appears in the denominator of the conditional utility for all the nested alternatives. The implication of this is that all of the utility function parameters, \\(\\beta\\), are scaled by a common value. Since \\(\\theta_{PT}\\) is bounded by zero and one, the magnitudes of all the resultant parameters, \\(\\beta/\\theta_{PT}\\), are increased implying that the choice between the nested alternatives is more sensitive to changes to any of the variables in these functions than are alternatives not in the nest. Further, if the number of alternatives in any nest is reduced to one, the utility in the marginal model becomes identically equal to the utility for the remaining alternative. That is, if the bus alternative is not available to some travelers, the utility of the nest becomes: \\[\\begin{align*} V^*_{PT} &amp;= V_{PT} + \\theta_{PT} log \\left[ exp \\left( \\frac{V_{LTR}}{\\theta_{PT}} \\right) \\right] \\\\ &amp;= V_{PT} + V_{LRT} \\tag{8.10} \\end{align*}\\] The probability of choosing the nested alternatives can be obtained by multiplying the conditional probability of the nested alternative by the marginal probability as follows: \\[\\begin{equation} P(Bus) = P(Bus \\mid PT) \\times P(PT) \\tag{8.11} \\end{equation}\\] \\[\\begin{equation} P(Bus) = P(Bus \\mid PT) \\times P(PT) \\tag{8.12} \\end{equation}\\] 8.2.1 Interpretation of the Logsum Parameter The logsum parameter, \\(\\theta\\) , (sometimes called the “dissimilarity parameter” or the “nesting coefficient”), is a function of the underlying correlation between the unobserved components for pairs of alternatives in that nest, and it characterizes the degree of substitutability between those alternatives. The value of the logsum parameter is bounded by zero and one to ensure consistency with random utility maximization principles. Different values of the parameter indicate the degree of dissimilarity between pairs of alternatives in the nest. The interpretation of different values of the logsum parameter is as follows: • \\(\\theta &gt; 1\\) Not consistent with the theoretical derivation. Reject NL model. • \\(\\theta = 1\\) Implies zero correlation among mode pairs in the nest so the NL model collapses to the MNL model. • \\(0 &lt; \\theta &lt; 1\\) Implies non-zero correlation among pairs. This range of values is appropriate for the nested logit model. Decreasing values of \\(\\theta\\) indicate increased substitution between/among alternatives in the nest. • \\(\\theta = 0\\) Implies perfect correlation between pairs of alternatives in the nest. That is, the choice between the nested alternatives, conditional on the nest, is deterministic. • \\(\\theta &lt; 0\\) Not consistent with the theoretical derivation. Therefore, we reject the nested logit model. 8.2.2 Disaggregate Direct and Cross-Elasticities The differences between the nested logit model and the multinomial logit model can be illustrated by comparison of the elasticities of each alternative to changes in the value of a variable associated with it (direct elasticity) or with another alternative (cross elasticity) as reported in Table 8-2. The MNL direct- and cross-elasticity equations are the same for all alternatives. This is a manifestation of the IIA property of the MNL model. However, the elasticity expressions for the NL model are differentiated between cases in which the alternative being considered is or is not in the same nest as the alternative which is changed. Both models produce identical direct- and cross-elasticities when the attribute that is changed is for one of the non-nested alternatives. However, the elasticity equations for changes in the attributes of nested alternatives are different. These differences are attributable to the value of \\(\\theta\\) in the elasticity equations. When \\(\\theta\\) is equal to one, its maximum value, the expression, \\(\\frac{1-\\theta}{\\theta}\\) , in the elasticity formulae in Table 8-2 becomes zero and the direct and cross-elasticity expressions for the nested alternatives collapse to the corresponding equations for the alternatives not in the nest. As the scale parameter, \\(\\theta\\) , decreases from one to zero, this expression increases and the direct- and cross-elasticities within the nest become larger (possibly, much larger) than the direct- and cross-elasticities between the nests. That is, the sensitivity of a nested alternative to changes in its attributes or to changes in the attributes of other nested alternatives becomes much greater than the corresponding changes for non-nested alternatives. Although the same comparison appears to exist between nested alternatives and similar alternatives in the MNL model, this can only be evaluated by taking account of differences in the \\(\\beta\\) parameters between the MNL and NL models. Elasticity of Probability of Choosing Mode Changes in Non-Nested Alternative, ‘j’ Changed in Nested Alternative ‘k’ Direct Elasticity Multinomial Logit \\((1-P_j)\\beta_{LOS}{LOS}_j\\) Not Applicable Nested Logit \\((1-P_j)\\beta_{LOS}{LOS}_j\\) \\(\\left( (1-P_k) + \\left( \\frac{1-\\theta_N}{\\theta_N} \\right) (1-P_{k|N}) \\right) \\times \\beta_{LOS}{LOS}_k\\) Cross Elasticity: Effect on Non-Nested Alternatives Multinomial Logit \\(-P_j \\beta_{LOS}{LOS}_j\\) Not Applicable Nested Logit \\(-P_j \\beta_{LOS}{LOS}_j\\) \\(-P_k \\beta_{LOS}{LOS}_k\\) Cross Elasticity: Effect on Nested Alternatives Multinomial Logit Not Applicable Not Applicable Nested Logit \\(-P_j \\beta_{LOS}{LOS}_j\\) \\(- \\left( P_k + \\left( \\frac{1-\\theta_N}{\\theta_N} \\right)(P_{k|N}) \\right) \\times \\beta_{LOS}{LOS}_k\\) 8.3 Nesting Structures The assumptions underlying the model described in the preceding section (correlation of error terms for the bus and light rail alternatives) results in a two-level model with a single public transit nest for the four alternative (drive alone, shared ride, commuter rail, and bus) mode choice problem. This nesting structure is one of many possible two-level nested logit models which can be constructed for a choice set with four alternatives. The possible set of two-level nested logit models includes six combinations of two alternatives in a nest with the remaining alternatives at the upper level, four combinations of three alternatives in a nest and one at the upper level and three combinations of two alternatives in a nest and two alternatives in a parallel nest for a total of thirteen two level nest structures (Figure 8.2). The number of two level nest structures increases rapidly with the number of alternatives as shown in Table 8-3 below. knitr::include_graphics(rep(&quot;img/Threetypestwolevelnests.PNG&quot;)) Figure 8.2: Three Types of Two Level Nests Some of these nesting structures are likely to be behaviorally unreasonable; for example, it doesn’t seem reasonable to include bus and car in the same nest. The selection of a preferred nesting structure requires a combination of judgment (about reasonable nesting structures) and statistical hypothesis testing; specifically, testing the hypothesis that the MNL or a simpler NL model is the true model. Further, sub-groups of alternatives within any group may themselves be more similar to each other than to other alternatives in the larger group. Representation of these differences in similarity can result in multiple levels of nesting, hierarchically identifying increasingly similar alternatives at each level (Borsch-Supan, 1987). For example, in the four alternative case, the case of three alternatives in a lower nest might represent alternatives that include group riding (shared ride, bus and light rail). If we believe that the bus and light rail alternatives are more similar than either alternative is to shared ride, utility equations with the following common error terms will show an intermediate level of error correlation among all group travel modes, and an additional level of error correlation between commuter rail and bus. \\[\\begin{equation} \\begin{split} U_{DA} &amp; = V_{DA} + \\epsilon_{DA} \\\\ U_{SR} &amp; = V_{GRP} + V_{SR} + \\epsilon_{GRP} + \\epsilon_{SR} \\\\ U_{Bus} &amp; = V_{GRP} + V_{PT} + V_{Bus} + \\epsilon_{GRP} + \\epsilon_{PT} + \\epsilon_{Bus} \\\\ U_{LTR} &amp; = V_{GRP} + V_{PT} + V_{LTR} + \\epsilon_{GRP} + \\epsilon_{PT} + \\epsilon_{LTR} \\end{split} \\end{equation}\\] In this case, the group travel modes (shared ride, commuter rail and bus) will be nested at the second level and commuter rail and bus will be nested at the third or lowest level as shown in Figure 8.3. In this model structure, the lower level nest is a binary choice between commuter rail and bus, conditional on choice of public transit; the second level nest represents a choice between shared ride and public transit conditional on group travel; and the highest level represents a choice between drive alone and group travel. knitr::include_graphics(rep(&quot;img/Threelevelfouralternatives.PNG&quot;)) Figure 8.3: Three-Level Nest Structure for Four Alternatives Twelve three-level nested structures are possible with four alternatives; these are combinations of two alternatives at the lowest level, one alternative at the intermediate level and one alternative at the upper level. The probability equations for the two-level nested logit model can be extended readily to the three-level case as illustrated below. The probabilities for each nested alternative in the lowest level, commuter rail or bus, conditional on choice of public transit (PT) are given by: \\[\\begin{equation} Pr(Bus \\mid PT) = \\frac {\\exp(\\frac{V_{Bus}}{\\theta_{PT}})} {\\exp(\\frac{V_{Bus}}{\\theta_{PT}}) + \\exp{\\frac{V_{LTR}}{\\theta_{PT}}}} \\tag{8.13} \\end{equation}\\] \\[\\begin{equation} Pr(LTR \\mid PT) = \\frac {\\exp(\\frac{V_{LTR}}{\\theta_{PT}})} {\\exp(\\frac{V_{Bus}}{\\theta_{PT}}) + \\exp{\\frac{V_{LTR}}{\\theta_{PT}}}} \\tag{8.14} \\end{equation}\\] where \\(\\theta_{PT}\\) is the logsum paratmeter at the lowest (i.e. public transit) nest level. The probabilities for each alternative in the second level nest, shared ride and public transit, conditional on the choice of group travel (GRP) modes are: &lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD \\[\\begin{equation} Pr(SR \\ GRP) = \\frac {\\exp(\\frac{V_{SR}}{\\theta_{GRP}})} {\\exp(\\frac{V_{SR}}{\\theta_{GRP}}) + \\exp{\\frac{{V_{PT} + \\theta_{PT} \\times \\Gamma_{PT}}{\\theta_{GRP}}}}} \\tag{8.15} \\end{equation}\\] \\[\\begin{equation} Pr(PT \\ GRP) = \\frac {\\exp(\\frac{V_{PT} + \\theta_{PT} \\times \\Gamma_{PT}} {\\theta_{GRP}})} {\\exp(\\frac{V_{SR}}{\\theta_{GRP}}) + \\exp{\\frac{{V_{PT} + \\theta_{PT} \\times \\Gamma_{PT}}{\\theta_{GRP}}}}} \\tag{8.16} \\end{equation}\\] where \\(\\theta_{GRP}\\) is the logsum parameter for the intermediate level (i.e. for the group travel modes) and, \\(\\Gamma_{PT}\\) is the “logsum” of the exponents of the nested utilities for the lower nest level: ======= \\(\\Gamma_{PT}\\) is the “logsum” of the exponents of the nested utilites for the lower nest level: \\[\\begin{equation} \\Gamma_{PT} = log(exp(\\frac{V_{BUS}}{\\theta_{PT}}) + exp(\\frac{V_{LTR}}{\\theta_{PT}})) \\tag{8.17} \\end{equation}\\] fc670364f9aaae40afdd9198bafb2008992265f2 Finally, the probabilities for automobile and the common carrier nest are: \\[\\begin{align} Pr(DA) = \\frac{exp(V_{DA})} {exp(V_{DA}) + exp(V_{GRP} + \\theta_{GRP} \\Gamma_{GRP})} \\\\ Pr(GRP) = \\frac{exp(V_{GRP} + \\theta_{GRP} \\Gamma_{GRP})} {exp(V_{DA}) + exp(V_{GRP} + \\theta_{GRP} \\Gamma_{GRP})} \\tag{8.18} \\end{align}\\] where \\(\\theta_{GRP}\\) is the logsum parameter for the intermediate level (i.e., for the common carrier modes), and \\(\\Gamma_{GRP}\\) is the logsum of the exponents of the nested utilities for the intermediate nest: \\[\\begin{equation} \\Gamma_{GRP} = log({exp \\frac{V_{SR}}{\\theta_{GRP}}+ exp \\frac{V_{PT} + \\theta_{PT} \\Gamma_{PT}}{\\theta_{GRP}}}) \\tag{8.19} \\end{equation}\\] The marginal probabilities of shared ride, commuter rail and bus are the product of the probabilities of each branch from the root (top of the tree) to the alternative: \\[\\begin{align} Pr(SR) = Pr(SR|GRP) \\times Pr(GRP) \\\\ Pr(BUS) = Pr(BUS|PT) \\times Pr(PT|GRP) \\times Pr(GRP) \\\\ Pr(LTR) = Pr(LTR|PT) \\times Pr(PT|GRP) \\times Pr(GRP) \\\\ \\tag{8.20} \\end{align}\\] The value of the logsum parameters decrease as we go down the tree. This follows from the requirement that the error variance at each level of the tree must be lower than at the next higher level since the total variance for each alternative is fixed and the variance at each level of the tree must be positive (non-negative). The total variance for each alternative, \\(Var(\\varepsilon^*_{Mode})\\) , is given by: \\[\\begin{equation} Var(\\varepsilon^*_{DA})=\\frac{\\pi^2}{6} \\tag{8.21} \\end{equation}\\] \\[\\begin{equation} Var(\\varepsilon^*_{SR}) = Var(\\varepsilon_{SR}+\\varepsilon_{GRP}) =Var(\\varepsilon_{SR})+ Var(\\varepsilon_{GRP}) =\\frac{\\pi^2}{6} \\tag{8.22} \\end{equation}\\] \\[\\begin{equation} Var(\\varepsilon^*_{Bus}) = Var(\\varepsilon_{GRP}+\\varepsilon_{PT}+\\varepsilon_{Bus}) =Var(\\varepsilon_{GRP}) + Var(\\varepsilon_{PT}) + Var(\\varepsilon_{Bus}) =\\frac{\\pi^2}{6} \\tag{8.23} \\end{equation}\\] \\[\\begin{equation} Var(\\varepsilon^*_{LTR}) = Var(\\varepsilon_{GRP}+\\varepsilon_{PT}+\\varepsilon_{LTR}) =Var(\\varepsilon_{GRP}) + Var(\\varepsilon_{PT}) + Var(\\varepsilon_{LTR}) =\\frac{\\pi^2}{6} \\tag{8.24} \\end{equation}\\] The variance components for alternatives, group elements and public transit elements of each alternative are shown in the following figure. knitr::include_graphics(rep(&quot;img/Decompositionoferrorvariance.PNG&quot;)) Figure 8.4: Decomposition of Error Variance This figure helps to explain the hierarchical restrictions on logsum parameters. Section 8.2.1 described the initial restriction on the logsum for a single nest level or a two level tree as follows: \\(0 &lt; \\theta &lt; 1\\) . However, in multi-level tree structures, as shown in Section 8.3, the logsum parameter at each level is restricted to be between zero and the logsum parameter at the next higher level of the nesting structure. Thus, in the example in Figure 8.4 above, \\(0 &lt; \\theta_{Grp} &lt; 1\\) and \\(0 &lt; \\theta_{PT} &lt; \\theta_{Grp}\\) . This hierarchical restriction ensures that the variance of each error term in equations 8.22 through 8.25 is positive, as required. In particular, the variances are defined as \\[\\begin{equation} $Var(\\varepsilon_{Total})=\\frac{\\pi^2}{6}$ \\tag{8.25} \\end{equation}\\] \\[\\begin{equation} $Var(\\varepsilon_{GRP})=\\frac{\\pi^2\\theta^2_{GRP}}{6}$ \\tag{8.26} \\end{equation}\\] \\[\\begin{equation} $Var(\\varepsilon_{PT})=\\frac{\\pi^2\\theta^2_{PT}}{6}$ \\tag{8.27} \\end{equation}\\] \\[\\begin{equation} $Var(\\varepsilon_{Total}-\\varepsilon_{GRP})=\\frac{\\pi^2}{6}(1-\\theta^2_{GRP})$ \\tag{8.28} \\end{equation}\\] \\[\\begin{equation} $Var(\\varepsilon_{GRP}-\\varepsilon_{PT})=\\frac{\\pi^2}{6}(\\theta^2_{GRP}-\\theta^2_{PT})$ \\tag{8.29} \\end{equation}\\] To ensure that all the variance components are positive, as required, the nesting parameters must be constrained as shown \\(0 &lt; \\theta_{PT} &lt; \\theta_{Grp}\\). These hierarchical constraints apply to all levels of nested logit models. The examples of two-level and three-level nesting structures shown in Figure 8.2 and Figure 8.3 represent four of the twenty-eight different nested models (13 two-level and 12 three-level) that are feasible for a four-alternative case. The number of distinct nests increases rapidly with an increasing number of alternatives (see 8.1). The large number of feasible nesting structures poses a substantial problem of determining which one best reflects the choice behavior of the population. The analyst’s judgment can be used to substantially reduce this to a smaller number of realistic structures (based on our understanding of the competitive relationships); however, the analyst needs to be cautious in excluding structures since some apparently non-intuitive structures may have good fit statistics and their interpretation may provide useful insight into the choice behavior under study. Table 8.1: Number of Possible Nesting Structures Number of Alternatives Possible 2-Level Nesting Structures Possible 3-Level Nesting Structures Total Possible Nesting Structures All Levels 3 3 0 3 4 13 12 25 5 50 125 235 6 201 1040 2711 8.4 Statistical Testing of Nested Logit Structures Adopting a nested logit model implies rejection of the MNL . We can use standard statistical tests of the hypothesis that the MNL model is the true model since the nested logit model is a generalization of the MNL model. In the case of multiple nests, the hypothesis that the MNL is the true model is equivalent to the hypothesis that all the logsum parameters are equal to one. We can use the likelihood ratio statistic with degrees of freedom equal to the number of logsum parameters (the number of restrictions between the NL and the MNL) to test this hypothesis. We reject the null hypothesis that the MNL model is the correct model if the calculated value is greater than the test or critical value for the distribution as: \\[\\begin{equation} $\\displaystyle -2 \\times [l^{MNL} - l^{NL}]\\ge \\chi^{2}_{n}$ where n is the number of restrictions (nests) between the MNL and NL models. \\tag{8.30} \\end{equation}\\] In the case of a simple NL model with a single nest, we can use the t-statistic to test the hypothesis that the logsum parameter is equal to one. Even in a more complex NL model, we can test each logsum term to determine if a portion of the nesting structure can be eliminated. For each case in which the hypothesis that the logsum parameter is equal to one is not rejected, the corresponding branch of the tree can be eliminated and the alternatives can go directly to the next level. The t-statistics must be evaluated for the appropriate null hypothesis. For nests directly under the root of the tree, the null hypothesis is \\(H_0: \\mu_k = 1\\) ; for other nests, the null hypothesis is that the parameter for that nest is equal to the parameter for the next higher nest in the tree. That is, for a top level nest, \\[\\begin{equation} $\\displaystyle t-statistic = \\frac{\\hat\\theta - 1}{S_{k}}$ where $\\hat\\theta$ is the estimate of the logsum parameter for nest {k}, 1 is the hypothesized value against which the logsum parameter is being tested; $S_{k}$ is the standard error of the parameter estimate. \\tag{8.31} \\end{equation}\\] For other nests, \\[\\begin{equation} $\\displaystyle t-statistic = \\frac{\\hat\\theta_{k \\subset j} - \\hat\\theta_{j}}{\\sqrt {S^{2}_{k\\subset j} + S^{2}_{j}-2S_{k\\subset j,j}}}$ where $\\hat\\theta_{k\\subset j}$ is the estimate of the logsum parameter for nest k that is included under nest j, $\\hat\\theta_{j}$ is the estimate of the logsum parameter for nest j, $S^{2}_{k\\subset j}$ is the error variance of the logsum parameter for nest k that is included under nest j, $S^{2}_{j}$ is the error variance of the logsum parameter for nest j, and $S_{k\\subset j,j}$ is the error covariance of the two logsum parameters. \\tag{8.31} \\end{equation}\\] It is important to note that these are not necessarily the test values that will be reported by all computer programs, many of which apply the test for the null hypothesis that the logsum is equal to zero or one only. If the test against zero is reported , the user must obtain or calculate the standard errors of estimate for the relevant parameters and calculate the t-statistic(s) as defined above. The likelihood ratio test can also be used to test the significance of more complex nested models or between models with different nesting structures as long as the nesting structure of one model can be obtained as a restriction of the other. To choose between two nested logit models where neither model is a restricted version of the other, we use the non-nested hypothesis test discussed in CHAPTER 5 section 5.7.3.2. "],["nesting-selection-chapter.html", "Chapter 9 Selecting a Preferred Nesting Structure 9.1 Introduction 9.2 Nested Models for Work Trips 9.3 Nested Models for Shop / Other Trips 9.4 Practical Issues and Implications", " Chapter 9 Selecting a Preferred Nesting Structure library(mlogit) ## Loading required package: dfidx ## ## Attaching package: &#39;dfidx&#39; ## The following object is masked from &#39;package:stats&#39;: ## ## filter library(tidyverse) ## ── Attaching packages ─────────────────────────────────────── tidyverse 1.3.0 ── ## ✓ ggplot2 3.3.3 ✓ purrr 0.3.4 ## ✓ tibble 3.1.1 ✓ dplyr 1.0.5 ## ✓ tidyr 1.1.3 ✓ stringr 1.4.0 ## ✓ readr 1.4.0 ✓ forcats 0.5.1 ## ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ── ## x dplyr::filter() masks dfidx::filter(), stats::filter() ## x dplyr::lag() masks stats::lag() library(modelsummary) library(haven) library(knitr) library(kableExtra) ## ## Attaching package: &#39;kableExtra&#39; ## The following object is masked from &#39;package:dplyr&#39;: ## ## group_rows sf_work &lt;- read_rds(&quot;data/worktrips.rds&quot;) 9.1 Introduction This chapter re-examines the San Francisco mode choice models estimated in CHAPTER 6 and CHAPTER 7 and evaluates whether the MNL models should be replaced by nested logit models. The final, un-segmented, specifications, Model 17W for work trips and Model 14 S/O for shop/other trips, are taken as the base specifications for estimating nested logit models . Nested models for work trips are examined first, followed by shop/other trips. The chapter concludes with consideration of the policy implications of adopting alternative nesting structures. Although the number of possible nests for six alternatives is large, the nature of the alternatives allows certain nests to be rejected as implausible. For example, it is unreasonable to suppose that Bike and Transit have substantial unobserved characteristics that lead to correlation in the error terms of their utility functions. For this reason, this chapter considers four plausible nests which are combined in different ways. For Work trips , these are: • Motorized (M) alternatives, comprised of Drive Alone, Shared Ride 2, Shared Ride 3+, and Transit; • Private automobile (P) alternatives, including Drive Alone, Shared Ride 2 and Shared Ride 3+ alternatives; • Shared ride (S) alternatives; and • Non-Motorized (NM) alternatives comprised of Bike and Walk. Given these four nests or groupings of alternatives and recognizing that Motorized includes both Automobile and Transit alternatives and that Automobile includes Drive Alone and the Shared Ride alternatives, fifteen nest structures as described below. We begin with four single nest models (and, based on the results of these estimations, we explore a selection of more complex structures. Figure 9.1: Single Nest Models 9.2 Nested Models for Work Trips The estimation of nested logit models for work trips begins with consideration of the four single nest models mentioned above and illustrated in Figure 9.1. Each of these models obtains improved goodness-of-fit relative to the MNL model (see Table ??). Three of the four models; Models 18W, 20W, 21W; result in acceptable logsum parameters and two of these models (Models 18W and 20W) significantly reject the MNL model at close to the 0.05 level (see the chi-square test and significance in the Table ??. However, the model with the private automobile nest (Model 19W) is rejected because the logsum parameter is greater than one and the model with the non-motorized nest (Model 21W) cannot reject the MNL model at any reasonable level. work_formula &lt;- chosen ~ I(cost / hhinc) + mot_tvtt + nm_tvtt + movtbyds | hhinc + vehbywrk + I(wkccbd+wknccbd) + wkempden m17w &lt;- mlogit(work_formula, data = sf_work) m18w &lt;- mlogit(work_formula, data = sf_work, nests = list(motorized = c(&#39;Drive alone&#39;, &#39;Share ride 2&#39;, &#39;Share ride 3+&#39;, &#39;Transit&#39;), other = c(&#39;Bike&#39;, &#39;Walk&#39;)), constPar = c(&quot;iv:other&quot; = 1)) m19w &lt;- mlogit(work_formula, data = sf_work, nests = list(privateauto = c(&#39;Drive alone&#39;, &#39;Share ride 2&#39;, &#39;Share ride 3+&#39;), other = c(&#39;Bike&#39;, &#39;Walk&#39;, &quot;Transit&quot;)), constPar = c(&quot;iv:other&quot; = 1)) m20w &lt;- mlogit(work_formula, data = sf_work, nests = list( shared_ride = c(&#39;Share ride 2&#39;, &#39;Share ride 3+&#39;), other = c(&#39;Drive alone&#39;, &#39;Bike&#39;,&#39;Transit&#39;, &#39;Walk&#39;)), constPar = c(&quot;iv:other&quot; = 1)) m21w &lt;- mlogit(work_formula, data = sf_work, nests = list(non_motorized = c(&#39;Bike&#39;, &#39;Walk&#39;), other = c(&#39;Drive alone&#39;,&#39;Share ride 2&#39;, &#39;Share ride 3+&#39;, &#39;Transit&#39;)), constPar = c(&quot;iv:other&quot; = 1)) this_map &lt;- c( &quot;I(cost/hhinc)&quot; = &quot;Travel Cost by Income&quot; , &quot;mot_tvtt&quot; = &quot;Motorized Modes Travel Time&quot;, &quot;nm_tvtt&quot; = &quot;Non-Motorized Modes Travel Time&quot;, &quot;movtbyds&quot; = &quot;Motorized OVT by Distance&quot;, #&quot;hhinc:Share ride 2&quot;, #&quot;hhinc:Share ride 3++&quot;, #&quot;hhinc:Transit&quot;, #&quot;hhinc:Bike&quot;, #&quot;hhinc:Walk&quot;, #&quot;vehbywrk:Share ride 2&quot;, #&quot;vehbywrk:Share ride 3++&quot;, #&quot;vehbywrk:Transit&quot;, #&quot;vehbywrk:Bike&quot;, #&quot;vehbywrk:Walk&quot;, #&quot;wknccbd:Share ride 2&quot;, #&quot;wknccbd:Share ride 3++&quot;, #&quot;wknccbd:Transit&quot;, #&quot;wknccbd:Bike&quot;, #&quot;wknccbd:Walk&quot;, #&quot;wkempden:Share ride 2&quot;, #&quot;wkempden:Share ride 3++&quot;, #&quot;wkempden:Transit&quot;, #&quot;wkempden:Bike&quot;, #&quot;wkempden:Walk&quot;, &quot;(Intercept):Share ride 2&quot; = &quot;Constants Shared ride 2&quot;, &quot;(Intercept):Share ride 3++&quot; = &quot;Constant: Shared ride 3+&quot;, &quot;(Intercept):Transit&quot; = &quot;Constant: Transit&quot;, &quot;(Intercept):Bike&quot; = &quot;Constant: Bike&quot;, &quot;(Intercept):Walk&quot; = &quot;Constant: Walk&quot;, &quot;iv:motorized&quot; = &quot;Motorized Nesting Coefficient&quot;, &quot;iv:privateauto&quot; = &quot;Private Auto Nesting Coefficient&quot;, &quot;iv:shared_ride&quot; = &quot;Shared Ride Nesting Coefficient&quot;, &quot;iv:non_motorized&quot; = &quot;Non-Motorized Nesting Coefficient&quot; ) single_nest &lt;- list( &quot;Model 17W&quot; = m17w, &quot;Model 18W&quot; = m18w, &quot;Model 19W&quot; = m19w, &quot;Model 20W&quot; = m20w, &quot;Model 21W&quot; = m21w ) modelsummary(single_nest, fmt = &quot;%.4f&quot;, coef_map = this_map, statistic = &quot;statistic&quot;, statistic_vertical = FALSE) ## Warning in sanity_ellipsis(vcov, ...): The `statistic_vertical` argument ## is deprecated and will be ignored. To display uncertainty estimates next to ## your coefficients, use a `glue` string in the `estimate` argument. See `? ## modelsummary` Model 17W Model 18W Model 19W Model 20W Model 21W Travel Cost by Income -0.0528 -0.0395 -0.0593 -0.0519 -0.0523 (-4.9053) (-4.2108) (-5.7704) (-6.3229) (-6.1333) Motorized Modes Travel Time -0.0202 -0.0147 -0.0201 -0.0199 -0.0199 (-5.2937) (-3.8350) (-5.1626) (-5.3383) (-5.2238) Non-Motorized Modes Travel Time -0.0455 -0.0463 -0.0462 -0.0454 -0.0454 (-7.8846) (-7.8793) (-7.8626) (-7.7239) (-7.9588) Motorized OVT by Distance -0.1326 -0.1121 -0.1358 -0.1333 -0.1348 (-6.7530) (-6.1534) (-8.1074) (-8.0397) (-8.1464) Constants Shared ride 2 -1.6976 -1.2544 -2.3621 -1.6378 -1.6979 (-11.9649) (-5.1759) (-10.6522) (-13.1040) (-12.6106) Constant: Shared ride 3+ -3.7733 -2.7579 -5.4127 -2.2766 -3.7731 (-16.0157) (-5.1891) (-10.6748) (-8.8225) (-15.8012) Constant: Transit -0.6930 -0.4163 -0.8374 -0.7012 -0.6896 (-2.7770) (-1.9336) (-3.4063) (-2.9420) (-2.8847) Constant: Bike -1.6233 -1.3842 -1.7911 -1.6214 -1.4406 (-3.7840) (-3.4839) (-4.6187) (-4.2150) (-4.0044) Constant: Walk 0.0751 0.3337 -0.0882 0.0737 0.0861 (0.2151) (0.8824) (-0.2441) (0.2071) (0.2501) Motorized Nesting Coefficient 0.7269 (5.4832) Private Auto Nesting Coefficient 1.4788 (13.4001) Shared Ride Nesting Coefficient 0.2994 (3.0847) Non-Motorized Nesting Coefficient 0.7673 (4.1552) Num.Obs. 5029 5029 5029 5029 5029 AIC 6941.6 6942.0 6929.1 6940.4 6944.3 BIC Log.Lik. -3441.782 -3439.980 -3433.532 -3439.198 -3441.156 rho2 0.2914 0.2918 0.2931 0.2919 0.2915 rho20 0.6180 0.6182 0.6190 0.6183 0.6181 tibble( model_name = names(single_nest), model = single_nest, ) %&gt;% mutate( loglik = map_dbl(model, logLik), lrtest = -2 * (loglik[1] - loglik) , p.value = pchisq(lrtest, 1, lower.tail = FALSE) ) %&gt;% select(-model) %&gt;% kbl(col.names = c(&quot;Model&quot;, &quot;Log Likelihood&quot;, &quot;LR Test&quot;, &quot;p-value&quot;)) %&gt;% kable_styling() Model Log Likelihood LR Test p-value Model 17W -3441.782 0.000000 1.0000000 Model 18W -3439.980 3.603876 0.0576450 Model 19W -3433.532 16.500446 0.0000486 Model 20W -3439.198 5.168401 0.0230014 Model 21W -3441.156 1.251722 0.2632239 Next we consider three models with the non-motorized nest in parallel with each of the three other nests (Figure 9.2). In each case, the new models in Table 9-2; Models 22W, 23W and 24W; have better goodness of fit than the corresponding single nest models. Model 23W is rejected because the nest parameter for private automobile is greater than one, as before. Models 22W and 23W both reject the single non-motorized nest (Model 21W) at close to the 0.05 level; however, neither rejects the corresponding Motorized and Shared Ride models (Models 18W and 20W, respectively). In such cases, the analyst can decide to include the non-motorized nest or not, for other than statistical reasons. Figure 9.2: Non-Motorized Nest in Parallel with Motorized, Private Automobile and Shared Ride Nests m22w &lt;- mlogit(work_formula, data = sf_work, nests = list(motorized = c(&#39;Drive alone&#39;, &#39;Share ride 2&#39;, &#39;Share ride 3+&#39;, &#39;Transit&#39;), non_motorized = c(&#39;Bike&#39;, &#39;Walk&#39;))) m23w &lt;- mlogit(work_formula, data = sf_work, nests = list(auto = c(&#39;Drive alone&#39;, &#39;Share ride 2&#39;, &#39;Share ride 3+&#39;), transit = c(&quot;Transit&quot;), non_motorized = c(&#39;Bike&#39;, &#39;Walk&#39;)), constPar = c(&quot;iv:transit&quot; = 1)) m24w &lt;- mlogit(work_formula, data = sf_work, nests = list(shared = c(&#39;Share ride 2&#39;, &#39;Share ride 3+&#39;), other = c(&quot;Drive alone&quot;, &quot;Transit&quot;), non_motorized = c(&#39;Bike&#39;, &#39;Walk&#39;)), constPar = c(&quot;iv:other&quot; = 1)) parallel_nest &lt;- list( &quot;Model 17W&quot; = m17w, &quot;Model 22W&quot; = m22w, &quot;Model 23W&quot; = m23w, &quot;Model 24W&quot; = m24w ) modelsummary(parallel_nest, fmt = &quot;%.4f&quot;, coef_map = this_map, statistic = &quot;statistic&quot;, statistic_vertical = FALSE) ## Warning in sanity_ellipsis(vcov, ...): The `statistic_vertical` argument ## is deprecated and will be ignored. To display uncertainty estimates next to ## your coefficients, use a `glue` string in the `estimate` argument. See `? ## modelsummary` Model 17W Model 22W Model 23W Model 24W Travel Cost by Income -0.0528 -0.0394 -0.0585 -0.0516 (-4.9053) (-4.2195) (-5.6989) (-6.2406) Motorized Modes Travel Time -0.0202 -0.0146 -0.0198 -0.0195 (-5.2937) (-3.8326) (-5.0862) (-5.2275) Non-Motorized Modes Travel Time -0.0455 -0.0463 -0.0460 -0.0446 (-7.8846) (-8.1136) (-8.0568) (-7.8563) Motorized OVT by Distance -0.1326 -0.1138 -0.1384 -0.1344 (-6.7530) (-6.2360) (-8.2700) (-8.1193) Constants Shared ride 2 -1.6976 -1.2583 -2.3612 -1.6373 (-11.9649) (-5.2194) (-10.6454) (-13.0660) Constant: Shared ride 3+ -3.7733 -2.7657 -5.4110 -2.3204 (-16.0157) (-5.2323) (-10.6689) (-8.1172) Constant: Transit -0.6930 -0.4151 -0.8323 -0.7057 (-2.7770) (-1.9268) (-3.3868) (-2.9593) Constant: Bike -1.6233 -1.2033 -1.6157 -1.4757 (-3.7840) (-3.2425) (-4.4488) (-4.1092) Constant: Walk 0.0751 0.3451 -0.0812 0.0657 (0.2151) (0.9398) (-0.2320) (0.1910) Motorized Nesting Coefficient 0.7289 (5.5350) Non-Motorized Nesting Coefficient 0.7698 0.7652 0.7579 (4.2012) (4.1873) (4.1389) Num.Obs. 5029 5029 5029 5029 AIC 6941.6 6940.7 6929.8 6941.1 BIC Log.Lik. -3441.782 -3439.343 -3432.889 -3438.531 rho2 0.2914 0.2919 0.2932 0.2921 rho20 0.6180 0.6183 0.6190 0.6184 tibble( model_name = names(parallel_nest), model = parallel_nest, ) %&gt;% mutate( loglik = map_dbl(model, logLik), lrtest = -2 * (loglik[1] - loglik) , p.value = pchisq(lrtest, 1, lower.tail = FALSE) ) %&gt;% select(-model) %&gt;% kbl(col.names = c(&quot;Model&quot;, &quot;Log Likelihood&quot;, &quot;LR Test&quot;, &quot;p-value&quot;)) %&gt;% kable_styling() Model Log Likelihood LR Test p-value Model 17W -3441.782 0.000000 1.0000000 Model 22W -3439.343 4.878942 0.0271863 Model 23W -3432.889 17.785788 0.0000247 Model 24W -3438.531 6.502062 0.0107749 Another option is to consider ‘hierarchical’ two nest models with Motorized and Private Automobile, Motorized and Shared Ride or Private Automobile and Shared Ride as illustrated in Figure 9.3. Of the three models reported in Table 9-3, only Model 26W, Motorized and Shared Ride, produces an acceptable result. Model 27W is rejected because the private automobile nest coefficient is greater than one, as before. Model 25W is also rejected, despite the fact that the automobile nest parameter is less than one because it is greater than the logsum parameter for the motorized nest which is above it (see Section 8.4). Model 26W, however, represents an attractive model achieving the best goodness-of-fit of any of the models considered, with acceptable logsum parameters. Further, it rejects the MNL model (Model 17W), the Motorized (Model 18W) and the Shared Ride (Model 20W) nest models at roughly the 0.03, 0.07 and 0.06 levels, respectively. Table 9-4 presents four additional nested model structures for work trips. The first two models extend the nesting structures previously estimated. Model 28W adds the non-motorized nest to Model 26W (see Figure 9.4) with further improved goodness-of-fit, but cannot reject Model 26W at any reasonable level of significance. Model 29W which includes the Motorized, Private Automobile and Shared Ride Nests (see Figure 9.3) is infeasible as it obtains a logsum for the automobile nest that is greater than for the motorized nest, as before. However, Model 29W presents a structure that represents our expectation of the relationship among the motorized modes. Thus, we estimate Model 30W which is identical to Model 29W except that it constrains the automobile nest parameter to 0.75 times the value of the motorized nest parameter. While Model 30W results in a poorer goodness-of-fit than any of the other models including the simple MNL model; it is worth considering because it reflects increased substitution as we move from the Motorized Nest to the Private Automobile Nest to the Shared Ride Nest, as expected. The data does not support this structure (relative to the MNL) but if the analyst or policy makers are convinced it is correct, the use of the relational constraint can produce a model consistent with these assumptions. Figure 9.3: Complex Nested Models The final model, Model 31W, extends Model 30W by adding the Non-Motorized nest to the structure. It therefore has the same issues regarding the constrained nest parameters, but it offers the advantage of including the substitution effects associated with all four nests previously selected. Again, the decision on the acceptance of this model may be based primarily on the judgment of analysts and policy makers. Based on these results, Models 26W, 28W, 30W and 31W are all potential candidates for a final model. Model 26W is not rejected by any other model and is the simplest structure of this group. Model 28W is slightly better than Model 26W but enough to statistically reject it. Models 30W and 31W have a poorer goodness of fit than Model 26W and 28W, respectively but they incorporate the private automobile intermediate nest. The decision about which of these models to use is largely a matter of judgment. It is possible that other models might also be considered. We further examine Model 26W, because of its simplicity, to demonstrate the differences in direct-elasticity and cross-elasticity between the MNL (17W) model and pairs of alternatives in different parts of the NL tree associated with 26W. parallel_nest &lt;- list( #&quot;Model 17W&quot; = m17w, #&quot;Model 26W&quot; = m26w ) The structure of the nested logit model (26W) in Figure 9.3 is reproduced here so that each nest can be readily identified. The following table reports the elasticities for the MNL Model 17W and the NL Model 26W. Figure 9.4: Motorized-Shared Ride Nest (Model 26W) It is apparent from the above table that reduction in the magnitude of the utility parameter for the NL model results in a lower direct and cross elasticity for alternatives that are in neither of the nests depicted in Figure 9.5 than they would have in the corresponding MNL model while alternatives in the lowest and intermediate nests have increased elasticity. The magnitude in of the elasticity increases as alternatives or pairs of alternatives are in lower nests in the tree. Possibly, a better way to think about this is that adoption of the MNL model results in some type of averaged elasticities rather than the distinct elasticities for alternatives in a properly formed NL model. 9.3 Nested Models for Shop / Other Trips The exploration of nested logit models for shop/other trips follows the same approach as used with work trips, beginning with the consideration of four single nest models depicted in Figure 9.4. For these trips, all four of the single nest structures produce valid models (Table 9-6). Further, Models 15 S/O, 16 S/O and 17 S/O strongly reject the MNL model; however, the non-motorized nest (Model 18 S/O) does not reject the MNL model at any reasonable level of significance. sf_shopother &lt;- read_rds(&quot;data/shopother.rds&quot;) #&quot;Transit&quot;, &quot;Share 2&quot;, &quot;Share 3+&quot;,&quot;Drive alone and Share 2/3+&quot;, &quot;Share 2/3+&quot;,&quot;Bike&quot;, &quot;Walk&quot;, &quot;Drive alone&quot; #This table has the right idea, though I&#39;m not sure what I can do to fix it or make it more accurate. I also don&#39;t know why it isn&#39;t showing the other constants... SO_formula &lt;- chosen ~ totcost + tvtt + I(totcost/log(income)) + ovttdist | income + veh_wkr + ave_dens m14SO &lt;- mlogit(SO_formula, data = sf_shopother) m15SO &lt;- mlogit(SO_formula, data = sf_shopother, nests = list(motorized = c(&#39;Drive alone&#39;, &#39;Drive alone and Share 2/3+&#39;, &#39;Share 2/3+&#39;,&#39;Transit&#39;, &#39;Share 2&#39;,&#39;Share 3+&#39;), non_motorized = c(&#39;Bike&#39;, &#39;Walk&#39;)), constPar = c(&quot;iv:non_motorized&quot; = 1)) m16SO &lt;- mlogit(SO_formula, data = sf_shopother, nests = list(private_auto = c(&#39;Drive alone&#39;, &#39;Drive alone and Share 2/3+&#39;, &#39;Share 2/3+&#39;, &#39;Share 2&#39;,&#39;Share 3+&#39;), other = c(&#39;Transit&#39;, &#39;Bike&#39;, &#39;Walk&#39;)), constPar = c(&quot;iv:other&quot; = 1)) m17SO &lt;- mlogit(SO_formula, data = sf_shopother, nests = list(shared = c(&#39;Share 2/3+&#39;,&#39;Transit&#39;, &#39;Share 2&#39;,&#39;Share 3+&#39;), other = c(&quot;Drive alone&quot;, &quot;Transit&quot;,&#39;Bike&#39;, &#39;Walk&#39;,&#39;Drive alone and Share 2/3+&#39;)), constPar = c(&quot;iv:other&quot; = 1)) m18SO &lt;- mlogit(SO_formula, data = sf_shopother, nests = list(other = c(&#39;Drive alone&#39;, &#39;Drive alone and Share 2/3+&#39;, &#39;Share 2/3+&#39;,&#39;Transit&#39;, &#39;Share 2&#39;,&#39;Share 3+&#39;), non_motorized = c(&#39;Bike&#39;, &#39;Walk&#39;)), constPar = c(&quot;iv:other&quot; = 1)) parallel_nests &lt;- list( &quot;Model 14SO&quot; = m14SO, &quot;Model 15SO&quot; = m15SO, &quot;Model 16SO&quot; = m16SO, &quot;Model 17SO&quot; = m17SO, &quot;Model 18SO&quot; = m18SO ) modelsummary(parallel_nests, fmt = &quot;%.4f&quot;, coef_map = this_map, statistic = &quot;statistic&quot;, statistic_vertical = FALSE) ## Warning in sanity_ellipsis(vcov, ...): The `statistic_vertical` argument ## is deprecated and will be ignored. To display uncertainty estimates next to ## your coefficients, use a `glue` string in the `estimate` argument. See `? ## modelsummary` Model 14SO Model 15SO Model 16SO Model 17SO Model 18SO Constant: Bike -7.7607 -7.0614 -7.0490 -7.4427 -6.6157 (-9.6801) (-5.0223) (-7.7275) (-7.6222) (-8.2790) Constant: Walk -3.5504 -2.7343 -2.9676 -3.1170 -3.6332 (-5.3377) (-2.0550) (-3.9906) (-3.6214) (-5.7231) Motorized Nesting Coefficient 2.7352 (3.6668) Non-Motorized Nesting Coefficient 0.5724 (4.4713) Num.Obs. 3157 3157 3157 3157 3157 AIC 9581.8 9570.9 9567.4 9576.5 9581.3 BIC Log.Lik. -4758.915 -4751.453 -4749.720 -4754.236 -4756.626 rho2 0.0668 0.0683 0.0686 0.0677 0.0673 rho20 0.2751 0.2762 0.2765 0.2758 0.2754 Despite the marginal significance of the non-motorized nest, the possible two parallel nest models including non-motorized and one other nest, were estimated and are reported in Table 9-7. All three specifications result in valid models with improved goodness-of-fit over the MNL and the single nest NM model (Model 18 S/O) but Models 19 S/O, 20 S/O and 21 S/O do not reject the corresponding Motorized (Model 15 S/O), Private Automobile (Model 16 S/O) and Shared Ride (Model 17 S/O) nest models, which are restricted forms of these models, at a high level of confidence. It is important to note that a variety of different initial parameters were required to find the solution for Model 20 S/O reported here. The selection of different starting values for the model parameters, especially the nest parameter(s) may lead to convergence at different values in or out of the acceptable range as discussed in CHAPTER 10. As in the case of work trips, hierarchical two-nest models, depicted in Figure 9.2, are considered next, Table 9-8. Model 22 S/O obtains a satisfactory parameter for the automobile logsum but the motorized logsum is not significantly different from one and the model does not reject the single nest Private Automobile structure (Model 16 S/O). However, Models 23 S/O (with shared ride under the motorized nest) and 24 S/O (with shared ride under the automobile nest) provide excellent results. The similarity interpretation of these nests is reasonable and both models strongly reject the MNL model and the constrained single nest models reported in Table 9-7. m22SO &lt;- mlogit(work_formula, data = sf_work, nests = list(motorized = c(&#39;Drive alone&#39;, &#39;Share ride 2&#39;, &#39;Share ride 3+&#39;, &#39;Transit&#39;), non_motorized = c(&#39;Bike&#39;, &#39;Walk&#39;))) m23SO &lt;- mlogit(work_formula, data = sf_work, nests = list(auto = c(&#39;Drive alone&#39;, &#39;Share ride 2&#39;, &#39;Share ride 3+&#39;), transit = c(&quot;Transit&quot;), non_motorized = c(&#39;Bike&#39;, &#39;Walk&#39;)), constPar = c(&quot;iv:transit&quot; = 1)) m24SO &lt;- mlogit(work_formula, data = sf_work, nests = list(shared = c(&#39;Share ride 2&#39;, &#39;Share ride 3+&#39;), other = c(&quot;Drive alone&quot;, &quot;Transit&quot;), non_motorized = c(&#39;Bike&#39;, &#39;Walk&#39;)), constPar = c(&quot;iv:other&quot; = 1)) parallel_nest &lt;- list( #&quot;Model 14SO&quot; = m14SO, &quot;Model 22SO&quot; = m22SO, &quot;Model 23SO&quot; = m23SO, &quot;Model 24SO&quot; = m24SO ) modelsummary(parallel_nest) Model 22SO Model 23SO Model 24SO (Intercept) × Share ride 2 -1.258 -2.361 -1.637 (0.241) (0.222) (0.125) (Intercept) × Share ride 3++ -2.766 -5.411 -2.320 (0.529) (0.507) (0.286) (Intercept) × Transit -0.415 -0.832 -0.706 (0.215) (0.246) (0.238) (Intercept) × Bike -1.203 -1.616 -1.476 (0.371) (0.363) (0.359) (Intercept) × Walk 0.345 -0.081 0.066 (0.367) (0.350) (0.344) I(cost/hhinc) -0.039 -0.059 -0.052 (0.009) (0.010) (0.008) mot_tvtt -0.015 -0.020 -0.020 (0.004) (0.004) (0.004) nm_tvtt -0.046 -0.046 -0.045 (0.006) (0.006) (0.006) movtbyds -0.114 -0.138 -0.134 (0.018) (0.017) (0.017) hhinc × Share ride 2 0.000 -0.002 0.000 (0.001) (0.002) (0.001) hhinc × Share ride 3++ 0.002 0.001 0.001 (0.002) (0.003) (0.002) hhinc × Transit -0.004 -0.005 -0.005 (0.002) (0.002) (0.002) hhinc × Bike -0.010 -0.008 -0.009 (0.004) (0.004) (0.004) hhinc × Walk -0.006 -0.005 -0.006 (0.003) (0.003) (0.003) vehbywrk × Share ride 2 -0.271 -0.605 -0.341 (0.071) (0.115) (0.060) vehbywrk × Share ride 3++ -0.107 -0.257 -0.278 (0.082) (0.164) (0.070) vehbywrk × Transit -0.705 -0.862 -0.948 (0.145) (0.110) (0.104) vehbywrk × Bike -0.736 -0.599 -0.699 (0.197) (0.197) (0.195) vehbywrk × Walk -0.764 -0.612 -0.713 (0.139) (0.141) (0.139) I(wkccbd + wknccbd) × Share ride 2 0.183 0.388 0.388 (0.097) (0.181) (0.113) I(wkccbd + wknccbd) × Share ride 3++ 0.800 1.641 0.626 (0.203) (0.317) (0.142) I(wkccbd + wknccbd) × Transit 0.920 1.364 1.324 (0.220) (0.185) (0.179) I(wkccbd + wknccbd) × Bike 0.403 0.443 0.443 (0.328) (0.333) (0.329) I(wkccbd + wknccbd) × Walk 0.107 0.117 0.105 (0.235) (0.240) (0.238) wkempden × Share ride 2 0.001 0.003 0.002 (0.000) (0.001) (0.000) wkempden × Share ride 3++ 0.002 0.004 0.002 (0.000) (0.001) (0.000) wkempden × Transit 0.002 0.004 0.003 (0.000) (0.000) (0.000) wkempden × Bike 0.002 0.003 0.002 (0.001) (0.001) (0.001) wkempden × Walk 0.002 0.003 0.003 (0.001) (0.001) (0.001) iv × motorized 0.729 (0.132) iv × non_motorized 0.770 0.765 0.758 (0.183) (0.183) (0.183) iv × auto 1.479 (0.110) iv × shared 0.320 (0.112) Num.Obs. 5029 5029 5029 AIC 6940.7 6929.8 6941.1 BIC Log.Lik. -3439.343 -3432.889 -3438.531 rho2 0.292 0.293 0.292 rho20 0.618 0.619 0.618 Unlike the case of the home-based work models, the home-based shop/other data set supports complex nested models which combine the hierarchical and parallel nests to capture the different substitutability between several groups of alternatives. Models 25 S/O and 26 S/O improve goodness-of-fit over both the best hierarchical (Model 24 S/O) and parallel (Model 20 S/O) two-nest models. These more complex models can reject all of the single nest models at the .05 level or higher, but cannot reject the best two-nest models at a high level of confidence. Even so, they may still be preferred for their potentially more realistic representation of trade-offs between pairs of alternatives. The same rationale could be applied between the two models, as Model 26 S/O cannot reject 25 S/O, either, but allows for greater substitutability between the non-motorized modes (for which the statistical evidence is moderately significant). The nesting coefficient for the motorized nest is not particularly significant in either model, but it can be retained given the reasonableness of its value. 9.4 Practical Issues and Implications A large number of nested logit structures can be proposed for any context in which the number of alternatives is not very small. As seen, even in the case of four alternatives, there are 25 possible nest structures and this number increases to 235 for five alternatives and beyond 2000 for six or more alternatives. Since searching across this many nest structures is generally infeasible, it is the responsibility of the analyst to propose a subset of these structures for primary consideration or, alternatively, to eliminate a subset of such structures from consideration. At the same time, it is desirable for the analyst to remain open to other possible structures that may be suggested by others who have familiarity with the behavior under study. It is not uncommon for some or all of the proposed structures to be infeasible due to obtaining an estimated logsum or nesting parameter that is greater than one or greater than the parameter in a higher level nest. It is a matter of judgment whether to eliminate the proposed structure based on the estimation results or to constrain selected nest parameters to fixed values or to relative values that ensure that the structure is consistent with utility maximization. This ‘imposition’ of a fixed value or other constraints on nest parameters requires careful judgment, discussion with other modeling and policy analysts and open reporting so that potential users of the model are aware of the basis for the proposed model. An important part of the decision process is the differential interpretation associated with any nested logit model relative to the multinomial logit model or other nested logit models. The central element of such interpretation is the way in which a change in any of the characteristics of an alternative affects the probability of that alternative and each other alternative being chosen. This is the essential element of competition/substitution between pairs of alternatives and may dramatically influence the predicted impact of selected policy changes. "],["multiple-maxima-in-nested-logit-estimation-nesting-optima-chapter.html", "Chapter 10 Multiple Maxima in Nested Logit Estimation (#nesting-optima-chapter)", " Chapter 10 Multiple Maxima in Nested Logit Estimation (#nesting-optima-chapter) "],["aggregate-forecasting-assessment-and-application.html", "Chapter 11 Aggregate Forecasting Assessment, and Application 11.1 Background 11.2 Aggregate Forecasting 11.3 Aggregate Assessment of Travel Mode Choice Models", " Chapter 11 Aggregate Forecasting Assessment, and Application 11.1 Background 11.2 Aggregate Forecasting 11.3 Aggregate Assessment of Travel Mode Choice Models "],["recent-advances-in-discrete-choice-modeling.html", "Chapter 12 Recent Advances in Discrete Choice Modeling 12.1 The GEV Class of Models 12.2 The MMNL Class of Models 12.3 The Mixed GEV Class of Models 12.4 Summary", " Chapter 12 Recent Advances in Discrete Choice Modeling 12.1 The GEV Class of Models 12.2 The MMNL Class of Models 12.3 The Mixed GEV Class of Models 12.4 Summary "],["references.html", "References", " References "]]

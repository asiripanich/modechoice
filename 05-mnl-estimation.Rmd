# Data Assembly and Estimation of Simple Multinomial Logit Models
```{r setup}
library(tidyverse)
library(haven)
library(mlogit)
library(modelsummary)
```


## Introduction


## Data Requirements Overview

## Sources and Methods for Traveler and Trip Related Data Collection

```{r llcll0}
data("Fishing", package = "mlogit")
Fish <- dfidx(Fishing, varying = 2:9, shape = "wide", choice = "mode")

mnl <- mlogit(mode ~ price + catch, data = Fish)

ll0 <- nrow(Fish) * log(1 / 4)
llC <- sum(mnl$freq * log(mnl$freq / sum(mnl$freq)))

rhoc <- 1 - logLik(mnl) / llC
rho0 <- 1 - logLik(mnl) / ll0
```


## Methods for Collecting Mode Related Data

## Data STructure for Estimation

```{r loaddata}
# Read in raw SPSS file from Laurie Garrow's Dropbox
sf_work_mode <- read_spss("data-raw/Work Trips/SPSS/SF MTC Work MC Data NewVars.sav")

# Convert into mlogit dfidx data frame
#   mlogit 
sf_mlogit <- dfidx(sfwork_mode)

# write to data/ folder for future use
write_rds("data/sfwork_logit.rds")
```



## Application Data for Work Mode Choice in the San Francisco Bay Area


## Estimation of MNL Model with Basic Specification

```{r basic-estimation}
base <- mlogit(mode ~ price + catch | income, data = Fish)

# estimate a model with constants only by constraining a single generic variable
# to be zero
market_shares <- mlogit(mode ~ price, data = Fish, constPar = c("price" = 0))

# Estimate a null model by constraining ALL the parameters to be zero. 
fixed_coefs <- rep(0,4) %>% setNames(c(names(coef(market_shares)), "price"))
null_model <- mlogit(mode ~ price, data = Fish, start = fixed_coefs, iterlim = 0)
```

```{r basic-estimation-table}
basic_estimation <- list(
  "Null Model" = null_model,
  "Market Shares" = market_shares,
  "Base Model" = base
)

modelsummary(
  basic_estimation, 
  title = "Estimation Results for Zero Coefficient, Constants Only, and Base Models"
)
```


## Value of Time